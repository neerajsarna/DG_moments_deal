(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 10.0' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       158,          7]
NotebookDataLength[    231629,       5952]
NotebookOptionsPosition[    226807,       5795]
NotebookOutlinePosition[    227167,       5811]
CellTagsIndexPosition[    227124,       5808]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{

Cell[CellGroupData[{
Cell["Tensor Definitions", "Section",
 CellChangeTimes->{{3.569139429210832*^9, 3.569139448895958*^9}}],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{"Remove", "[", "\"\<Global`*\>\"", "]"}], "*)"}]], "Input",
 CellChangeTimes->{3.682050114961279*^9}],

Cell["\<\
Mathematica build-in function like \[OpenCurlyQuote]Symmetrize[]\
\[CloseCurlyQuote] and \[OpenCurlyQuote]TensorContract[]\[CloseCurlyQuote] \
seem 
to work really slow or fail due to memory requirements on fully symmetric \
tensors 
with degree >10.
We define our own functions below based on a simply array data structure for \
fully symmetric tensors.\
\>", "Text",
 CellChangeTimes->{{3.5691393015045276`*^9, 3.5691394253246098`*^9}, {
  3.569230437595318*^9, 3.569230461117482*^9}},
 FontColor->RGBColor[1, 0, 0]],

Cell[BoxData[{
 RowBox[{"Clear", "[", 
  RowBox[{
  "n", ",", "degree", ",", "idx", ",", "idx1", ",", "A", ",", "b", ",", "id3",
    ",", "IDX"}], "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Unprotect", "[", "TensorDegree", "]"}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"IDXFull", "[", "n_", "]"}], ":=", 
  RowBox[{"Flatten", "[", 
   RowBox[{
    RowBox[{"Table", "[", 
     RowBox[{
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"n", "-", "ii"}], ",", 
          RowBox[{"ii", "-", "jj"}], ",", "jj"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"jj", ",", "0", ",", "ii"}], "}"}]}], "]"}], ",", 
      RowBox[{"{", 
       RowBox[{"ii", ",", "0", ",", "n"}], "}"}]}], "]"}], ",", "1"}], 
   "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"IDXtrfFull", "[", "n_", "]"}], ":=", 
   RowBox[{"Flatten", "[", 
    RowBox[{
     RowBox[{"Table", "[", 
      RowBox[{
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{"n", "-", "ii"}], ",", 
           RowBox[{"ii", "-", "jj"}], ",", "jj"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"jj", ",", "0", ",", 
           RowBox[{"Min", "[", 
            RowBox[{"ii", ",", "1"}], "]"}]}], "}"}]}], "]"}], ",", 
       RowBox[{"{", 
        RowBox[{"ii", ",", "0", ",", "n"}], "}"}]}], "]"}], ",", "1"}], 
    "]"}]}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Do", "[", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"IDX", "[", "degree", "]"}], "=", 
      RowBox[{"IDXFull", "[", "degree", "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"IDXtrf", "[", "degree", "]"}], "=", 
      RowBox[{"IDXtrfFull", "[", "degree", "]"}]}], ";"}], 
    "\[IndentingNewLine]", ",", 
    RowBox[{"{", 
     RowBox[{"degree", ",", "0", ",", "40"}], "}"}]}], "]"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"toIDX1", "[", "list_", "]"}], ":=", 
   RowBox[{"Map", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"Count", "[", 
       RowBox[{"list", ",", "#"}], "]"}], "&"}], ",", 
     RowBox[{"{", 
      RowBox[{"1", ",", "2", ",", "3"}], "}"}]}], "]"}]}], " ", 
  RowBox[{"(*", " ", 
   RowBox[{
    RowBox[{"Input", " ", "cartesean", " ", "indices"}], ",", " ", 
    RowBox[{"e", ".", "g", ".", " ", 
     RowBox[{"{", 
      RowBox[{"1", ",", "1", ",", "2", ",", "1", ",", "3"}], "}"}]}]}], " ", 
   "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"toIDX2", "[", "list_", "]"}], ":=", 
   RowBox[{
    RowBox[{"Position", "[", 
     RowBox[{
      RowBox[{"IDX", "[", 
       RowBox[{"Total", "[", "list", "]"}], "]"}], ",", "list"}], "]"}], 
    "\[LeftDoubleBracket]", 
    RowBox[{"1", ",", "1"}], "\[RightDoubleBracket]"}]}], " ", 
  RowBox[{"(*", " ", 
   RowBox[{
   "Input", " ", "triple", " ", "of", " ", "#", "indices", " ", "in", " ", 
    RowBox[{"{", 
     RowBox[{"1", ",", "2", ",", "3"}], "}"}]}], " ", 
   "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"toIDX3", "[", "list_", "]"}], ":=", 
   RowBox[{
    RowBox[{"Position", "[", 
     RowBox[{
      RowBox[{"IDXtrfFull", "[", 
       RowBox[{"Total", "[", "list", "]"}], "]"}], ",", "list"}], "]"}], 
    "\[LeftDoubleBracket]", 
    RowBox[{"1", ",", "1"}], "\[RightDoubleBracket]"}]}], " ", 
  RowBox[{"(*", " ", 
   RowBox[{
   "Input", " ", "triple", " ", "of", " ", "#", "indices", " ", "in", " ", 
    RowBox[{"{", 
     RowBox[{"1", ",", "2", ",", "3"}], "}"}]}], " ", 
   "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"TensorDegree", "[", "A_", "]"}], ":=", 
   RowBox[{
    FractionBox["1", "2"], " ", 
    RowBox[{"(", 
     RowBox[{
      RowBox[{"-", "3"}], "+", 
      SqrtBox[
       RowBox[{"1", "+", 
        RowBox[{"8", " ", 
         RowBox[{"Length", "[", "A", "]"}]}]}]]}], ")"}]}]}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"id3", "=", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"1", ",", "0", ",", "0"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"0", ",", "1", ",", "0"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"0", ",", "0", ",", "1"}], "}"}]}], "}"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"DeltaValues", "[", "list_", "]"}], ":=", 
    RowBox[{"Block", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"a", "=", 
         RowBox[{
         "list", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}]}], 
        ",", 
        RowBox[{"b", "=", 
         RowBox[{
         "list", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}]}], 
        ",", 
        RowBox[{"c", "=", 
         RowBox[{
         "list", "\[LeftDoubleBracket]", "3", "\[RightDoubleBracket]"}]}]}], 
       "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"OddQ", "[", "a", "]"}], "||", 
         RowBox[{"OddQ", "[", "b", "]"}], "||", 
         RowBox[{"OddQ", "[", "c", "]"}]}], ",", "0", ",", 
        FractionBox[
         RowBox[{"Multinomial", "[", 
          RowBox[{
           FractionBox["a", "2"], ",", 
           FractionBox["b", "2"], ",", 
           FractionBox["c", "2"]}], "]"}], 
         RowBox[{"Multinomial", "[", 
          RowBox[{"a", ",", "b", ",", "c"}], "]"}]]}], "]"}]}], 
     "\[IndentingNewLine]", "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"DeltaTensor2", "[", 
     RowBox[{"degree_", "?", "EvenQ"}], "]"}], ":=", 
    RowBox[{"Map", "[", 
     RowBox[{"DeltaValues", ",", 
      RowBox[{"IDX", "[", "degree", "]"}]}], "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"SymTrace2", "[", "A_", "]"}], ":=", 
    RowBox[{"Block", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"dim", "=", "3"}], ",", "idx", ",", "idx1", ",", 
        RowBox[{"degree", "=", 
         RowBox[{"TensorDegree", "[", "A", "]"}]}], ",", "length", ",", 
        "res"}], "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"length", "=", 
        RowBox[{"Length", "[", 
         RowBox[{"IDX", "[", 
          RowBox[{"degree", "-", "2"}], "]"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"res", "=", 
        RowBox[{"ConstantArray", "[", 
         RowBox[{"0", ",", "length"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"Do", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{
           "res", "\[LeftDoubleBracket]", "jj", "\[RightDoubleBracket]"}], 
           "=", 
           RowBox[{"Expand", "[", 
            RowBox[{"Sum", "[", 
             RowBox[{
              RowBox[{"A", "\[LeftDoubleBracket]", 
               RowBox[{"toIDX2", "[", 
                RowBox[{
                 RowBox[{
                  RowBox[{"IDX", "[", 
                   RowBox[{"degree", "-", "2"}], "]"}], 
                  "\[LeftDoubleBracket]", "jj", "\[RightDoubleBracket]"}], 
                 "+", 
                 RowBox[{"2", " ", 
                  RowBox[{
                  "id3", "\[LeftDoubleBracket]", "ii", 
                   "\[RightDoubleBracket]"}]}]}], "]"}], 
               "\[RightDoubleBracket]"}], ",", 
              RowBox[{"{", 
               RowBox[{"ii", ",", "1", ",", "dim"}], "}"}]}], "]"}], "]"}]}], 
          ";"}], "\[IndentingNewLine]", ",", 
         RowBox[{"{", 
          RowBox[{"jj", ",", "1", ",", "length"}], "}"}]}], "]"}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", "res"}]}], 
     "\[IndentingNewLine]", "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"SymTraces", "[", 
     RowBox[{"A_", ",", "n_"}], "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"res", "=", "A"}], "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"Do", "[", 
        RowBox[{
         RowBox[{"res", "=", 
          RowBox[{"SymTrace2", "[", "res", "]"}]}], ",", 
         RowBox[{"{", 
          RowBox[{"ii", ",", "1", ",", "n"}], "}"}]}], "]"}], ";", 
       "\[IndentingNewLine]", "res"}]}], "\[IndentingNewLine]", "]"}]}], 
   ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
  RowBox[{"(*", " ", 
   RowBox[{
   "contraction", " ", "of", " ", "a", " ", "symmetric", " ", "tensor", " ", 
    "A", " ", "with", " ", 
    SubscriptBox["b", "i"]}], " ", "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"SymDot2", "[", 
     RowBox[{"A_", ",", 
      RowBox[{"b_", "?", "VectorQ"}]}], "]"}], ":=", 
    RowBox[{"Block", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"dim", "=", "3"}], ",", "idx", ",", "idx1", ",", 
        RowBox[{"degree", "=", 
         RowBox[{"TensorDegree", "[", "A", "]"}]}], ",", "length", ",", 
        "res"}], "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"length", "=", 
        RowBox[{"Length", "[", 
         RowBox[{"IDX", "[", 
          RowBox[{"degree", "-", "1"}], "]"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"res", "=", 
        RowBox[{"ConstantArray", "[", 
         RowBox[{"0", ",", "length"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"Do", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{
           "res", "\[LeftDoubleBracket]", "jj", "\[RightDoubleBracket]"}], 
           "=", 
           RowBox[{"Expand", "[", 
            RowBox[{"Sum", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"A", "\[LeftDoubleBracket]", 
                RowBox[{"toIDX2", "[", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"IDX", "[", 
                    RowBox[{"degree", "-", "1"}], "]"}], 
                   "\[LeftDoubleBracket]", "jj", "\[RightDoubleBracket]"}], 
                  "+", 
                  RowBox[{
                  "id3", "\[LeftDoubleBracket]", "ii", 
                   "\[RightDoubleBracket]"}]}], "]"}], 
                "\[RightDoubleBracket]"}], 
               RowBox[{
               "b", "\[LeftDoubleBracket]", "ii", "\[RightDoubleBracket]"}]}],
               ",", 
              RowBox[{"{", 
               RowBox[{"ii", ",", "1", ",", "dim"}], "}"}]}], "]"}], "]"}]}], 
          ";"}], "\[IndentingNewLine]", ",", 
         RowBox[{"{", 
          RowBox[{"jj", ",", "1", ",", "length"}], "}"}]}], "]"}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", "res"}]}], 
     "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]", 
  RowBox[{"(*", " ", 
   RowBox[{
    RowBox[{
    "full", " ", "contraction", " ", "of", " ", "two", " ", "symmetric", " ", 
     "tensors", " ", "A"}], ",", " ", 
    RowBox[{"B", " ", "with", " ", "same", " ", "degree"}]}], " ", 
   "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"SymFullDot", "[", 
     RowBox[{"A_", ",", "B_"}], "]"}], ":=", 
    RowBox[{"Block", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"dim", "=", "3"}], ",", "idx", ",", "idx1", ",", 
        RowBox[{"degree", "=", 
         RowBox[{"TensorDegree", "[", "A", "]"}]}], ",", "length", ",", 
        "res"}], "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"TensorDegree", "[", "B", "]"}], "\[NotEqual]", "degree"}], 
         ",", 
         RowBox[{"Return", "[", "0", "]"}]}], "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"length", "=", 
        RowBox[{"Length", "[", 
         RowBox[{"IDX", "[", "degree", "]"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"res", "=", "0"}], ";", "\[IndentingNewLine]", 
       RowBox[{"Do", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{"idx", "=", 
           RowBox[{
            RowBox[{"IDX", "[", "degree", "]"}], "\[LeftDoubleBracket]", "jj",
             "\[RightDoubleBracket]"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"res", "+=", 
           RowBox[{
            RowBox[{"Multinomial", "[", 
             RowBox[{
              RowBox[{
              "idx", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
              ",", 
              RowBox[{
              "idx", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
              ",", 
              RowBox[{
              "idx", "\[LeftDoubleBracket]", "3", "\[RightDoubleBracket]"}]}],
              "]"}], 
            RowBox[{
            "A", "\[LeftDoubleBracket]", "jj", "\[RightDoubleBracket]"}], 
            RowBox[{
            "B", "\[LeftDoubleBracket]", "jj", "\[RightDoubleBracket]"}]}]}], 
          ";"}], "\[IndentingNewLine]", ",", 
         RowBox[{"{", 
          RowBox[{"jj", ",", "1", ",", "length"}], "}"}]}], "]"}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", "res"}]}], 
     "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]", 
  RowBox[{"(*", " ", 
   RowBox[{
   "symmetric", " ", "tensor", " ", "product", " ", "of", " ", "a", " ", 
    "symmetric", " ", "tensor", " ", "A", " ", "with", " ", 
    SubscriptBox["b", "i"]}], " ", "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"SymProduct2", "[", 
     RowBox[{"A_", ",", 
      RowBox[{"b_", "?", "VectorQ"}]}], "]"}], ":=", 
    RowBox[{"Block", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"dim", "=", "3"}], ",", "idx", ",", "idx1", ",", 
        RowBox[{"degree", "=", 
         RowBox[{"TensorDegree", "[", "A", "]"}]}], ",", "length", ",", 
        "res"}], "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"degree", "\[Equal]", "0"}], ",", 
         RowBox[{"Return", "[", 
          RowBox[{
           RowBox[{
           "A", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], " ", 
           "b"}], "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
       RowBox[{"length", "=", 
        RowBox[{"Length", "[", 
         RowBox[{"IDX", "[", 
          RowBox[{"degree", "+", "1"}], "]"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"res", "=", 
        RowBox[{"ConstantArray", "[", 
         RowBox[{"0", ",", "length"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"Do", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{
           "res", "\[LeftDoubleBracket]", "jj", "\[RightDoubleBracket]"}], 
           "=", "\[IndentingNewLine]", 
           RowBox[{
            FractionBox["1", 
             RowBox[{"degree", "+", "1"}]], 
            RowBox[{"Sum", "[", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{"idx", "=", 
                    RowBox[{
                    RowBox[{"IDX", "[", 
                    RowBox[{"degree", "+", "1"}], "]"}], 
                    "\[LeftDoubleBracket]", "jj", "\[RightDoubleBracket]"}]}],
                    ")"}], "\[LeftDoubleBracket]", "ii", 
                  "\[RightDoubleBracket]"}], ">", "0"}], ",", 
                RowBox[{
                 RowBox[{
                 "idx", "\[LeftDoubleBracket]", "ii", 
                  "\[RightDoubleBracket]"}], " ", 
                 RowBox[{"A", "\[LeftDoubleBracket]", 
                  RowBox[{"toIDX2", "[", 
                   RowBox[{"idx", "-", 
                    RowBox[{
                    "id3", "\[LeftDoubleBracket]", "ii", 
                    "\[RightDoubleBracket]"}]}], "]"}], 
                  "\[RightDoubleBracket]"}], 
                 RowBox[{
                 "b", "\[LeftDoubleBracket]", "ii", 
                  "\[RightDoubleBracket]"}]}], ",", "0"}], "]"}], ",", 
              RowBox[{"{", 
               RowBox[{"ii", ",", "1", ",", "dim"}], "}"}]}], "]"}]}]}], 
          ";"}], "\[IndentingNewLine]", ",", 
         RowBox[{"{", 
          RowBox[{"jj", ",", "1", ",", "length"}], "}"}]}], "]"}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", "res"}]}], 
     "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]", 
  RowBox[{"(*", " ", 
   RowBox[{
   "symmetric", " ", "tensor", " ", "product", " ", "of", " ", "a", " ", 
    "symmetric", " ", "tensor", " ", "A", " ", "with", " ", 
    SubscriptBox["\[Delta]", "ij"]}], " ", "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"SymProductDelta2", "[", "A_", "]"}], ":=", 
    RowBox[{"Block", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"dim", "=", "3"}], ",", "idx", ",", "idx1", ",", 
        RowBox[{"degree", "=", 
         RowBox[{"TensorDegree", "[", "A", "]"}]}], ",", "length", ",", 
        "res"}], "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"length", "=", 
        RowBox[{"Length", "[", 
         RowBox[{"IDX", "[", 
          RowBox[{"degree", "+", "2"}], "]"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"res", "=", 
        RowBox[{"ConstantArray", "[", 
         RowBox[{"0", ",", "length"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"Do", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{
           "res", "\[LeftDoubleBracket]", "jj", "\[RightDoubleBracket]"}], 
           "=", 
           RowBox[{
            FractionBox["1", 
             RowBox[{
              RowBox[{"(", 
               RowBox[{"degree", "+", "2"}], ")"}], 
              RowBox[{"(", 
               RowBox[{"degree", "+", "1"}], ")"}]}]], 
            RowBox[{"Sum", "[", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{"idx", "=", 
                    RowBox[{
                    RowBox[{"IDX", "[", 
                    RowBox[{"degree", "+", "2"}], "]"}], 
                    "\[LeftDoubleBracket]", "jj", "\[RightDoubleBracket]"}]}],
                    ")"}], "\[LeftDoubleBracket]", "ii", 
                  "\[RightDoubleBracket]"}], "\[GreaterEqual]", "2"}], ",", 
                RowBox[{
                 RowBox[{
                 "idx", "\[LeftDoubleBracket]", "ii", 
                  "\[RightDoubleBracket]"}], 
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{
                   "idx", "\[LeftDoubleBracket]", "ii", 
                    "\[RightDoubleBracket]"}], "-", "1"}], ")"}], 
                 RowBox[{"A", "\[LeftDoubleBracket]", 
                  RowBox[{"toIDX2", "[", 
                   RowBox[{"idx", "-", 
                    RowBox[{"2", 
                    RowBox[{
                    "id3", "\[LeftDoubleBracket]", "ii", 
                    "\[RightDoubleBracket]"}]}]}], "]"}], 
                  "\[RightDoubleBracket]"}]}], ",", "0"}], "]"}], ",", 
              RowBox[{"{", 
               RowBox[{"ii", ",", "1", ",", "dim"}], "}"}]}], "]"}]}]}], 
          ";"}], "\[IndentingNewLine]", ",", 
         RowBox[{"{", 
          RowBox[{"jj", ",", "1", ",", "length"}], "}"}]}], "]"}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", "res"}]}], 
     "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]", 
  RowBox[{"(*", " ", 
   RowBox[{
    RowBox[{
    "returns", " ", "the", " ", "tracefree", " ", "part", " ", "of", " ", "a",
      " ", "symmetric", " ", "tensor"}], ",", " ", 
    RowBox[{"but", " ", "with", " ", "all", " ", "components"}]}], " ", 
   "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"SymTracefree", "[", "A_", "]"}], ":=", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"dim", "=", "3"}], ",", "idx", ",", "idx1", ",", 
       RowBox[{"degree", "=", 
        RowBox[{"TensorDegree", "[", "A", "]"}]}], ",", "length", ",", "res", 
       ",", "trace", ",", "res1"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"length", "=", 
       RowBox[{"Length", "[", 
        RowBox[{"IDX", "[", "degree", "]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"res", "=", 
       RowBox[{"trace", "=", "A"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Do", "[", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"res1", "=", 
          RowBox[{"trace", "=", 
           RowBox[{"SymTrace2", "[", "trace", "]"}]}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"Do", "[", 
          RowBox[{
           RowBox[{"res1", "=", 
            RowBox[{"SymProductDelta2", "[", "res1", "]"}]}], ",", 
           RowBox[{"{", 
            RowBox[{"ll", ",", "1", ",", "kk"}], "}"}]}], "]"}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"res", "+=", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{
             FractionBox[
              RowBox[{
               SuperscriptBox[
                RowBox[{"(", 
                 RowBox[{"-", "1"}], ")"}], "kk"], 
               RowBox[{"degree", "!"}]}], 
              RowBox[{
               RowBox[{
                RowBox[{"(", 
                 RowBox[{"degree", "-", 
                  RowBox[{"2", "kk"}]}], ")"}], "!"}], 
               SuperscriptBox["2", "kk"], 
               RowBox[{"kk", "!"}]}]], 
             RowBox[{
              UnderoverscriptBox["\[Product]", 
               RowBox[{"jj", "=", 
                RowBox[{"degree", "-", "kk"}]}], 
               RowBox[{"degree", "-", "1"}]], 
              FractionBox["1", 
               RowBox[{
                RowBox[{"2", "jj"}], "+", "1"}]]}]}], ")"}], "res1"}]}], 
         ";"}], "\[IndentingNewLine]", ",", 
        RowBox[{"{", 
         RowBox[{"kk", ",", "1", ",", 
          RowBox[{"degree", "/", "2"}]}], "}"}]}], "]"}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", "res"}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.5977647060562134`*^9, 3.5977647268750763`*^9}, {
  3.597764982828605*^9, 3.5977649884363317`*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"trfEvaluate", "[", 
    RowBox[{"A_", ",", "list_"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"a", ",", "b", ",", "c", ",", "m", ",", 
       RowBox[{"dim", "=", "3"}], ",", 
       RowBox[{"degree", "=", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{
           RowBox[{"Length", "[", "A", "]"}], "-", "1"}], ")"}], "/", "2"}]}],
        ",", "length", ",", "res"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{
       RowBox[{"{", 
        RowBox[{"a", ",", "b", ",", "c"}], "}"}], "=", "list"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"m", "=", 
       RowBox[{"Floor", "[", 
        RowBox[{"c", "/", "2"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"c", "\[LessEqual]", "1"}], ",", "\[IndentingNewLine]", 
        RowBox[{"res", "=", 
         RowBox[{"A", "\[LeftDoubleBracket]", 
          RowBox[{"toIDX3", "[", "list", "]"}], "\[RightDoubleBracket]"}]}], 
        ",", "\[IndentingNewLine]", 
        RowBox[{"res", "=", 
         RowBox[{
          SuperscriptBox[
           RowBox[{"(", 
            RowBox[{"-", "1"}], ")"}], "m"], 
          RowBox[{"Sum", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"Binomial", "[", 
              RowBox[{"m", ",", "i"}], "]"}], 
             RowBox[{"A", "\[LeftDoubleBracket]", 
              RowBox[{"toIDX3", "[", 
               RowBox[{"list", "+", 
                RowBox[{"2", "i", " ", 
                 RowBox[{
                 "id3", "\[LeftDoubleBracket]", "1", 
                  "\[RightDoubleBracket]"}]}], "+", 
                RowBox[{"2", 
                 RowBox[{"(", 
                  RowBox[{"m", "-", "i"}], ")"}], " ", 
                 RowBox[{
                 "id3", "\[LeftDoubleBracket]", "2", 
                  "\[RightDoubleBracket]"}]}], "-", 
                RowBox[{"2", "m", " ", 
                 RowBox[{
                 "id3", "\[LeftDoubleBracket]", "3", 
                  "\[RightDoubleBracket]"}]}]}], "]"}], 
              "\[RightDoubleBracket]"}]}], ",", 
            RowBox[{"{", 
             RowBox[{"i", ",", "0", ",", "m"}], "}"}]}], "]"}]}]}]}], 
       "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", "res"}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"trf2sym", "[", "A_", "]"}], ":=", 
  RowBox[{"Map", "[", 
   RowBox[{
    RowBox[{
     RowBox[{"Apply", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"trfEvaluate", "[", 
         RowBox[{"A", ",", 
          RowBox[{"{", 
           RowBox[{"#1", ",", "#2", ",", "#3"}], "}"}]}], "]"}], "&"}], ",", 
       "#"}], "]"}], "&"}], ",", 
    RowBox[{"IDX", "[", 
     RowBox[{
      RowBox[{"(", 
       RowBox[{
        RowBox[{"Length", "[", "A", "]"}], "-", "1"}], ")"}], "/", "2"}], 
     "]"}]}], "]"}]}]}], "Input",
 CellChangeTimes->{{3.592214156581615*^9, 3.5922142269069633`*^9}, {
  3.592214273648*^9, 3.592214321643592*^9}, {3.592214562691799*^9, 
  3.5922146307578783`*^9}, {3.5922150087114487`*^9, 3.5922151927530117`*^9}, {
  3.592215226866392*^9, 3.592215227208199*^9}, {3.5922152622517147`*^9, 
  3.592215315308941*^9}, {3.592215349687686*^9, 3.592215358801886*^9}, {
  3.59221558179191*^9, 3.592215608488448*^9}, {3.592215669267857*^9, 
  3.592215699095985*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"SymTensorForm", "[", "A_", "]"}], ":=", 
    RowBox[{"Block", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"degree", "=", 
         RowBox[{"TensorDegree", "[", "A", "]"}]}], ",", "length"}], "}"}], 
      ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"length", "=", 
        RowBox[{"Length", "[", 
         RowBox[{"IDX", "[", "degree", "]"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{"Apply", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"{", 
              RowBox[{
               RowBox[{"$", "[", 
                RowBox[{"#1", ",", "#2", ",", "#3"}], "]"}], ",", 
               RowBox[{
               "A", "\[LeftDoubleBracket]", "ii", "\[RightDoubleBracket]"}]}],
               "}"}], "&"}], ",", 
            RowBox[{
             RowBox[{"IDX", "[", "degree", "]"}], "\[LeftDoubleBracket]", 
             "ii", "\[RightDoubleBracket]"}]}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"ii", ",", "1", ",", "length"}], "}"}]}], "]"}], "//", 
        "TableForm"}]}]}], "\[IndentingNewLine]", "]"}]}], ";"}], 
  "\[IndentingNewLine]", "\[IndentingNewLine]"}]], "Input",
 CellChangeTimes->{{3.59211253078022*^9, 3.592112545437512*^9}, {
   3.5921125805422792`*^9, 3.5921127616337748`*^9}, {3.592112796427103*^9, 
   3.5921128146670732`*^9}, 3.597764731152925*^9}],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"SymProductDelta2", "[", 
  RowBox[{"SymProductDelta2", "[", 
   RowBox[{"SymProductDelta2", "[", 
    RowBox[{"Map", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"Apply", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"A", "[", 
           RowBox[{"#1", ",", "#2", ",", "#3"}], "]"}], "&"}], ",", "#"}], 
        "]"}], "&"}], ",", 
      RowBox[{"IDX", "[", "1", "]"}]}], "]"}], "]"}], "]"}], "]"}]], "Input",
 CellChangeTimes->{{3.591516209179254*^9, 3.591516237845764*^9}, {
  3.591516279723213*^9, 3.591516319002157*^9}}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"A", "[", 
    RowBox[{"1", ",", "0", ",", "0"}], "]"}], ",", 
   RowBox[{
    FractionBox["1", "7"], " ", 
    RowBox[{"A", "[", 
     RowBox[{"0", ",", "1", ",", "0"}], "]"}]}], ",", 
   RowBox[{
    FractionBox["1", "7"], " ", 
    RowBox[{"A", "[", 
     RowBox[{"0", ",", "0", ",", "1"}], "]"}]}], ",", 
   RowBox[{
    FractionBox["1", "7"], " ", 
    RowBox[{"A", "[", 
     RowBox[{"1", ",", "0", ",", "0"}], "]"}]}], ",", "0", ",", 
   RowBox[{
    FractionBox["1", "7"], " ", 
    RowBox[{"A", "[", 
     RowBox[{"1", ",", "0", ",", "0"}], "]"}]}], ",", 
   RowBox[{
    FractionBox["3", "35"], " ", 
    RowBox[{"A", "[", 
     RowBox[{"0", ",", "1", ",", "0"}], "]"}]}], ",", 
   RowBox[{
    FractionBox["1", "35"], " ", 
    RowBox[{"A", "[", 
     RowBox[{"0", ",", "0", ",", "1"}], "]"}]}], ",", 
   RowBox[{
    FractionBox["1", "35"], " ", 
    RowBox[{"A", "[", 
     RowBox[{"0", ",", "1", ",", "0"}], "]"}]}], ",", 
   RowBox[{
    FractionBox["3", "35"], " ", 
    RowBox[{"A", "[", 
     RowBox[{"0", ",", "0", ",", "1"}], "]"}]}], ",", 
   RowBox[{
    FractionBox["3", "35"], " ", 
    RowBox[{"A", "[", 
     RowBox[{"1", ",", "0", ",", "0"}], "]"}]}], ",", "0", ",", 
   RowBox[{
    FractionBox["1", "35"], " ", 
    RowBox[{"A", "[", 
     RowBox[{"1", ",", "0", ",", "0"}], "]"}]}], ",", "0", ",", 
   RowBox[{
    FractionBox["3", "35"], " ", 
    RowBox[{"A", "[", 
     RowBox[{"1", ",", "0", ",", "0"}], "]"}]}], ",", 
   RowBox[{
    FractionBox["1", "7"], " ", 
    RowBox[{"A", "[", 
     RowBox[{"0", ",", "1", ",", "0"}], "]"}]}], ",", 
   RowBox[{
    FractionBox["1", "35"], " ", 
    RowBox[{"A", "[", 
     RowBox[{"0", ",", "0", ",", "1"}], "]"}]}], ",", 
   RowBox[{
    FractionBox["1", "35"], " ", 
    RowBox[{"A", "[", 
     RowBox[{"0", ",", "1", ",", "0"}], "]"}]}], ",", 
   RowBox[{
    FractionBox["1", "35"], " ", 
    RowBox[{"A", "[", 
     RowBox[{"0", ",", "0", ",", "1"}], "]"}]}], ",", 
   RowBox[{
    FractionBox["1", "35"], " ", 
    RowBox[{"A", "[", 
     RowBox[{"0", ",", "1", ",", "0"}], "]"}]}], ",", 
   RowBox[{
    FractionBox["1", "7"], " ", 
    RowBox[{"A", "[", 
     RowBox[{"0", ",", "0", ",", "1"}], "]"}]}], ",", 
   RowBox[{
    FractionBox["1", "7"], " ", 
    RowBox[{"A", "[", 
     RowBox[{"1", ",", "0", ",", "0"}], "]"}]}], ",", "0", ",", 
   RowBox[{
    FractionBox["1", "35"], " ", 
    RowBox[{"A", "[", 
     RowBox[{"1", ",", "0", ",", "0"}], "]"}]}], ",", "0", ",", 
   RowBox[{
    FractionBox["1", "35"], " ", 
    RowBox[{"A", "[", 
     RowBox[{"1", ",", "0", ",", "0"}], "]"}]}], ",", "0", ",", 
   RowBox[{
    FractionBox["1", "7"], " ", 
    RowBox[{"A", "[", 
     RowBox[{"1", ",", "0", ",", "0"}], "]"}]}], ",", 
   RowBox[{"A", "[", 
    RowBox[{"0", ",", "1", ",", "0"}], "]"}], ",", 
   RowBox[{
    FractionBox["1", "7"], " ", 
    RowBox[{"A", "[", 
     RowBox[{"0", ",", "0", ",", "1"}], "]"}]}], ",", 
   RowBox[{
    FractionBox["1", "7"], " ", 
    RowBox[{"A", "[", 
     RowBox[{"0", ",", "1", ",", "0"}], "]"}]}], ",", 
   RowBox[{
    FractionBox["3", "35"], " ", 
    RowBox[{"A", "[", 
     RowBox[{"0", ",", "0", ",", "1"}], "]"}]}], ",", 
   RowBox[{
    FractionBox["3", "35"], " ", 
    RowBox[{"A", "[", 
     RowBox[{"0", ",", "1", ",", "0"}], "]"}]}], ",", 
   RowBox[{
    FractionBox["1", "7"], " ", 
    RowBox[{"A", "[", 
     RowBox[{"0", ",", "0", ",", "1"}], "]"}]}], ",", 
   RowBox[{
    FractionBox["1", "7"], " ", 
    RowBox[{"A", "[", 
     RowBox[{"0", ",", "1", ",", "0"}], "]"}]}], ",", 
   RowBox[{"A", "[", 
    RowBox[{"0", ",", "0", ",", "1"}], "]"}]}], "}"}]], "Output",
 CellChangeTimes->{3.681211054346366*^9, 3.682049106072267*^9, 
  3.7021967045927563`*^9, 3.702199562512314*^9, 3.702200877815426*^9, 
  3.702225110636312*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"Expand", "[", 
  RowBox[{"SymTracefree", "[", 
   RowBox[{"Map", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"Apply", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"A", "[", 
          RowBox[{"#1", ",", "#2", ",", "#3"}], "]"}], "&"}], ",", "#"}], 
       "]"}], "&"}], ",", 
     RowBox[{"IDX", "[", "3", "]"}]}], "]"}], "]"}], "]"}]], "Input",
 CellChangeTimes->{{3.591517786313066*^9, 3.5915178359472446`*^9}, {
  3.591517885949567*^9, 3.591517930610208*^9}, {3.5977650183992825`*^9, 
  3.597765018845586*^9}}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"-", 
      FractionBox["3", "5"]}], " ", 
     RowBox[{"A", "[", 
      RowBox[{"1", ",", "0", ",", "2"}], "]"}]}], "-", 
    RowBox[{
     FractionBox["3", "5"], " ", 
     RowBox[{"A", "[", 
      RowBox[{"1", ",", "2", ",", "0"}], "]"}]}], "+", 
    RowBox[{
     FractionBox["2", "5"], " ", 
     RowBox[{"A", "[", 
      RowBox[{"3", ",", "0", ",", "0"}], "]"}]}]}], ",", 
   RowBox[{
    RowBox[{
     RowBox[{"-", 
      FractionBox["1", "5"]}], " ", 
     RowBox[{"A", "[", 
      RowBox[{"0", ",", "1", ",", "2"}], "]"}]}], "-", 
    RowBox[{
     FractionBox["1", "5"], " ", 
     RowBox[{"A", "[", 
      RowBox[{"0", ",", "3", ",", "0"}], "]"}]}], "+", 
    RowBox[{
     FractionBox["4", "5"], " ", 
     RowBox[{"A", "[", 
      RowBox[{"2", ",", "1", ",", "0"}], "]"}]}]}], ",", 
   RowBox[{
    RowBox[{
     RowBox[{"-", 
      FractionBox["1", "5"]}], " ", 
     RowBox[{"A", "[", 
      RowBox[{"0", ",", "0", ",", "3"}], "]"}]}], "-", 
    RowBox[{
     FractionBox["1", "5"], " ", 
     RowBox[{"A", "[", 
      RowBox[{"0", ",", "2", ",", "1"}], "]"}]}], "+", 
    RowBox[{
     FractionBox["4", "5"], " ", 
     RowBox[{"A", "[", 
      RowBox[{"2", ",", "0", ",", "1"}], "]"}]}]}], ",", 
   RowBox[{
    RowBox[{
     RowBox[{"-", 
      FractionBox["1", "5"]}], " ", 
     RowBox[{"A", "[", 
      RowBox[{"1", ",", "0", ",", "2"}], "]"}]}], "+", 
    RowBox[{
     FractionBox["4", "5"], " ", 
     RowBox[{"A", "[", 
      RowBox[{"1", ",", "2", ",", "0"}], "]"}]}], "-", 
    RowBox[{
     FractionBox["1", "5"], " ", 
     RowBox[{"A", "[", 
      RowBox[{"3", ",", "0", ",", "0"}], "]"}]}]}], ",", 
   RowBox[{"A", "[", 
    RowBox[{"1", ",", "1", ",", "1"}], "]"}], ",", 
   RowBox[{
    RowBox[{
     FractionBox["4", "5"], " ", 
     RowBox[{"A", "[", 
      RowBox[{"1", ",", "0", ",", "2"}], "]"}]}], "-", 
    RowBox[{
     FractionBox["1", "5"], " ", 
     RowBox[{"A", "[", 
      RowBox[{"1", ",", "2", ",", "0"}], "]"}]}], "-", 
    RowBox[{
     FractionBox["1", "5"], " ", 
     RowBox[{"A", "[", 
      RowBox[{"3", ",", "0", ",", "0"}], "]"}]}]}], ",", 
   RowBox[{
    RowBox[{
     RowBox[{"-", 
      FractionBox["3", "5"]}], " ", 
     RowBox[{"A", "[", 
      RowBox[{"0", ",", "1", ",", "2"}], "]"}]}], "+", 
    RowBox[{
     FractionBox["2", "5"], " ", 
     RowBox[{"A", "[", 
      RowBox[{"0", ",", "3", ",", "0"}], "]"}]}], "-", 
    RowBox[{
     FractionBox["3", "5"], " ", 
     RowBox[{"A", "[", 
      RowBox[{"2", ",", "1", ",", "0"}], "]"}]}]}], ",", 
   RowBox[{
    RowBox[{
     RowBox[{"-", 
      FractionBox["1", "5"]}], " ", 
     RowBox[{"A", "[", 
      RowBox[{"0", ",", "0", ",", "3"}], "]"}]}], "+", 
    RowBox[{
     FractionBox["4", "5"], " ", 
     RowBox[{"A", "[", 
      RowBox[{"0", ",", "2", ",", "1"}], "]"}]}], "-", 
    RowBox[{
     FractionBox["1", "5"], " ", 
     RowBox[{"A", "[", 
      RowBox[{"2", ",", "0", ",", "1"}], "]"}]}]}], ",", 
   RowBox[{
    RowBox[{
     FractionBox["4", "5"], " ", 
     RowBox[{"A", "[", 
      RowBox[{"0", ",", "1", ",", "2"}], "]"}]}], "-", 
    RowBox[{
     FractionBox["1", "5"], " ", 
     RowBox[{"A", "[", 
      RowBox[{"0", ",", "3", ",", "0"}], "]"}]}], "-", 
    RowBox[{
     FractionBox["1", "5"], " ", 
     RowBox[{"A", "[", 
      RowBox[{"2", ",", "1", ",", "0"}], "]"}]}]}], ",", 
   RowBox[{
    RowBox[{
     FractionBox["2", "5"], " ", 
     RowBox[{"A", "[", 
      RowBox[{"0", ",", "0", ",", "3"}], "]"}]}], "-", 
    RowBox[{
     FractionBox["3", "5"], " ", 
     RowBox[{"A", "[", 
      RowBox[{"0", ",", "2", ",", "1"}], "]"}]}], "-", 
    RowBox[{
     FractionBox["3", "5"], " ", 
     RowBox[{"A", "[", 
      RowBox[{"2", ",", "0", ",", "1"}], "]"}]}]}]}], "}"}]], "Output",
 CellChangeTimes->{3.682049106131246*^9, 3.702196704635716*^9, 
  3.702199562544593*^9, 3.702200877857851*^9, 3.702225110687029*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"Expand", "[", 
  RowBox[{"SymTracefree", "[", 
   RowBox[{"Map", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"Apply", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"#1", "+", 
          RowBox[{"2.", "#2"}], "-", 
          RowBox[{"3", "#3"}]}], "&"}], ",", "#"}], "]"}], "&"}], ",", 
     RowBox[{"IDX", "[", "4", "]"}]}], "]"}], "]"}], "]"}]], "Input",
 CellChangeTimes->{{3.591516796847253*^9, 3.591516813094841*^9}, {
   3.5915174393368073`*^9, 3.5915174614075623`*^9}, {3.59151750012652*^9, 
   3.59151776014233*^9}, {3.591517814794807*^9, 3.5915178185262527`*^9}, {
   3.591517860691409*^9, 3.5915178802347727`*^9}, 3.591518123963479*^9, {
   3.5915182744621964`*^9, 3.591518302569395*^9}, {3.591526482595047*^9, 
   3.5915265043240232`*^9}, {3.591611217481101*^9, 3.591611231450076*^9}, {
   3.597765011088415*^9, 3.5977650116257725`*^9}}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"-", "1.1428571428571423`"}], ",", "1.1428571428571432`", ",", 
   "2.571428571428571`", ",", "3.428571428571429`", ",", 
   "1.4285714285714286`", ",", 
   RowBox[{"-", "2.2857142857142856`"}], ",", "3.1428571428571432`", ",", 
   "2.857142857142857`", ",", 
   RowBox[{"-", "4.285714285714286`"}], ",", 
   RowBox[{"-", "5.428571428571429`"}], ",", 
   RowBox[{"-", "2.2857142857142847`"}], ",", "4.285714285714286`", ",", 
   RowBox[{"-", "1.1428571428571428`"}], ",", 
   RowBox[{"-", "5.714285714285714`"}], ",", "3.428571428571427`"}], 
  "}"}]], "Output",
 CellChangeTimes->{3.6820491061587133`*^9, 3.702196704679426*^9, 
  3.702199562597137*^9, 3.70220087791109*^9, 3.702225110743855*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"Expand", "[", 
  RowBox[{"SymFullDot", "[", 
   RowBox[{
    RowBox[{"SymTracefree", "[", 
     RowBox[{"trf2sym", "[", 
      RowBox[{"{", 
       RowBox[{"Rxx", ",", "Rxy", ",", "0", ",", "Ryy", ",", "0"}], "}"}], 
      "]"}], "]"}], ",", 
    RowBox[{"SymTracefree", "[", 
     RowBox[{"trf2sym", "[", 
      RowBox[{"{", 
       RowBox[{"Sxx", ",", "Sxy", ",", "0", ",", "Syy", ",", "0"}], "}"}], 
      "]"}], "]"}]}], "]"}], "]"}]], "Input"],

Cell[BoxData[
 RowBox[{
  RowBox[{"2", " ", "Rxx", " ", "Sxx"}], "+", 
  RowBox[{"Ryy", " ", "Sxx"}], "+", 
  RowBox[{"2", " ", "Rxy", " ", "Sxy"}], "+", 
  RowBox[{"Rxx", " ", "Syy"}], "+", 
  RowBox[{"2", " ", "Ryy", " ", "Syy"}]}]], "Output",
 CellChangeTimes->{3.682049106201951*^9, 3.702196704728291*^9, 
  3.702199562646119*^9, 3.70220087796801*^9, 3.702225110792193*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"Normal", "[", 
  RowBox[{
   RowBox[{"CoefficientArrays", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"Normal", "[", 
       RowBox[{"CoefficientArrays", "[", 
        RowBox[{
         RowBox[{"Expand", "[", 
          RowBox[{"SymFullDot", "[", 
           RowBox[{
            RowBox[{"SymTracefree", "[", 
             RowBox[{"trf2sym", "[", 
              RowBox[{"{", 
               RowBox[{"Rxx", ",", "Rxy", ",", "0", ",", "Ryy", ",", "0"}], 
               "}"}], "]"}], "]"}], ",", 
            RowBox[{"SymTracefree", "[", 
             RowBox[{"trf2sym", "[", 
              RowBox[{"{", 
               RowBox[{"Sxx", ",", "Sxy", ",", "0", ",", "Syy", ",", "0"}], 
               "}"}], "]"}], "]"}]}], "]"}], "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"Rxx", ",", "Rxy", ",", "Ryy"}], "}"}]}], "]"}], "]"}], 
      "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], ",", 
     RowBox[{"{", 
      RowBox[{"Sxx", ",", "Sxy", ",", "Syy"}], "}"}]}], "]"}], 
   "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], "]"}]], "Input",
 CellChangeTimes->{{3.656604952688126*^9, 3.656605038854427*^9}, {
  3.656605091139191*^9, 3.6566052689034147`*^9}}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{"2", ",", "0", ",", "1"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"0", ",", "2", ",", "0"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"1", ",", "0", ",", "2"}], "}"}]}], "}"}]], "Output",
 CellChangeTimes->{3.682049106252301*^9, 3.702196704774378*^9, 
  3.702199562695034*^9, 3.702200878022978*^9, 3.702225110838168*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"Normal", "[", 
  RowBox[{
   RowBox[{"CoefficientArrays", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"Normal", "[", 
       RowBox[{"CoefficientArrays", "[", 
        RowBox[{
         RowBox[{"Expand", "[", 
          RowBox[{"SymFullDot", "[", 
           RowBox[{
            RowBox[{"SymTracefree", "[", 
             RowBox[{"trf2sym", "[", 
              RowBox[{"{", 
               RowBox[{
               "mxxx", ",", "mxxy", ",", "0", ",", "mxyy", ",", "0", ",", 
                "myyy", ",", "0"}], "}"}], "]"}], "]"}], ",", 
            RowBox[{"SymTracefree", "[", 
             RowBox[{"trf2sym", "[", 
              RowBox[{"{", 
               RowBox[{
               "nxxx", ",", "nxxy", ",", "0", ",", "nxyy", ",", "0", ",", 
                "nyyy", ",", "0"}], "}"}], "]"}], "]"}]}], "]"}], "]"}], ",", 
         
         RowBox[{"{", 
          RowBox[{"mxxx", ",", "mxxy", ",", "mxyy", ",", "myyy"}], "}"}]}], 
        "]"}], "]"}], "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
     ",", 
     RowBox[{"{", 
      RowBox[{"nxxx", ",", "nxxy", ",", "nxyy", ",", "nyyy"}], "}"}]}], "]"}],
    "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], "]"}]], "Input",
 CellChangeTimes->{{3.656604952688126*^9, 3.656605038854427*^9}, {
  3.656605091139191*^9, 3.6566052689034147`*^9}, {3.656607710425463*^9, 
  3.656607745128602*^9}}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{"4", ",", "0", ",", "3", ",", "0"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"0", ",", "6", ",", "0", ",", "3"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"3", ",", "0", ",", "6", ",", "0"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"0", ",", "3", ",", "0", ",", "4"}], "}"}]}], "}"}]], "Output",
 CellChangeTimes->{3.682049106308062*^9, 3.702196704828794*^9, 
  3.702199562741037*^9, 3.702200878072926*^9, 3.702225110888072*^9}]
}, Open  ]]
}, Closed]],

Cell[CellGroupData[{

Cell["Equations Definitions", "Section"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"iFullDegree", "[", "i_", "]"}], "=", 
   RowBox[{"Floor", "[", 
    RowBox[{
     SqrtBox[
      RowBox[{
       RowBox[{"4", "i"}], "-", "3"}]], "-", "1"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"iTraces", "[", "i_", "]"}], "=", 
   RowBox[{
    RowBox[{"Floor", "[", 
     SuperscriptBox[
      RowBox[{"(", 
       RowBox[{"1", "+", 
        RowBox[{
         FractionBox["1", "2"], 
         RowBox[{"iFullDegree", "[", "i", "]"}]}]}], ")"}], "2"], "]"}], "-", 
    "i"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"iTensorDegree", "[", "i_", "]"}], "=", 
   RowBox[{
    RowBox[{"iFullDegree", "[", "i", "]"}], "-", 
    RowBox[{"2", 
     RowBox[{"iTraces", "[", "i", "]"}]}]}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"ii", "[", 
     RowBox[{"s_", ",", "A_"}], "]"}], "=", 
    RowBox[{
     RowBox[{
      RowBox[{"Floor", "[", 
       FractionBox[
        RowBox[{"A", "+", 
         RowBox[{"2", 
          RowBox[{"(", 
           RowBox[{"s", "+", "1"}], ")"}]}]}], "2"], "]"}], 
      RowBox[{"(", 
       RowBox[{"A", "+", 
        RowBox[{"2", 
         RowBox[{"(", 
          RowBox[{"s", "+", "1"}], ")"}]}], "-", 
        RowBox[{"Floor", "[", 
         FractionBox[
          RowBox[{"A", "+", 
           RowBox[{"2", 
            RowBox[{"(", 
             RowBox[{"s", "+", "1"}], ")"}]}]}], "2"], "]"}]}], ")"}]}], "-", 
     "s"}]}], ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"NumberOfVariables2D", "[", "ntensors_", "]"}], ":=", 
   RowBox[{"Sum", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"iTensorDegree", "[", "i", "]"}], "+", "1"}], ",", 
     RowBox[{"{", 
      RowBox[{"i", ",", "1", ",", "ntensors"}], "}"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"NumberOfVariables3D", "[", "ntensors_", "]"}], ":=", 
   RowBox[{"Sum", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"2", 
       RowBox[{"iTensorDegree", "[", "i", "]"}]}], "+", "1"}], ",", 
     RowBox[{"{", 
      RowBox[{"i", ",", "1", ",", "ntensors"}], "}"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"NumberOfFullTensors3D", "[", "ntensors_", "]"}], ":=", 
    RowBox[{"Block", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"m", "=", 
         RowBox[{"iFullDegree", "[", "ntensors", "]"}]}], ",", "frac"}], 
       "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{"m", "-", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{
          FractionBox[
           RowBox[{
            RowBox[{"(", 
             RowBox[{"m", "+", "1"}], ")"}], 
            RowBox[{"(", 
             RowBox[{"m", "+", "2"}], ")"}], 
            RowBox[{"(", 
             RowBox[{"m", "+", "3"}], ")"}]}], "6."], "-", 
          RowBox[{"Sum", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"2", 
              RowBox[{"iTensorDegree", "[", "i", "]"}]}], "+", "1"}], ",", 
            RowBox[{"{", 
             RowBox[{"i", ",", "1", ",", "ntensors"}], "}"}]}], "]"}]}], 
         ")"}], "/", 
        RowBox[{"(", 
         FractionBox[
          RowBox[{
           RowBox[{"(", 
            RowBox[{"m", "+", "1"}], ")"}], 
           RowBox[{"(", 
            RowBox[{"m", "+", "2"}], ")"}]}], "2"], ")"}]}]}]}], 
     "\[IndentingNewLine]", "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"varName", "[", 
    RowBox[{"s_", ",", "ix_", ",", "iy_", ",", "iz_"}], "]"}], ":=", 
   RowBox[{"StringJoin", "[", 
    RowBox[{"\"\<\[Rho]\>\"", ",", 
     RowBox[{"ToString", "[", "s", "]"}], ",", 
     RowBox[{"ConstantArray", "[", 
      RowBox[{"\"\<x\>\"", ",", "ix"}], "]"}], ",", 
     RowBox[{"ConstantArray", "[", 
      RowBox[{"\"\<y\>\"", ",", "iy"}], "]"}], ",", 
     RowBox[{"ConstantArray", "[", 
      RowBox[{"\"\<z\>\"", ",", "iz"}], "]"}]}], "]"}]}], 
  "\[IndentingNewLine]", "\[IndentingNewLine]", "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
   "Norm", " ", "of", " ", "\[Psi]", " ", "or", " ", "can", " ", "also", " ", 
    "be", " ", "looked", " ", "upon", " ", "as", " ", "the", " ", "norm", " ",
     "of", " ", "the", " ", "Laguerre", " ", "polynomial"}], 
   "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Norm\[Psi]", "[", 
     RowBox[{"a_", ",", "deg_"}], "]"}], "=", 
    FractionBox[
     RowBox[{
      RowBox[{"deg", "!"}], 
      RowBox[{"a", "!"}], 
      RowBox[{"Gamma", "[", 
       RowBox[{"deg", "+", "a", "+", 
        RowBox[{"3", "/", "2"}]}], "]"}]}], 
     RowBox[{"Gamma", "[", 
      RowBox[{"deg", "+", 
       RowBox[{"3", "/", "2"}]}], "]"}]]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"trfComponents2D", "[", "W_", "]"}], ":=", 
  RowBox[{"Extract", "[", 
   RowBox[{"W", ",", 
    RowBox[{"Map", "[", 
     RowBox[{
      RowBox[{
       RowBox[{
        RowBox[{"Position", "[", 
         RowBox[{
          RowBox[{"IDX", "[", 
           RowBox[{"TensorDegree", "[", "W", "]"}], "]"}], ",", "#"}], "]"}], 
        "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], "&"}], ",", 
      RowBox[{"Pick", "[", 
       RowBox[{
        RowBox[{"IDXtrf", "[", 
         RowBox[{"TensorDegree", "[", "W", "]"}], "]"}], ",", 
        RowBox[{"Flatten", "[", 
         RowBox[{"Join", "[", 
          RowBox[{
           RowBox[{"{", "1", "}"}], ",", 
           RowBox[{"Table", "[", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"1", ",", "0"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"k", ",", "1", ",", 
               RowBox[{"TensorDegree", "[", "W", "]"}]}], "}"}]}], "]"}]}], 
          "]"}], "]"}], ",", "1"}], "]"}]}], "]"}]}], 
   "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"trfVar2D", "[", 
   RowBox[{"deg_", ",", "name_"}], "]"}], ":=", 
  RowBox[{"Table", "[", 
   RowBox[{
    RowBox[{"name", "[", "i", "]"}], ",", 
    RowBox[{"{", 
     RowBox[{"i", ",", "1", ",", 
      RowBox[{"deg", "+", "1"}]}], "}"}]}], "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"From2Dto3D", "[", "list_", "]"}], ":=", 
   RowBox[{"Flatten", "[", 
    RowBox[{"Join", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"list", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}],
        "}"}], ",", 
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{
          "list", "\[LeftDoubleBracket]", "k", "\[RightDoubleBracket]"}], ",",
           "0"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"k", ",", "2", ",", 
          RowBox[{"Length", "[", "list", "]"}]}], "}"}]}], "]"}]}], "]"}], 
    "]"}]}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"R2", "[", 
    RowBox[{"0", ",", "1"}], "]"}], "=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", "1", "}"}], ",", 
     RowBox[{"{", "0", "}"}]}], "}"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"R2", "[", 
     RowBox[{"0", ",", "2"}], "]"}], "=", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", "0", "}"}], ",", 
      RowBox[{"{", "1", "}"}]}], "}"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Do", "[", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{
      RowBox[{"tmp", "=", 
       RowBox[{
        RowBox[{"Normal", "[", 
         RowBox[{"CoefficientArrays", "[", 
          RowBox[{
           RowBox[{"trfComponents2D", "[", 
            RowBox[{"SymDot2", "[", 
             RowBox[{
              RowBox[{"trf2sym", "[", 
               RowBox[{"From2Dto3D", "[", 
                RowBox[{"trfVar2D", "[", 
                 RowBox[{"d", ",", "B"}], "]"}], "]"}], "]"}], ",", 
              RowBox[{"{", 
               RowBox[{"dx", ",", "dy", ",", "0"}], "}"}]}], "]"}], "]"}], 
           ",", 
           RowBox[{"{", 
            RowBox[{"dx", ",", "dy"}], "}"}]}], "]"}], "]"}], 
        "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Do", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"R1", "[", 
          RowBox[{"d", ",", "i"}], "]"}], "=", 
         RowBox[{
          RowBox[{"CoefficientArrays", "[", 
           RowBox[{
            RowBox[{"tmp", "\[LeftDoubleBracket]", 
             RowBox[{"All", ",", "i"}], "\[RightDoubleBracket]"}], ",", 
            RowBox[{"trfVar2D", "[", 
             RowBox[{"d", ",", "B"}], "]"}]}], "]"}], "\[LeftDoubleBracket]", 
          "2", "\[RightDoubleBracket]"}]}], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", "1", ",", "2"}], "}"}]}], "]"}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"tmp", "=", 
       RowBox[{
        RowBox[{"Normal", "[", 
         RowBox[{"CoefficientArrays", "[", 
          RowBox[{
           RowBox[{"trfComponents2D", "[", 
            RowBox[{"SymTracefree", "[", 
             RowBox[{"SymProduct2", "[", 
              RowBox[{
               RowBox[{"trf2sym", "[", 
                RowBox[{"From2Dto3D", "[", 
                 RowBox[{"trfVar2D", "[", 
                  RowBox[{"d", ",", "B"}], "]"}], "]"}], "]"}], ",", 
               RowBox[{"{", 
                RowBox[{"dx", ",", "dy", ",", "0"}], "}"}]}], "]"}], "]"}], 
            "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"dx", ",", "dy"}], "}"}]}], "]"}], "]"}], 
        "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Do", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"R2", "[", 
          RowBox[{"d", ",", "i"}], "]"}], "=", 
         RowBox[{
          RowBox[{"CoefficientArrays", "[", 
           RowBox[{
            RowBox[{"tmp", "\[LeftDoubleBracket]", 
             RowBox[{"All", ",", "i"}], "\[RightDoubleBracket]"}], ",", 
            RowBox[{"trfVar2D", "[", 
             RowBox[{"d", ",", "B"}], "]"}]}], "]"}], "\[LeftDoubleBracket]", 
          "2", "\[RightDoubleBracket]"}]}], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", "1", ",", "2"}], "}"}]}], "]"}], ";"}], 
     "\[IndentingNewLine]", ",", 
     RowBox[{"{", 
      RowBox[{"d", ",", "1", ",", "15"}], "}"}]}], "]"}], ";"}], 
  "\[IndentingNewLine]", "\[IndentingNewLine]", "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{"Old", " ", "Recursion", " ", "formulae"}], 
   "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"recursion1", "[", 
    RowBox[{"a_", ",", "deg_", ",", "flag_"}], "]"}], ":=", 
   RowBox[{"(", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{
      RowBox[{"R1", "[", 
       RowBox[{
        RowBox[{"deg", "+", "1"}], ",", "flag"}], "]"}], ".", 
      RowBox[{"trfVar2D", "[", 
       RowBox[{
        RowBox[{"deg", "+", "1"}], ",", 
        RowBox[{
         RowBox[{"\[Psi]", "[", 
          RowBox[{"#", ",", "a", ",", 
           RowBox[{"deg", "+", "1"}]}], "]"}], "&"}]}], "]"}]}], "-", 
     RowBox[{"a", " ", 
      RowBox[{
       RowBox[{"R1", "[", 
        RowBox[{
         RowBox[{"deg", "+", "1"}], ",", "flag"}], "]"}], ".", 
       RowBox[{"trfVar2D", "[", 
        RowBox[{
         RowBox[{"deg", "+", "1"}], ",", 
         RowBox[{
          RowBox[{"\[Psi]", "[", 
           RowBox[{"#", ",", 
            RowBox[{"a", "-", "1"}], ",", 
            RowBox[{"deg", "+", "1"}]}], "]"}], "&"}]}], "]"}]}]}], 
     "\[IndentingNewLine]", "+", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"deg", ">", "0"}], ",", 
       RowBox[{
        FractionBox[
         RowBox[{"2", "deg"}], 
         RowBox[{
          RowBox[{"2", "deg"}], "+", "1"}]], 
        RowBox[{"(", 
         RowBox[{
          RowBox[{
           RowBox[{"(", 
            RowBox[{"deg", "+", "a", "+", 
             FractionBox["1", "2"]}], ")"}], 
           RowBox[{
            RowBox[{"R2", "[", 
             RowBox[{
              RowBox[{"deg", "-", "1"}], ",", "flag"}], "]"}], ".", 
            RowBox[{"trfVar2D", "[", 
             RowBox[{
              RowBox[{"deg", "-", "1"}], ",", 
              RowBox[{
               RowBox[{"\[Psi]", "[", 
                RowBox[{"#", ",", "a", ",", 
                 RowBox[{"deg", "-", "1"}]}], "]"}], "&"}]}], "]"}]}]}], "-", 
          
          RowBox[{
           RowBox[{"R2", "[", 
            RowBox[{
             RowBox[{"deg", "-", "1"}], ",", "flag"}], "]"}], ".", 
           RowBox[{"trfVar2D", "[", 
            RowBox[{
             RowBox[{"deg", "-", "1"}], ",", 
             RowBox[{
              RowBox[{"\[Psi]", "[", 
               RowBox[{"#", ",", 
                RowBox[{"a", "+", "1"}], ",", 
                RowBox[{"deg", "-", "1"}]}], "]"}], "&"}]}], "]"}]}]}], 
         ")"}]}], ",", "0"}], "]"}]}], ")"}]}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{"New", " ", "Recursion", " ", "Formulae", "??"}], 
   "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"recursion1", "[", 
    RowBox[{"a_", ",", "deg_", ",", "flag_"}], "]"}], ":=", 
   RowBox[{"(", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{
      RowBox[{"Norm\[Psi]", "[", 
       RowBox[{"a", ",", 
        RowBox[{"deg", "+", "1"}]}], "]"}], 
      RowBox[{
       RowBox[{"R1", "[", 
        RowBox[{
         RowBox[{"deg", "+", "1"}], ",", "flag"}], "]"}], ".", 
       RowBox[{"trfVar2D", "[", 
        RowBox[{
         RowBox[{"deg", "+", "1"}], ",", 
         RowBox[{
          RowBox[{"\[Psi]", "[", 
           RowBox[{"#", ",", "a", ",", 
            RowBox[{"deg", "+", "1"}]}], "]"}], "&"}]}], "]"}]}]}], "-", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"a", ">", "0"}], ",", 
       RowBox[{"a", " ", 
        RowBox[{"Norm\[Psi]", "[", 
         RowBox[{
          RowBox[{"a", "-", "1"}], ",", 
          RowBox[{"deg", "+", "1"}]}], "]"}], " ", 
        RowBox[{
         RowBox[{"R1", "[", 
          RowBox[{
           RowBox[{"deg", "+", "1"}], ",", "flag"}], "]"}], ".", 
         RowBox[{"trfVar2D", "[", 
          RowBox[{
           RowBox[{"deg", "+", "1"}], ",", 
           RowBox[{
            RowBox[{"\[Psi]", "[", 
             RowBox[{"#", ",", 
              RowBox[{"a", "-", "1"}], ",", 
              RowBox[{"deg", "+", "1"}]}], "]"}], "&"}]}], "]"}]}]}]}], "]"}],
      "\[IndentingNewLine]", "+", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"deg", ">", "0"}], ",", 
       RowBox[{
        FractionBox[
         RowBox[{"2", "deg"}], 
         RowBox[{
          RowBox[{"2", "deg"}], "+", "1"}]], 
        RowBox[{"(", 
         RowBox[{
          RowBox[{
           RowBox[{"(", 
            RowBox[{"deg", "+", "a", "+", 
             FractionBox["1", "2"]}], ")"}], 
           RowBox[{"Norm\[Psi]", "[", 
            RowBox[{"a", ",", 
             RowBox[{"deg", "-", "1"}]}], "]"}], 
           RowBox[{
            RowBox[{"R2", "[", 
             RowBox[{
              RowBox[{"deg", "-", "1"}], ",", "flag"}], "]"}], ".", 
            RowBox[{"trfVar2D", "[", 
             RowBox[{
              RowBox[{"deg", "-", "1"}], ",", 
              RowBox[{
               RowBox[{"\[Psi]", "[", 
                RowBox[{"#", ",", "a", ",", 
                 RowBox[{"deg", "-", "1"}]}], "]"}], "&"}]}], "]"}]}]}], "-", 
          
          RowBox[{
           RowBox[{
            RowBox[{"R2", "[", 
             RowBox[{
              RowBox[{"deg", "-", "1"}], ",", "flag"}], "]"}], ".", 
            RowBox[{"trfVar2D", "[", 
             RowBox[{
              RowBox[{"deg", "-", "1"}], ",", 
              RowBox[{
               RowBox[{"\[Psi]", "[", 
                RowBox[{"#", ",", 
                 RowBox[{"a", "+", "1"}], ",", 
                 RowBox[{"deg", "-", "1"}]}], "]"}], "&"}]}], "]"}]}], 
           RowBox[{"Norm\[Psi]", "[", 
            RowBox[{
             RowBox[{"a", "+", "1"}], ",", 
             RowBox[{"deg", "-", "1"}]}], "]"}]}]}], ")"}]}], ",", "0"}], 
      "]"}]}], ")"}]}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"mixed", "[", 
    RowBox[{"a_", ",", "n_", ",", "b_", ",", "m_"}], "]"}], ":=", 
   RowBox[{"Expand", "[", 
    RowBox[{"Sum", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"Binomial", "[", 
        RowBox[{
         RowBox[{"n", "-", 
          FractionBox[
           RowBox[{"n", "+", "m"}], "2"], "+", "a", "-", "c1", "-", "1"}], 
         ",", 
         RowBox[{"a", "-", "c1"}]}], "]"}], 
       FractionBox[
        RowBox[{"a", "!"}], 
        RowBox[{"c1", "!"}]], 
       RowBox[{"Binomial", "[", 
        RowBox[{
         RowBox[{"m", "-", 
          FractionBox[
           RowBox[{"n", "+", "m"}], "2"], "+", "b", "-", "c1", "-", "1"}], 
         ",", 
         RowBox[{"b", "-", "c1"}]}], "]"}], 
       FractionBox[
        RowBox[{"b", "!"}], 
        RowBox[{"c1", "!"}]], 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"c1", "!"}], 
         SqrtBox["2"], 
         RowBox[{"Gamma", "[", 
          RowBox[{
           FractionBox[
            RowBox[{"n", "+", "m"}], "2"], "+", "c1", "+", 
           RowBox[{"3", "/", "2"}]}], "]"}], 
         SuperscriptBox["2", 
          FractionBox[
           RowBox[{"n", "+", "m"}], "2"]]}], ")"}]}], ",", 
      RowBox[{"{", 
       RowBox[{"c1", ",", "0", ",", 
        RowBox[{"Min", "[", 
         RowBox[{"a", ",", "b"}], "]"}]}], "}"}]}], "]"}], "]"}]}], 
  "\[IndentingNewLine]", "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"IntegrateHalfNxNyNz1", "[", "ex_", "]"}], ":=", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"pos1", ",", "pos2", ",", "pos3", ",", 
      RowBox[{"mm", "=", "0"}], ",", 
      RowBox[{"nn", "=", "0"}], ",", 
      RowBox[{"pp", "=", "0"}], ",", "res", ",", 
      RowBox[{"res1", "=", 
       RowBox[{"\[Nu]x", " ", "\[Nu]y", " ", "\[Nu]z", " ", "ex"}]}]}], "}"}],
     ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"pos1", "=", 
      RowBox[{"Position", "[", 
       RowBox[{"res1", ",", 
        SuperscriptBox["\[Nu]x", "_"]}], "]"}]}], ";", "\[IndentingNewLine]", 
     
     RowBox[{"pos2", "=", 
      RowBox[{"Position", "[", 
       RowBox[{"res1", ",", 
        SuperscriptBox["\[Nu]y", "_"]}], "]"}]}], ";", "\[IndentingNewLine]", 
     
     RowBox[{"pos3", "=", 
      RowBox[{"Position", "[", 
       RowBox[{"res1", ",", 
        SuperscriptBox["\[Nu]z", "_"]}], "]"}]}], ";", "\[IndentingNewLine]", 
     
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"Length", "[", "pos1", "]"}], ">", "0"}], ",", 
       RowBox[{"mm", "=", 
        RowBox[{
         RowBox[{
          RowBox[{"Extract", "[", 
           RowBox[{"res1", ",", 
            RowBox[{
            "pos1", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}]}], 
           "]"}], "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], "-",
          "1"}]}]}], "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"Length", "[", "pos2", "]"}], ">", "0"}], ",", 
       RowBox[{"nn", "=", 
        RowBox[{
         RowBox[{
          RowBox[{"Extract", "[", 
           RowBox[{"res1", ",", 
            RowBox[{
            "pos2", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}]}], 
           "]"}], "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], "-",
          "1"}]}]}], "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"Length", "[", "pos3", "]"}], ">", "0"}], ",", 
       RowBox[{"pp", "=", 
        RowBox[{
         RowBox[{
          RowBox[{"Extract", "[", 
           RowBox[{"res1", ",", 
            RowBox[{
            "pos3", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}]}], 
           "]"}], "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], "-",
          "1"}]}]}], "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"res", "=", 
      RowBox[{
       RowBox[{"Delete", "[", 
        RowBox[{"res1", ",", 
         RowBox[{"Join", "[", 
          RowBox[{"pos1", ",", "pos2", ",", "pos3"}], "]"}]}], "]"}], 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"OddQ", "[", "nn", "]"}], "||", 
          RowBox[{"OddQ", "[", "pp", "]"}]}], ",", "0", ",", 
         RowBox[{"2", "\[Pi]", 
          FractionBox[
           RowBox[{
            RowBox[{
             RowBox[{"(", 
              RowBox[{"nn", "-", "1"}], ")"}], "!!"}], 
            RowBox[{
             RowBox[{"(", 
              RowBox[{"mm", "-", "1"}], ")"}], "!!"}], 
            RowBox[{
             RowBox[{"(", 
              RowBox[{"pp", "-", "1"}], ")"}], "!!"}]}], 
           RowBox[{
            RowBox[{"(", 
             RowBox[{"nn", "+", "mm", "+", "pp", "+", "1"}], ")"}], 
            "!!"}]]}]}], "]"}]}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"Length", "[", "pos1", "]"}], "\[Equal]", "0"}], ",", 
       RowBox[{"res", "=", 
        RowBox[{"res", "/", "\[Nu]x"}]}]}], "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"Length", "[", "pos2", "]"}], "\[Equal]", "0"}], ",", 
       RowBox[{"res", "=", 
        RowBox[{"res", "/", "\[Nu]y"}]}]}], "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"Length", "[", "pos3", "]"}], "\[Equal]", "0"}], ",", 
       RowBox[{"res", "=", 
        RowBox[{"res", "/", "\[Nu]z"}]}]}], "]"}], ";", "\[IndentingNewLine]",
      "res"}]}], "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"IntegrateHalfNxNyNz", "[", "ex_", "]"}], ":=", 
   RowBox[{"If", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"Head", "[", "ex", "]"}], "===", " ", "Plus"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{"Apply", "[", 
      RowBox[{"Plus", ",", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{"IntegrateHalfNxNyNz1", "[", 
          RowBox[{
          "ex", "\[LeftDoubleBracket]", "ii", "\[RightDoubleBracket]"}], 
          "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"ii", ",", "1", ",", 
           RowBox[{"Length", "[", "ex", "]"}]}], "}"}]}], "]"}]}], "]"}], ",",
      "\[IndentingNewLine]", 
     RowBox[{"IntegrateHalfNxNyNz1", "[", "ex", "]"}]}], "]"}]}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"HalfIntegrate", "[", 
    RowBox[{"idx1_", ",", "idx2_"}], "]"}], ":=", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"Int1", ",", 
       RowBox[{"deg1", "=", 
        RowBox[{"Total", "[", 
         RowBox[{"idx1", "\[LeftDoubleBracket]", 
          RowBox[{"{", 
           RowBox[{"2", ",", "3", ",", "4"}], "}"}], 
          "\[RightDoubleBracket]"}], "]"}]}], ",", 
       RowBox[{"deg2", "=", 
        RowBox[{"Total", "[", 
         RowBox[{"idx2", "\[LeftDoubleBracket]", 
          RowBox[{"{", 
           RowBox[{"2", ",", "3", ",", "4"}], "}"}], 
          "\[RightDoubleBracket]"}], "]"}]}]}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"Int1", "=", 
       RowBox[{"Expand", "[", 
        RowBox[{
         RowBox[{"SymTracefree", "[", 
          RowBox[{"Map", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"Apply", "[", 
              RowBox[{
               RowBox[{
                RowBox[{
                 SuperscriptBox["\[Nu]x", "#1"], 
                 SuperscriptBox["\[Nu]y", "#2"], 
                 SuperscriptBox["\[Nu]z", "#3"]}], "&"}], ",", "#"}], "]"}], 
             "&"}], ",", 
            RowBox[{"IDX", "[", "deg1", "]"}]}], "]"}], "]"}], 
         "\[LeftDoubleBracket]", 
         RowBox[{"toIDX2", "[", 
          RowBox[{"idx1", "\[LeftDoubleBracket]", 
           RowBox[{"{", 
            RowBox[{"2", ",", "3", ",", "4"}], "}"}], 
           "\[RightDoubleBracket]"}], "]"}], "\[RightDoubleBracket]"}], 
        "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Expand", "[", 
       RowBox[{
        FractionBox[
         RowBox[{"mixed", "[", 
          RowBox[{
           RowBox[{
           "idx1", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
           ",", "deg1", ",", 
           RowBox[{
           "idx2", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
           ",", "deg2"}], "]"}], 
         RowBox[{
          RowBox[{"Norm\[Psi]", "[", 
           RowBox[{
            RowBox[{
            "idx1", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
            ",", "deg1"}], "]"}], 
          SuperscriptBox[
           RowBox[{"(", 
            SqrtBox[
             RowBox[{"2", "\[Pi]"}]], ")"}], "3"]}]], 
        RowBox[{"IntegrateHalfNxNyNz", "[", 
         RowBox[{"Expand", "[", 
          RowBox[{"Int1", " ", 
           RowBox[{"SymFullDot", "[", 
            RowBox[{
             RowBox[{"Map", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"Apply", "[", 
                 RowBox[{
                  RowBox[{
                   RowBox[{
                    SuperscriptBox["\[Nu]x", "#1"], 
                    SuperscriptBox["\[Nu]y", "#2"], 
                    SuperscriptBox["\[Nu]z", "#3"]}], "&"}], ",", "#"}], 
                 "]"}], "&"}], ",", 
               RowBox[{"IDX", "[", "deg2", "]"}]}], "]"}], ",", 
             RowBox[{"trf2sym", "[", 
              RowBox[{"Map", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"Apply", "[", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{"#1", ",", "#2", ",", "#3"}], "}"}], "\[Equal]", 
                    RowBox[{"idx2", "\[LeftDoubleBracket]", 
                    RowBox[{"{", 
                    RowBox[{"2", ",", "3", ",", "4"}], "}"}], 
                    "\[RightDoubleBracket]"}]}], ",", "1", ",", "0"}], "]"}], 
                    "&"}], ",", "#"}], "]"}], "&"}], ",", 
                RowBox[{"IDXtrf", "[", "deg2", "]"}]}], "]"}], "]"}]}], 
            "]"}]}], "]"}], "]"}]}], "]"}]}]}], "\[IndentingNewLine]", 
    "]"}]}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"GetMatrices1D", "[", "Ntensors_", "]"}], ":=", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "varIdx", ",", "varIdxComplete", ",", "theory", ",", "normMatrix", ",", 
       "varNames", ",", "var", ",", "Ax", ",", "Ay", ",", 
       "\[IndentingNewLine]", "var1D", ",", "BCvar", ",", "varOdd", ",", 
       "varIdxCompleteEven", ",", "varEven", ",", "BCraw", ",", 
       RowBox[{"\[Rho]index", "=", "1"}], ",", 
       RowBox[{"vindex", "=", "2"}], ",", "\[Rho]Weqn", ",", "BCnum", ",", 
       "BCrhs", ",", "Praw"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"varIdx", "=", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{"iTraces", "[", "i", "]"}], ",", 
           RowBox[{"iTensorDegree", "[", "i", "]"}]}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"i", ",", "1", ",", "Ntensors"}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"varIdxComplete", "=", 
       RowBox[{"Flatten", "[", 
        RowBox[{
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"Map", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"Join", "[", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"varIdx", "\[LeftDoubleBracket]", 
                  RowBox[{"n", ",", "1"}], "\[RightDoubleBracket]"}], "}"}], 
                ",", "#"}], "]"}], "&"}], ",", 
             RowBox[{"Pick", "[", 
              RowBox[{
               RowBox[{"IDXtrf", "[", 
                RowBox[{"varIdx", "\[LeftDoubleBracket]", 
                 RowBox[{"n", ",", "2"}], "\[RightDoubleBracket]"}], "]"}], 
               ",", 
               RowBox[{"Flatten", "[", 
                RowBox[{"Join", "[", 
                 RowBox[{
                  RowBox[{"{", "1", "}"}], ",", 
                  RowBox[{"Table", "[", 
                   RowBox[{
                    RowBox[{"{", 
                    RowBox[{"1", ",", "0"}], "}"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"k", ",", "1", ",", 
                    RowBox[{"varIdx", "\[LeftDoubleBracket]", 
                    RowBox[{"n", ",", "2"}], "\[RightDoubleBracket]"}]}], 
                    "}"}]}], "]"}]}], "]"}], "]"}], ",", "1"}], "]"}]}], 
            "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"n", ",", "1", ",", 
             RowBox[{"Length", "[", "varIdx", "]"}]}], "}"}]}], "]"}], ",", 
         "1"}], "]"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"theory", "=", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{"Count", "[", 
          RowBox[{"varIdx", ",", 
           RowBox[{"{", 
            RowBox[{"_", ",", "k"}], "}"}]}], "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"k", ",", "0", ",", 
           RowBox[{"iFullDegree", "[", "Ntensors", "]"}]}], "}"}]}], "]"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"Print", "[", 
       RowBox[{
       "\"\<number of different tensor degrees: \>\"", ",", "theory"}], "]"}],
       ";", "\[IndentingNewLine]", 
      RowBox[{"Print", "[", 
       RowBox[{"\"\<corresponding variables (traces,indices): \>\"", ",", 
        RowBox[{"Flatten", "[", 
         RowBox[{
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{"Table", "[", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"a", ",", 
                RowBox[{"n", "-", "1"}]}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{"a", ",", "0", ",", 
                RowBox[{
                 RowBox[{
                 "theory", "\[LeftDoubleBracket]", "n", 
                  "\[RightDoubleBracket]"}], "-", "1"}]}], "}"}]}], "]"}], 
            ",", 
            RowBox[{"{", 
             RowBox[{"n", ",", "1", ",", 
              RowBox[{"Length", "[", "theory", "]"}]}], "}"}]}], "]"}], ",", 
          "1"}], "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"Print", "[", 
       RowBox[{"\"\<Number of Variables 1D: \>\"", ",", "Ntensors"}], "]"}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"Print", "[", 
       RowBox[{"\"\<Number of Variables 2D: \>\"", ",", 
        RowBox[{"NumberOfVariables2D", "[", "Ntensors", "]"}]}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Print", "[", 
       RowBox[{"\"\<Number of Variables 3D: \>\"", ",", 
        RowBox[{"NumberOfVariables3D", "[", "Ntensors", "]"}]}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Print", "[", 
       RowBox[{"\"\<Number of full Tensors 3D: \>\"", ",", 
        RowBox[{"NumberOfFullTensors3D", "[", "Ntensors", "]"}]}], "]"}], ";",
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"normMatrix", "=", 
       RowBox[{"DiagonalMatrix", "[", 
        RowBox[{"SparseArray", "[", 
         RowBox[{"Flatten", "[", 
          RowBox[{"Map", "[", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"Function", "[", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"a", ",", "deg"}], "}"}], ",", 
                RowBox[{"ConstantArray", "[", 
                 RowBox[{
                  RowBox[{"Norm\[Psi]", "[", 
                   RowBox[{"a", ",", "deg"}], "]"}], ",", 
                  RowBox[{"deg", "+", "1"}]}], "]"}]}], "]"}], "@@", "#"}], 
             "&"}], ",", "varIdx"}], "]"}], "]"}], "]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"varNames", "=", 
       RowBox[{
        RowBox[{"ToExpression", "[", 
         RowBox[{
          RowBox[{"Map", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"varName", "@@", "#"}], "&"}], ",", "varIdxComplete"}], 
           "]"}], "/.", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"\"\<\[Rho]0\>\"", "\[Rule]", "\"\<\[Rho]\>\""}], ",", 
            RowBox[{"\"\<\[Rho]0x\>\"", "\[Rule]", "\"\<vx\>\""}], ",", 
            RowBox[{"\"\<\[Rho]0y\>\"", "\[Rule]", "\"\<vy\>\""}], ",", 
            RowBox[{"\"\<\[Rho]1\>\"", "\[Rule]", "\"\<\[Theta]\>\""}], ",", 
            RowBox[{"\"\<\[Rho]0xx\>\"", "\[Rule]", "\"\<\[Sigma]xx\>\""}], 
            ",", 
            RowBox[{"\"\<\[Rho]0xy\>\"", "\[Rule]", "\"\<\[Sigma]xy\>\""}], 
            ",", 
            RowBox[{"\"\<\[Rho]0yy\>\"", "\[Rule]", "\"\<\[Sigma]yy\>\""}], 
            ",", 
            RowBox[{"\"\<\[Rho]1x\>\"", "\[Rule]", "\"\<qx\>\""}], ",", 
            RowBox[{"\"\<\[Rho]1y\>\"", "\[Rule]", "\"\<qy\>\""}]}], "}"}]}], 
         "]"}], "/.", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"\[Theta]", "\[Rule]", 
           RowBox[{
            RowBox[{
             RowBox[{"-", "3"}], "/", "2"}], "\[Theta]"}]}], ",", 
          RowBox[{"qx", "\[Rule]", 
           RowBox[{"-", "qx"}]}], ",", 
          RowBox[{"qy", "\[Rule]", 
           RowBox[{"-", "qy"}]}]}], "}"}]}]}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"var", "=", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{"Apply", "[", 
          RowBox[{
           RowBox[{"Function", "[", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"a", ",", "deg"}], "}"}], ",", 
             RowBox[{"trfVar2D", "[", 
              RowBox[{"deg", ",", 
               RowBox[{
                RowBox[{"\[Psi]", "[", 
                 RowBox[{"#", ",", "a", ",", "deg"}], "]"}], "&"}]}], "]"}]}],
             "]"}], ",", "item"}], "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"item", ",", "varIdx"}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"Ax", "=", 
       RowBox[{
        RowBox[{"CoefficientArrays", "[", 
         RowBox[{
          RowBox[{"Flatten", "[", 
           RowBox[{"Table", "[", 
            RowBox[{
             RowBox[{"Apply", "[", 
              RowBox[{
               RowBox[{"Function", "[", 
                RowBox[{
                 RowBox[{"{", 
                  RowBox[{"a", ",", "deg"}], "}"}], ",", 
                 RowBox[{"recursion1", "[", 
                  RowBox[{"a", ",", "deg", ",", "1"}], "]"}]}], "]"}], ",", 
               "item"}], "]"}], ",", 
             RowBox[{"{", 
              RowBox[{"item", ",", "varIdx"}], "}"}]}], "]"}], "]"}], ",", 
          RowBox[{"Flatten", "[", "var", "]"}]}], "]"}], 
        "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Ay", "=", 
       RowBox[{
        RowBox[{"CoefficientArrays", "[", 
         RowBox[{
          RowBox[{"Flatten", "[", 
           RowBox[{"Table", "[", 
            RowBox[{
             RowBox[{"Apply", "[", 
              RowBox[{
               RowBox[{"Function", "[", 
                RowBox[{
                 RowBox[{"{", 
                  RowBox[{"a", ",", "deg"}], "}"}], ",", 
                 RowBox[{"recursion1", "[", 
                  RowBox[{"a", ",", "deg", ",", "2"}], "]"}]}], "]"}], ",", 
               "item"}], "]"}], ",", 
             RowBox[{"{", 
              RowBox[{"item", ",", "varIdx"}], "}"}]}], "]"}], "]"}], ",", 
          RowBox[{"Flatten", "[", "var", "]"}]}], "]"}], 
        "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      StyleBox[
       RowBox[{"(*", " ", 
        RowBox[{"reduction", " ", "to", " ", "1", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"D", " ", "!!"}], "!!"}], "!!"}], "!!"}], "!!"}], 
          "!"}]}], " ", "*)"}],
       FontColor->RGBColor[1, 0, 0]], "\[IndentingNewLine]", 
      RowBox[{"var1D", "=", 
       RowBox[{"Flatten", "[", 
        RowBox[{"Position", "[", 
         RowBox[{
          RowBox[{"Map", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{
                  "#", "\[LeftDoubleBracket]", "3", "\[RightDoubleBracket]"}],
                   "\[Equal]", "0"}], ")"}], "&&", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{
                  "#", "\[LeftDoubleBracket]", "4", "\[RightDoubleBracket]"}],
                   "\[Equal]", "0"}], ")"}]}], ",", "1", ",", "0"}], "]"}], 
             "&"}], ",", "varIdxComplete"}], "]"}], ",", "1"}], "]"}], 
        "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"varIdxComplete", "=", 
       RowBox[{
       "varIdxComplete", "\[LeftDoubleBracket]", "var1D", 
        "\[RightDoubleBracket]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"varNames", "=", 
       RowBox[{
       "varNames", "\[LeftDoubleBracket]", "var1D", 
        "\[RightDoubleBracket]"}]}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{"Ax", "=", 
         RowBox[{"Normal", "[", 
          RowBox[{"Ax", "\[LeftDoubleBracket]", 
           RowBox[{"var1D", ",", "var1D"}], "\[RightDoubleBracket]"}], 
          "]"}]}], ";"}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"normMatrix", "=", 
       RowBox[{"normMatrix", "\[LeftDoubleBracket]", 
        RowBox[{"var1D", ",", "var1D"}], "\[RightDoubleBracket]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"BCvar", "=", 
       RowBox[{"Map", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"OddQ", "[", 
             RowBox[{
             "#", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
             "]"}], ",", "1", ",", "0"}], "]"}], "&"}], ",", 
         "varIdxComplete"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"varOdd", "=", 
       RowBox[{"Flatten", "[", 
        RowBox[{"Position", "[", 
         RowBox[{"BCvar", ",", "1"}], "]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"varIdxCompleteEven", "=", 
       RowBox[{"Select", "[", 
        RowBox[{"varIdxComplete", ",", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{
            RowBox[{"EvenQ", "[", 
             RowBox[{
             "#", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
             "]"}], "&&", 
            RowBox[{
             RowBox[{
             "#", "\[LeftDoubleBracket]", "4", "\[RightDoubleBracket]"}], 
             "\[Equal]", "0"}]}], ")"}], "&"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Do", "[", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"varEven", "[", 
          RowBox[{"jj", ",", "0"}], "]"}], "=", 
         RowBox[{"Select", "[", 
          RowBox[{"varIdxCompleteEven", ",", 
           RowBox[{
            RowBox[{"(", 
             RowBox[{
              RowBox[{
              "#", "\[LeftDoubleBracket]", "3", "\[RightDoubleBracket]"}], 
              "\[Equal]", "jj"}], ")"}], "&"}]}], "]"}]}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{"{", 
         RowBox[{"jj", ",", "0", ",", 
          RowBox[{"Max", "[", 
           RowBox[{"varIdxCompleteEven", "\[LeftDoubleBracket]", 
            RowBox[{"All", ",", "3"}], "\[RightDoubleBracket]"}], "]"}]}], 
         "}"}]}], "]"}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"BCraw", "=", 
       RowBox[{
        RowBox[{"CoefficientArrays", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"Table", "[", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{"OddQ", "[", 
               RowBox[{
               "idx", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
               "]"}], ",", "\[IndentingNewLine]", 
              RowBox[{"Total", "[", 
               RowBox[{
                SqrtBox[
                 RowBox[{"2", "\[Pi]"}]], 
                RowBox[{"Map", "[", 
                 RowBox[{
                  RowBox[{
                   RowBox[{
                    RowBox[{"HalfIntegrate", "[", 
                    RowBox[{"idx", ",", "#"}], "]"}], 
                    RowBox[{"Apply", "[", 
                    RowBox[{"w", ",", "#"}], "]"}]}], "&"}], ",", 
                  RowBox[{"Flatten", "[", 
                   RowBox[{
                    RowBox[{"Table", "[", 
                    RowBox[{
                    RowBox[{"varEven", "[", 
                    RowBox[{"jj", ",", 
                    RowBox[{
                    "idx", "\[LeftDoubleBracket]", "4", 
                    "\[RightDoubleBracket]"}]}], "]"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"jj", ",", 
                    RowBox[{
                    "idx", "\[LeftDoubleBracket]", "3", 
                    "\[RightDoubleBracket]"}], ",", "0", ",", 
                    RowBox[{"-", "2"}]}], "}"}]}], "]"}], ",", "1"}], "]"}]}],
                  "]"}]}], "]"}], "\[IndentingNewLine]", ",", "0"}], "]"}], 
            "\[IndentingNewLine]", ",", 
            RowBox[{"{", 
             RowBox[{"idx", ",", "varIdxComplete"}], "}"}]}], "]"}], 
          "\[IndentingNewLine]", ",", 
          RowBox[{"Map", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"Apply", "[", 
              RowBox[{"w", ",", "#"}], "]"}], "&"}], ",", "varIdxComplete"}], 
           "]"}]}], "\[IndentingNewLine]", "]"}], "\[LeftDoubleBracket]", "2",
         "\[RightDoubleBracket]"}]}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{"eliminate", " ", "\[Rho]W"}], " ", "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"\[Rho]Weqn", "=", 
       RowBox[{
       "BCraw", "\[LeftDoubleBracket]", "vindex", "\[RightDoubleBracket]"}]}],
       ";", "\[IndentingNewLine]", 
      RowBox[{"Do", "[", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"(", 
             RowBox[{"OddQ", "[", 
              RowBox[{"varIdxComplete", "\[LeftDoubleBracket]", 
               RowBox[{"i", ",", "2"}], "\[RightDoubleBracket]"}], "]"}], 
             ")"}], "&&", 
            RowBox[{"(", 
             RowBox[{"EvenQ", "[", 
              RowBox[{"varIdxComplete", "\[LeftDoubleBracket]", 
               RowBox[{"i", ",", "3"}], "\[RightDoubleBracket]"}], "]"}], 
             ")"}], "&&", 
            RowBox[{"(", 
             RowBox[{
              RowBox[{"varIdxComplete", "\[LeftDoubleBracket]", 
               RowBox[{"i", ",", "4"}], "\[RightDoubleBracket]"}], "\[Equal]",
               "0"}], ")"}]}], ",", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{
             RowBox[{
             "BCraw", "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}], 
             "-=", 
             RowBox[{
              FractionBox[
               RowBox[{"BCraw", "\[LeftDoubleBracket]", 
                RowBox[{"i", ",", "\[Rho]index"}], "\[RightDoubleBracket]"}], 
               
               RowBox[{
               "\[Rho]Weqn", "\[LeftDoubleBracket]", "\[Rho]index", 
                "\[RightDoubleBracket]"}]], "\[Rho]Weqn"}]}], ";"}]}], "]"}], 
         ";"}], "\[IndentingNewLine]", ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", "1", ",", 
          RowBox[{"Length", "[", "varIdxComplete", "]"}]}], "}"}]}], "]"}], 
      ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{"relaxational", " ", "normal", " ", "velocity"}], " ", "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"BCraw", "\[LeftDoubleBracket]", 
        RowBox[{"2", ",", "1"}], "\[RightDoubleBracket]"}], "=", "1"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"BCraw", "\[LeftDoubleBracket]", 
        RowBox[{"2", ",", "3"}], "\[RightDoubleBracket]"}], "=", 
       RowBox[{"-", "1"}]}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"BCnum", "=", 
       RowBox[{
        RowBox[{
        "normMatrix", "\[LeftDoubleBracket]", "varOdd", 
         "\[RightDoubleBracket]"}], ".", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"DiagonalMatrix", "[", "BCvar", "]"}], "-", "BCraw"}], 
         ")"}], ".", 
        RowBox[{"Inverse", "[", "normMatrix", "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"BCrhs", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"BCnum", "\[LeftDoubleBracket]", 
          RowBox[{"All", ",", "3"}], "\[RightDoubleBracket]"}], 
         RowBox[{"(", 
          RowBox[{
           RowBox[{
            RowBox[{"-", "3"}], "/", "2"}], "TW"}], ")"}]}], "+", 
        RowBox[{
         RowBox[{"BCnum", "\[LeftDoubleBracket]", 
          RowBox[{"All", ",", "1"}], "\[RightDoubleBracket]"}], 
         RowBox[{"(", 
          RowBox[{"pW", "-", "TW"}], ")"}]}]}]}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{
       "BGK", " ", "production", " ", "matrix", " ", "for", " ", "1", "D", 
        " ", "case"}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"Praw", "=", 
       RowBox[{"IdentityMatrix", "[", 
        RowBox[{"Length", "[", "var1D", "]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"Praw", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}],
        "=", "0"}], ";", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"Praw", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}],
        "=", "0"}], ";", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"Praw", "\[LeftDoubleBracket]", "3", "\[RightDoubleBracket]"}],
        "=", "0"}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"{", 
       RowBox[{
       "varNames", ",", "Ax", ",", "Ay", ",", "Praw", ",", "BCvar", ",", 
        "BCnum", ",", "BCrhs"}], "}"}]}]}], "\[IndentingNewLine]", "]"}]}], 
  ";"}], "\[IndentingNewLine]"}], "Input",
 CellChangeTimes->{{3.6820490600924387`*^9, 3.682049092494184*^9}, {
  3.682049432184958*^9, 3.682049459270082*^9}, {3.6820495708201427`*^9, 
  3.682049579493301*^9}, {3.682049658934208*^9, 3.682049676557197*^9}, {
  3.702223918124344*^9, 3.7022240638357697`*^9}, {3.702224573219268*^9, 
  3.702224583174917*^9}, {3.702224818932934*^9, 3.702224823917457*^9}, {
  3.702225310077735*^9, 3.702225348907318*^9}}]
}, Open  ]],

Cell[CellGroupData[{

Cell["Core Routines", "Section",
 CellChangeTimes->{{3.702198665922909*^9, 3.7021986699871883`*^9}, {
  3.70219884412829*^9, 3.7021988478237743`*^9}}],

Cell[CellGroupData[{

Cell["Get Matrices 2D", "Subsection",
 CellChangeTimes->{{3.702199010828974*^9, 3.7021990163809023`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
   "Get", " ", "matrices", " ", "based", " ", "upon", " ", "bases", " ", 
    "functions", " ", "used", " ", "by", " ", "manuel"}], "*)"}], 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"DiffBasisGetMatrices2D", "[", "Ntensors_", "]"}], ":=", 
    RowBox[{"Block", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "varIdx", ",", "varIdxComplete", ",", "theory", ",", "normMatrix", ",",
         "varNames", ",", "var", ",", "Ax", ",", "Ay", ",", 
        "\[IndentingNewLine]", "var1D", ",", "BCvar", ",", "varOdd", ",", 
        "varIdxCompleteEven", ",", "varEven", ",", "BCraw", ",", 
        RowBox[{"\[Rho]index", "=", "1"}], ",", 
        RowBox[{"vindex", "=", "2"}], ",", "\[Rho]Weqn", ",", "BCnum", ",", 
        "BCrhs", ",", "Praw", ",", "BCraw2", ",", "varIdxCompleteOdd", ",", 
        "IntGasEven", ",", "IntGasOdd", ",", "varIdxWall", ",", "IntWall", 
        ",", "B", ",", "eqnVelocity"}], "}"}], ",", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{
        "compute", " ", "the", " ", "tensor", " ", "degree", " ", "and", " ", 
         "the", " ", "number", " ", "of", " ", "traces", " ", "for", " ", 
         "every", " ", "tensor", " ", "in", " ", "the", " ", 
         RowBox[{"system", ".", "\[IndentingNewLine]", "In"}], " ", "all", 
         " ", "the", " ", "coming", " ", "computations"}], ",", " ", 
        RowBox[{
        "iTraces", " ", "will", " ", "be", " ", "represented", " ", "by", " ", 
         RowBox[{"a", ".", "sa"}]}]}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"varIdx", "=", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{"iTraces", "[", "i", "]"}], ",", 
            RowBox[{"iTensorDegree", "[", "i", "]"}]}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", "1", ",", "Ntensors"}], "}"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
        "same", " ", "as", " ", "IDXtrf", " ", "but", " ", "instead", " ", 
         "stores", " ", "the", " ", "value", " ", "of", " ", "the", " ", 
         "number", " ", "of", " ", "traces", " ", "in", " ", "the", " ", 
         "first", " ", "argument", " ", "of", " ", "every", " ", "list"}], 
        "*)"}], "\[IndentingNewLine]", 
       RowBox[{"varIdxComplete", "=", 
        RowBox[{"Flatten", "[", 
         RowBox[{
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{"Map", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"Join", "[", 
                RowBox[{
                 RowBox[{"{", 
                  RowBox[{"varIdx", "\[LeftDoubleBracket]", 
                   RowBox[{"n", ",", "1"}], "\[RightDoubleBracket]"}], "}"}], 
                 ",", "#"}], "]"}], "&"}], ",", 
              RowBox[{"Pick", "[", 
               RowBox[{
                RowBox[{"IDXtrf", "[", 
                 RowBox[{"varIdx", "\[LeftDoubleBracket]", 
                  RowBox[{"n", ",", "2"}], "\[RightDoubleBracket]"}], "]"}], 
                ",", 
                RowBox[{"Flatten", "[", 
                 RowBox[{"Join", "[", 
                  RowBox[{
                   RowBox[{"{", "1", "}"}], ",", 
                   RowBox[{"Table", "[", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{"1", ",", "0"}], "}"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"k", ",", "1", ",", 
                    RowBox[{"varIdx", "\[LeftDoubleBracket]", 
                    RowBox[{"n", ",", "2"}], "\[RightDoubleBracket]"}]}], 
                    "}"}]}], "]"}]}], "]"}], "]"}], ",", "1"}], "]"}]}], 
             "]"}], ",", 
            RowBox[{"{", 
             RowBox[{"n", ",", "1", ",", 
              RowBox[{"Length", "[", "varIdx", "]"}]}], "}"}]}], "]"}], ",", 
          "1"}], "]"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{"variables", " ", "for", " ", "the", " ", 
         RowBox[{"wall", ".", " ", "Density"}], " ", "and", " ", 
         "Temperature"}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{"varIdxWall", " ", "=", " ", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"0", ",", "0", ",", "0", ",", "0"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"1", ",", "0", ",", "0", ",", "0"}], "}"}]}], "}"}]}], ";",
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
        "computes", " ", "the", " ", "number", " ", "of", " ", "traces", " ", 
         "for", " ", "a", " ", "given", " ", 
         RowBox[{"iTensorDegree", ".", " ", "The"}], " ", "final", " ", 
         "result", " ", "gives", " ", "us", " ", "the", " ", "tuple", " ", 
         "discussed", " ", "in", " ", "the", " ", "paper", " ", "on", " ", 
         "the", " ", "convergence", " ", "of", " ", "the", " ", "boundary", 
         " ", "value", " ", 
         RowBox[{"problem", "."}]}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{"theory", "=", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{"Count", "[", 
           RowBox[{"varIdx", ",", 
            RowBox[{"{", 
             RowBox[{"_", ",", "k"}], "}"}]}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"k", ",", "0", ",", 
            RowBox[{"iFullDegree", "[", "Ntensors", "]"}]}], "}"}]}], "]"}]}],
        ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"normMatrix", "=", 
        RowBox[{"DiagonalMatrix", "[", 
         RowBox[{"SparseArray", "[", 
          RowBox[{"Flatten", "[", 
           RowBox[{"Map", "[", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{"Function", "[", 
                RowBox[{
                 RowBox[{"{", 
                  RowBox[{"a", ",", "deg"}], "}"}], ",", 
                 RowBox[{"ConstantArray", "[", 
                  RowBox[{
                   RowBox[{"Norm\[Psi]", "[", 
                    RowBox[{"a", ",", "deg"}], "]"}], ",", 
                   RowBox[{"deg", "+", "1"}]}], "]"}]}], "]"}], "@@", "#"}], 
              "&"}], ",", "varIdx"}], "]"}], "]"}], "]"}], "]"}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
        "So", " ", "the", " ", "stress", " ", "tensor", " ", "will", " ", 
         "be", " ", "different", " ", "from", " ", "the", " ", "usual", " ", 
         "stress", " ", "tensor", " ", "defined", " ", 
         RowBox[{"normally", ".", "\[IndentingNewLine]", "All"}], " ", "the", 
         " ", "variable", " ", "names", " ", "are", " ", "for", " ", "the", 
         " ", "2", "D", " ", 
         RowBox[{"case", "."}]}], " ", "*)"}], "\[IndentingNewLine]", 
       RowBox[{"varNames", "=", 
        RowBox[{
         RowBox[{"ToExpression", "[", 
          RowBox[{
           RowBox[{"Map", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"varName", "@@", "#"}], "&"}], ",", "varIdxComplete"}], 
            "]"}], "/.", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"\"\<\[Rho]0\>\"", "\[Rule]", "\"\<\[Rho]\>\""}], ",", 
             RowBox[{"\"\<\[Rho]0x\>\"", "\[Rule]", "\"\<vx\>\""}], ",", 
             RowBox[{"\"\<\[Rho]0y\>\"", "\[Rule]", "\"\<vy\>\""}], ",", 
             RowBox[{"\"\<\[Rho]1\>\"", "\[Rule]", "\"\<\[Theta]\>\""}], ",", 
             
             RowBox[{"\"\<\[Rho]0xx\>\"", "\[Rule]", "\"\<\[Sigma]xx\>\""}], 
             ",", 
             RowBox[{"\"\<\[Rho]0xy\>\"", "\[Rule]", "\"\<\[Sigma]xy\>\""}], 
             ",", 
             RowBox[{"\"\<\[Rho]0yy\>\"", "\[Rule]", "\"\<\[Sigma]yy\>\""}], 
             ",", 
             RowBox[{"\"\<\[Rho]1x\>\"", "\[Rule]", "\"\<qx\>\""}], ",", 
             RowBox[{"\"\<\[Rho]1y\>\"", "\[Rule]", "\"\<qy\>\""}]}], "}"}]}],
           "]"}], "/.", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"\[Theta]", "\[Rule]", 
            RowBox[{
             RowBox[{
              RowBox[{"-", "3"}], "/", "2"}], "\[Theta]"}]}], ",", 
           RowBox[{"qx", "\[Rule]", 
            RowBox[{"-", "qx"}]}], ",", 
           RowBox[{"qy", "\[Rule]", 
            RowBox[{"-", "qy"}]}]}], "}"}]}]}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{
         "the", " ", "result", " ", "from", " ", "var", " ", "consists", " ", 
          "of", " ", "the", " ", "form", " ", 
          RowBox[{"\[Psi]", "[", 
           RowBox[{"n", ",", "a", ",", "deg"}], "]"}]}], ",", " ", 
         RowBox[{
          RowBox[{"where", " ", "a"}], " ", "=", " ", "#traces"}], ",", " ", 
         RowBox[{"deg", " ", "=", " ", 
          RowBox[{
           RowBox[{
           "#free", " ", "tensors", " ", "and", " ", "n", " ", "is", " ", 
            "the", " ", "name", " ", "for", " ", "eg", " ", "vx"}], " ", "=", 
           " ", 
           RowBox[{
            RowBox[{"1", " ", "and", " ", "vy"}], " ", "=", " ", 
            RowBox[{
            "2", " ", "or", " ", "\[Theta]", " ", "is", " ", "simply", " ", 
             "1"}]}]}]}]}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{"var", "=", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{"Apply", "[", 
           RowBox[{
            RowBox[{"Function", "[", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"a", ",", "deg"}], "}"}], ",", 
              RowBox[{"trfVar2D", "[", 
               RowBox[{"deg", ",", 
                RowBox[{
                 RowBox[{"\[Psi]", "[", 
                  RowBox[{"#", ",", "a", ",", "deg"}], "]"}], "&"}]}], 
               "]"}]}], "]"}], ",", "item"}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"item", ",", "varIdx"}], "}"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"Ax", "=", 
        RowBox[{
         RowBox[{"CoefficientArrays", "[", 
          RowBox[{
           RowBox[{"Flatten", "[", 
            RowBox[{"Table", "[", 
             RowBox[{
              RowBox[{"Apply", "[", 
               RowBox[{
                RowBox[{"Function", "[", 
                 RowBox[{
                  RowBox[{"{", 
                   RowBox[{"a", ",", "deg"}], "}"}], ",", 
                  RowBox[{"recursion1", "[", 
                   RowBox[{"a", ",", "deg", ",", "1"}], "]"}]}], "]"}], ",", 
                "item"}], "]"}], ",", 
              RowBox[{"{", 
               RowBox[{"item", ",", "varIdx"}], "}"}]}], "]"}], "]"}], ",", 
           RowBox[{"Flatten", "[", "var", "]"}]}], "]"}], 
         "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"Ay", "=", 
        RowBox[{
         RowBox[{"CoefficientArrays", "[", 
          RowBox[{
           RowBox[{"Flatten", "[", 
            RowBox[{"Table", "[", 
             RowBox[{
              RowBox[{"Apply", "[", 
               RowBox[{
                RowBox[{"Function", "[", 
                 RowBox[{
                  RowBox[{"{", 
                   RowBox[{"a", ",", "deg"}], "}"}], ",", 
                  RowBox[{"recursion1", "[", 
                   RowBox[{"a", ",", "deg", ",", "2"}], "]"}]}], "]"}], ",", 
                "item"}], "]"}], ",", 
              RowBox[{"{", 
               RowBox[{"item", ",", "varIdx"}], "}"}]}], "]"}], "]"}], ",", 
           RowBox[{"Flatten", "[", "var", "]"}]}], "]"}], 
         "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{"reduction", " ", "for", " ", "1", "d"}], "*)"}], 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"var1D", "=", 
          RowBox[{"Flatten", "[", 
           RowBox[{"Position", "[", 
            RowBox[{
             RowBox[{"Map", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"If", "[", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"(", 
                    RowBox[{
                    RowBox[{
                    "#", "\[LeftDoubleBracket]", "3", 
                    "\[RightDoubleBracket]"}], "\[Equal]", "0"}], ")"}], "&&", 
                   RowBox[{"(", 
                    RowBox[{
                    RowBox[{
                    "#", "\[LeftDoubleBracket]", "4", 
                    "\[RightDoubleBracket]"}], "\[Equal]", "0"}], ")"}]}], 
                  ",", "1", ",", "0"}], "]"}], "&"}], ",", "varIdxComplete"}],
               "]"}], ",", "1"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
         
         RowBox[{"varIdxComplete", "=", 
          RowBox[{
          "varIdxComplete", "\[LeftDoubleBracket]", "var1D", 
           "\[RightDoubleBracket]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"varNames", "=", 
          RowBox[{
          "varNames", "\[LeftDoubleBracket]", "var1D", 
           "\[RightDoubleBracket]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"Ax", "=", 
          RowBox[{"Normal", "[", 
           RowBox[{"Ax", "\[LeftDoubleBracket]", 
            RowBox[{"var1D", ",", "var1D"}], "\[RightDoubleBracket]"}], 
           "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"normMatrix", "=", 
          RowBox[{"normMatrix", "\[LeftDoubleBracket]", 
           RowBox[{"var1D", ",", "var1D"}], "\[RightDoubleBracket]"}]}], 
         ";"}], "\[IndentingNewLine]", "*)"}], "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
        "As", " ", "the", " ", "literature", " ", "says", " ", "the", " ", 
         "boundary", " ", "conditions", " ", "will", " ", "only", " ", "be", 
         " ", "computed", " ", "with", " ", "basis", " ", "functions", " ", 
         "which", " ", "have", " ", "odd", " ", "powers", " ", "of", " ", 
         "Cx", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{
           "considering", " ", "the", " ", "normal", " ", "to", " ", "point", 
            " ", "in", " ", "the", " ", "x", " ", "direction"}], ")"}], ".", 
          " ", "BCVar"}], " ", "is", " ", "a", " ", "mapping", " ", "which", 
         " ", "collects", " ", "odd", " ", "basis", " ", "functions"}], " ", 
        "*)"}], "\[IndentingNewLine]", 
       RowBox[{"BCvar", "=", 
        RowBox[{"Map", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{"OddQ", "[", 
              RowBox[{
              "#", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
              "]"}], ",", "1", ",", "0"}], "]"}], "&"}], ",", 
          "varIdxComplete"}], "]"}]}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{"the", " ", "position", " ", "of", " ", "odd", " ", 
         RowBox[{"variables", "."}]}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{"varOdd", "=", 
        RowBox[{"Flatten", "[", 
         RowBox[{"Position", "[", 
          RowBox[{"BCvar", ",", "1"}], "]"}], "]"}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{"Picks", " ", "out", " ", "the", " ", "even", " ", 
         RowBox[{"components", ".", " ", "The"}], " ", "fourth", " ", 
         "component", " ", "is", " ", "anyhow", " ", "always", " ", 
         RowBox[{"zero", "."}]}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{"varIdxCompleteEven", "=", 
        RowBox[{"Select", "[", 
         RowBox[{"varIdxComplete", ",", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{
             RowBox[{"EvenQ", "[", 
              RowBox[{
              "#", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
              "]"}], "&&", 
             RowBox[{
              RowBox[{
              "#", "\[LeftDoubleBracket]", "4", "\[RightDoubleBracket]"}], 
              "\[Equal]", "0"}]}], ")"}], "&"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
        "Picks", " ", "out", " ", "the", " ", "odd", " ", "variables"}], 
        "*)"}], "\[IndentingNewLine]", 
       RowBox[{"varIdxCompleteOdd", "=", 
        RowBox[{"Select", "[", 
         RowBox[{"varIdxComplete", ",", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{
             RowBox[{"OddQ", "[", 
              RowBox[{
              "#", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
              "]"}], "&&", 
             RowBox[{
              RowBox[{
              "#", "\[LeftDoubleBracket]", "4", "\[RightDoubleBracket]"}], 
              "\[Equal]", "0"}]}], ")"}], "&"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{
         "Every", " ", "element", " ", "is", " ", "same", " ", "as", " ", 
          "that", " ", "to", " ", 
          RowBox[{"varIdxCompleteEven", ".", " ", "The"}], " ", "following", 
          " ", "manupilation", " ", "just", " ", "separates", " ", "out", " ",
           "the", " ", "elements", " ", "depending", " ", "upon", " ", "the", 
          " ", "number", " ", "of", " ", "y"}], "-", "indices"}], "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"Do", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{"varEven", "[", 
           RowBox[{"jj", ",", "0"}], "]"}], "=", 
          RowBox[{"Select", "[", 
           RowBox[{"varIdxCompleteEven", ",", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{
               RowBox[{
               "#", "\[LeftDoubleBracket]", "3", "\[RightDoubleBracket]"}], 
               "\[Equal]", "jj"}], ")"}], "&"}]}], "]"}]}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"{", 
          RowBox[{"jj", ",", "0", ",", 
           RowBox[{"Max", "[", 
            RowBox[{"varIdxCompleteEven", "\[LeftDoubleBracket]", 
             RowBox[{"All", ",", "3"}], "\[RightDoubleBracket]"}], "]"}]}], 
          "}"}]}], "]"}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{
          RowBox[{
          "In", " ", "the", " ", "following", " ", "function", " ", "we", " ",
            "compute", " ", 
           RowBox[{"\[Integral]", " ", 
            RowBox[{"\[Psi]", " ", 
             SuperscriptBox["f", "even"], "dc", " ", "where", " ", "\[Psi]", 
             " ", "is", " ", "such", " ", "that", " ", "the", " ", "powers", 
             " ", "of", " ", "Cx", " ", "appearing", " ", "in", " ", "\[Psi]",
              " ", "are", " ", 
             RowBox[{"odd", ".", " ", "The"}], " ", "first", " ", "argument", 
             " ", "of", " ", "jj", " ", "has", " ", "been", " ", "optimised", 
             " ", "using", " ", "some", " ", "currently", " ", "unkown", " ", 
             
             RowBox[{"formula", ".", " ", "The"}], " ", "result", " ", "from",
              " ", "this", " ", "manipulation", " ", "remains", " ", "the", 
             " ", "same", " ", "even", " ", "if", " ", 
             RowBox[{"{", 
              RowBox[{"jj", ",", 
               RowBox[{"idx", "[", 
                RowBox[{"[", "3", "]"}], "]"}], ",", "0", ",", 
               RowBox[{"-", "2"}]}], "}"}], " ", "is", " ", "substituted", 
             " ", "by", " ", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"jj", ",", "0", ",", 
                RowBox[{"Max", "[", 
                 RowBox[{"varIdxCompleteEven", "\[LeftDoubleBracket]", 
                  RowBox[{"All", ",", "3"}], "\[RightDoubleBracket]"}], 
                 "]"}]}], "}"}], ".", "\[IndentingNewLine]", "Let"}], " ", 
             "the", " ", "basis", " ", "function", " ", "of", " ", "f", " ", 
             "be", " ", "\[Phi]", " ", "and", " ", "the", " ", "test", " ", 
             "function", " ", "be", " ", 
             RowBox[{"\[Psi]", ".", " ", "m"}]}]}]}], " ", "=", " ", 
          RowBox[{
           RowBox[{
           "powers", " ", "of", " ", "Cy", " ", "in", " ", "\[Psi]", " ", 
            "and", " ", "n"}], " ", "=", " ", 
           RowBox[{
            RowBox[{"powers", " ", "of", " ", "Cy", " ", "in", " ", 
             RowBox[{"\[Phi]", ".", " ", "\[IndentingNewLine]", " ", "Then"}],
              " ", "the", " ", "following", " ", "unexplained", " ", 
             "observation", " ", "holds", "\[IndentingNewLine]", 
             "\[IndentingNewLine]", "1.", " ", 
             RowBox[{"\[Integral]", 
              RowBox[{"\[Psi]", " ", "f"}]}]}], " ", "=", " ", 
            RowBox[{
             RowBox[{"0", " ", "if", " ", "n"}], " ", ">", " ", 
             RowBox[{
              RowBox[{"m", " ", "or", " ", "n"}], "+", "m"}], " ", 
             "\[NotEqual]", " ", 
             RowBox[{
              RowBox[{"Even", ".", "\[IndentingNewLine]", "2."}], " ", "In", 
              " ", "the", " ", "equation", " ", "for", " ", 
              "\[Rho]W"}]}]}]}]}], ",", " ", 
         RowBox[{
          RowBox[{
          "the", " ", "odd", " ", "part", " ", "of", " ", "f", " ", "only", 
           " ", "contributed", " ", "vx"}], " ", "=", " ", 
          RowBox[{
          "0", " ", "and", " ", "thus", " ", "has", " ", "been", " ", 
           RowBox[{
           "neglected", ".", "\[IndentingNewLine]", "\[IndentingNewLine]", 
            " ", "Based"}], " ", "on", " ", "this", " ", "observation"}]}], 
         ",", " ", 
         RowBox[{
         "the", " ", "following", " ", "routine", " ", "has", " ", "been", 
          " ", 
          RowBox[{"simplified", "."}]}]}], "*)"}], "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"IntGasEven", "=", 
        RowBox[{"Table", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"OddQ", "[", 
             RowBox[{
             "idx", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
             "]"}], ",", "\[IndentingNewLine]", 
            RowBox[{"Total", "[", 
             RowBox[{"Map", "[", 
              RowBox[{
               RowBox[{
                RowBox[{
                 RowBox[{"HalfIntegrate", "[", 
                  RowBox[{"idx", ",", "#"}], "]"}], 
                 RowBox[{"Apply", "[", 
                  RowBox[{"w", ",", "#"}], "]"}]}], "&"}], ",", 
               RowBox[{"Table", "[", 
                RowBox[{"idx2", ",", 
                 RowBox[{"{", 
                  RowBox[{"idx2", ",", "varIdxCompleteEven"}], "}"}]}], 
                "]"}]}], "]"}], "]"}], "\[IndentingNewLine]", ",", "0"}], 
           "]"}], "\[IndentingNewLine]", ",", 
          RowBox[{"{", 
           RowBox[{"idx", ",", "varIdxComplete"}], "}"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"IntGasOdd", "=", 
        RowBox[{"Table", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"OddQ", "[", 
             RowBox[{
             "idx", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
             "]"}], ",", "\[IndentingNewLine]", 
            RowBox[{"Total", "[", 
             RowBox[{"Map", "[", 
              RowBox[{
               RowBox[{
                RowBox[{
                 RowBox[{"HalfIntegrate", "[", 
                  RowBox[{"idx", ",", "#"}], "]"}], 
                 RowBox[{"Apply", "[", 
                  RowBox[{"w", ",", "#"}], "]"}]}], "&"}], ",", 
               RowBox[{"Table", "[", 
                RowBox[{"idx2", ",", 
                 RowBox[{"{", 
                  RowBox[{"idx2", ",", "varIdxCompleteOdd"}], "}"}]}], 
                "]"}]}], "]"}], "]"}], "\[IndentingNewLine]", ",", "0"}], 
           "]"}], "\[IndentingNewLine]", ",", 
          RowBox[{"{", 
           RowBox[{"idx", ",", "varIdxComplete"}], "}"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"IntWall", " ", "=", " ", 
        RowBox[{"Table", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"OddQ", "[", 
             RowBox[{
             "idx", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
             "]"}], ",", "\[IndentingNewLine]", 
            RowBox[{"Total", "[", 
             RowBox[{"Map", "[", 
              RowBox[{
               RowBox[{
                RowBox[{
                 RowBox[{"HalfIntegrate", "[", 
                  RowBox[{"idx", ",", "#"}], "]"}], 
                 RowBox[{"Apply", "[", 
                  RowBox[{
                   SubscriptBox["w", "wall"], ",", "#"}], "]"}]}], "&"}], ",", 
               RowBox[{"Table", "[", 
                RowBox[{"idx2", ",", 
                 RowBox[{"{", 
                  RowBox[{"idx2", ",", "varIdxWall"}], "}"}]}], "]"}]}], 
              "]"}], "]"}], "\[IndentingNewLine]", ",", "0"}], "]"}], 
          "\[IndentingNewLine]", ",", 
          RowBox[{"{", 
           RowBox[{"idx", ",", "varIdxComplete"}], "}"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{
         "when", " ", "wall", " ", "normal", " ", "points", " ", "into", " ", 
          "the", " ", "gas", " ", "at", " ", "x"}], " ", "=", " ", 
         RowBox[{"-", "1"}]}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Expand", "[", 
           RowBox[{"IntGasOdd", "+", "IntGasEven", "-", "IntWall"}], "]"}], 
          ",", "Ax", ",", "Ay", ",", 
          RowBox[{"Map", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"Apply", "[", 
              RowBox[{"w", ",", "#"}], "]"}], "&"}], ",", "varIdxComplete"}], 
           "]"}], ",", "varOdd"}], "}"}], "*)"}], "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{
         "when", " ", "the", " ", "wall", " ", "normal", " ", "points", " ", 
          "out", " ", "of", " ", "the", " ", "gas", " ", "at", " ", "x"}], 
         " ", "=", " ", "1."}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"Expand", "[", 
          RowBox[{"IntGasOdd", "-", "IntGasEven", "+", "IntWall"}], "]"}], 
         ",", "Ax", ",", "Ay", ",", 
         RowBox[{"Map", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"Apply", "[", 
             RowBox[{"w", ",", "#"}], "]"}], "&"}], ",", "varIdxComplete"}], 
          "]"}], ",", "varOdd"}], "}"}]}]}], "\[IndentingNewLine]", "]"}]}], 
   ";"}]}]], "Input",
 CellChangeTimes->{{3.702198850840517*^9, 3.7021989352816277`*^9}, {
  3.70219909000103*^9, 3.70219910662567*^9}}]
}, Closed]],

Cell[CellGroupData[{

Cell["Create n and s list", "Subsection",
 CellChangeTimes->{{3.702191437024424*^9, 3.7021914411122*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"ConversionFac", "[", 
    RowBox[{"s_", ",", "n_"}], "]"}], ":=", 
   SqrtBox[
    FractionBox[
     RowBox[{"Gamma", "[", 
      RowBox[{"n", "+", 
       RowBox[{"3", "/", "2"}]}], "]"}], 
     RowBox[{
      RowBox[{"n", "!"}], 
      RowBox[{"s", "!"}], 
      RowBox[{"Gamma", "[", 
       RowBox[{"n", "+", "s", "+", 
        RowBox[{"3", "/", "2"}]}], "]"}]}]]]}], ";"}]], "Input",
 CellChangeTimes->{{3.702191160888241*^9, 3.7021911961871853`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
   "compute", " ", "the", " ", "total", " ", "free", " ", "indices", " ", 
    "and", " ", "the", " ", "number", " ", "of", " ", "traces"}], "*)"}], 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"CreateNSlist", "[", "var_", "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", "result", "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"result", " ", "=", " ", 
         RowBox[{"ConstantArray", "[", 
          RowBox[{"0", ",", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"Length", "[", "var", "]"}], ",", "2"}], "}"}]}], 
          "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"Do", "[", 
         RowBox[{
          RowBox[{
           RowBox[{
           "result", "\[LeftDoubleBracket]", "ii", "\[RightDoubleBracket]"}], 
           "=", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"var", "\[LeftDoubleBracket]", 
              RowBox[{"ii", ",", "1"}], "\[RightDoubleBracket]"}], ",", 
             RowBox[{"Sum", "[", 
              RowBox[{
               RowBox[{"var", "\[LeftDoubleBracket]", 
                RowBox[{"ii", ",", "jj"}], "\[RightDoubleBracket]"}], ",", 
               RowBox[{"{", 
                RowBox[{"jj", ",", "2", ",", "4"}], "}"}]}], "]"}]}], "}"}]}],
           ",", 
          RowBox[{"{", 
           RowBox[{"ii", ",", "1", ",", 
            RowBox[{"Length", "[", "var", "]"}]}], "}"}]}], "]"}], ";", 
        "\[IndentingNewLine]", "result"}]}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{"My", " ", "variables"}], " ", "=", " ", 
     RowBox[{"TransfMat", " ", "*", " ", 
      RowBox[{"Manuel", "'"}], "s", " ", "variable"}]}], "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"TransfMat", "[", "var_", "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"result", ",", "NSlist"}], "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"result", " ", "=", " ", 
        RowBox[{"ConstantArray", "[", 
         RowBox[{"0", ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"Length", "[", "var", "]"}], ",", 
            RowBox[{"Length", "[", "var", "]"}]}], "}"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"NSlist", " ", "=", " ", 
        RowBox[{"CreateNSlist", "[", "var", "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"Do", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"result", "\[LeftDoubleBracket]", 
           RowBox[{"ii", ",", "ii"}], "\[RightDoubleBracket]"}], "=", 
          RowBox[{"ConversionFac", "[", 
           RowBox[{
            RowBox[{"NSlist", "\[LeftDoubleBracket]", 
             RowBox[{"ii", ",", "1"}], "\[RightDoubleBracket]"}], ",", 
            RowBox[{"NSlist", "\[LeftDoubleBracket]", 
             RowBox[{"ii", ",", "2"}], "\[RightDoubleBracket]"}]}], "]"}]}], 
         ",", 
         RowBox[{"{", 
          RowBox[{"ii", ",", "1", ",", 
           RowBox[{"Length", "[", "var", "]"}]}], "}"}]}], "]"}], ";", 
       "\[IndentingNewLine]", "result"}]}], "\[IndentingNewLine]", 
     "]"}]}]}]}]], "Input",
 CellChangeTimes->{{3.702191461424307*^9, 3.702191483603868*^9}, {
  3.702195589391213*^9, 3.7021956702580833`*^9}, {3.702195724933013*^9, 
  3.702195829315473*^9}, {3.702195904362278*^9, 3.7021959411846733`*^9}}]
}, Closed]],

Cell[CellGroupData[{

Cell["Boundary Matrices", "Subsection",
 CellChangeTimes->{{3.679741300406704*^9, 3.679741307949397*^9}}],

Cell[BoxData[
 RowBox[{"\[IndentingNewLine]", "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
   "same", " ", "as", " ", "below", " ", "but", " ", "without", " ", "normal",
     " ", "relaxational", " ", "velocity"}], "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"DevelopBNoRelax", "[", 
     RowBox[{"BC_", ",", "var_", ",", "varOdd_"}], "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "result", ",", "eqnVelocity", ",", "tempBC", ",", "eqn\[Rho]W", ",", 
        "transform\[Rho]W", ",", "g", ",", "IdxVelocity"}], "}"}], ",", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{
        "Due", " ", "to", " ", "no", " ", "penetration", " ", "boundary", " ",
          "conditions"}], ",", " ", 
        RowBox[{
        "the", " ", "velocity", " ", "gets", " ", "cancelled", " ", "from", 
         " ", "the", " ", "both", " ", "the", " ", "sides", " ", "of", " ", 
         "the", " ", 
         RowBox[{"equation", ".", " ", "Therefore"}]}], ",", " ", 
        RowBox[{
        "we", " ", "replace", " ", "the", " ", "velocity", " ", "by", " ", 
         "a", " ", "zero"}]}], "*)"}], "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"tempBC", " ", "=", 
        RowBox[{"Flatten", "[", 
         RowBox[{
          RowBox[{"Expand", "[", 
           RowBox[{
            SqrtBox["\[Pi]"], "BC"}], "]"}], "/.", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"w", "[", 
             RowBox[{"0", ",", "1", ",", "0", ",", "0"}], "]"}], "\[Rule]", 
            "0"}], "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"eqn\[Rho]W", " ", "=", " ", 
        RowBox[{"tempBC", "[", 
         RowBox[{"[", "2", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"transform\[Rho]W", " ", "=", " ", 
        RowBox[{"Solve", "[", 
         RowBox[{
          RowBox[{"eqn\[Rho]W", "\[Equal]", "0"}], ",", 
          RowBox[{"{", 
           RowBox[{
            SubscriptBox["w", "wall"], "[", 
            RowBox[{"0", ",", "0", ",", "0", ",", "0"}], "]"}], "}"}]}], 
         "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"tempBC", " ", "=", " ", 
        RowBox[{"Flatten", "[", 
         RowBox[{"Expand", "[", 
          RowBox[{"tempBC", "/.", "transform\[Rho]W"}], "]"}], "]"}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
        "boundary", " ", "conditions", " ", "for", " ", "velocity", " ", 
         "from", " ", "the", " ", "entropy", " ", "functional"}], "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{
         "the", " ", "boundary", " ", "condition", " ", "reads", " ", 
          "\[IndentingNewLine]", 
          RowBox[{"w", "[", 
           RowBox[{"0", ",", "1", ",", "0", ",", "0"}], "]"}]}], "-", " ", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"w", "[", 
            RowBox[{"0", ",", "0", ",", "0", ",", "0"}], "]"}], "+", 
           RowBox[{
            SqrtBox["2"], " ", 
            RowBox[{"w", "[", 
             RowBox[{"0", ",", "2", ",", "0", ",", "0"}], "]"}]}], "-", 
           RowBox[{
            SqrtBox[
             FractionBox["2", "3"]], " ", 
            RowBox[{"w", "[", 
             RowBox[{"1", ",", "0", ",", "0", ",", "0"}], "]"}]}]}], ")"}]}], 
        "*)"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"g", ",", "result"}], "}"}], " ", "=", " ", 
        RowBox[{"CoefficientArrays", "[", 
         RowBox[{
          RowBox[{"tempBC", "[", 
           RowBox[{"[", "varOdd", "]"}], "]"}], ",", "var"}], "]"}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"IdxVelocity", "=", "2"}], ";", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"result", "\[LeftDoubleBracket]", 
         RowBox[{"1", ",", "IdxVelocity"}], "\[RightDoubleBracket]"}], "=", 
        "1"}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"{", 
        RowBox[{"g", ",", "result"}], "}"}]}]}], "\[IndentingNewLine]", 
     "]"}]}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{
     "In", " ", "the", " ", "following", " ", "routine", " ", "we", " ", 
      "compute", " ", "the", " ", "boundary", " ", "matrix", " ", "in", " ", 
      "the", " ", "form", " ", "BU"}], " ", "=", " ", 
     RowBox[{"G", " ", "for", " ", "an", " ", "inflow", " ", "condition"}]}], 
    "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"DevelopBInflow", "[", 
     RowBox[{"BC_", ",", "var_", ",", "varOdd_"}], "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"Btemp", ",", "g", ",", "result"}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
       "extract", " ", "the", " ", "boundary", " ", "conditions", " ", 
        "corresponding", " ", "to", " ", "odd", " ", "variables"}], "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"Btemp", " ", "=", " ", 
        RowBox[{"Simplify", "[", 
         RowBox[{
          SqrtBox["\[Pi]"], 
          RowBox[{
          "BC", "\[LeftDoubleBracket]", "varOdd", "\[RightDoubleBracket]"}]}],
          "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"g", ",", "result"}], "}"}], " ", "=", " ", 
        RowBox[{"CoefficientArrays", "[", 
         RowBox[{"Btemp", ",", "var"}], "]"}]}], ";", "\[IndentingNewLine]", 
       "result"}]}], "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]"}]}]], "Input",
 CellChangeTimes->{{3.679647031917143*^9, 3.679647099911919*^9}, {
   3.679647215405871*^9, 3.67964728826398*^9}, {3.6796484868649893`*^9, 
   3.679648488782342*^9}, {3.6796485244476013`*^9, 3.679648525695869*^9}, {
   3.679648742279809*^9, 3.679648753999201*^9}, {3.679649364927759*^9, 
   3.679649374503847*^9}, {3.679649553342266*^9, 3.679649559116745*^9}, {
   3.679649623489869*^9, 3.6796496981446133`*^9}, {3.6796506594678926`*^9, 
   3.679650677994932*^9}, {3.679650850019477*^9, 3.6796508501766357`*^9}, {
   3.6796512773207073`*^9, 3.679651309105542*^9}, {3.67965930190547*^9, 
   3.679659632195958*^9}, {3.679659704687038*^9, 3.6796597053883142`*^9}, {
   3.679659768552642*^9, 3.679659775808573*^9}, {3.679660123500009*^9, 
   3.6796602527414722`*^9}, {3.679660462917212*^9, 3.6796605811999187`*^9}, {
   3.679660614979422*^9, 3.679660617882406*^9}, {3.6796606871495523`*^9, 
   3.679660705067223*^9}, {3.6796614116396027`*^9, 3.6796614135224943`*^9}, {
   3.679661497750643*^9, 3.679661543977549*^9}, 3.679661641355783*^9, 
   3.6796618491080236`*^9, {3.679661970884364*^9, 3.6796620080156193`*^9}, {
   3.6796620497447033`*^9, 3.6796621062577963`*^9}, {3.679662150539589*^9, 
   3.679662366018393*^9}, {3.6796628306656303`*^9, 3.6796628489529676`*^9}, {
   3.6796628864871283`*^9, 3.679662889388175*^9}, {3.679662922081427*^9, 
   3.679662927207323*^9}, 3.67966300388706*^9, {3.6796630411492643`*^9, 
   3.679663175531505*^9}, {3.679663207465036*^9, 3.679663269879057*^9}, 
   3.6796633110827436`*^9, {3.679663349467235*^9, 3.679663468406846*^9}, {
   3.6796634992825203`*^9, 3.679663538495411*^9}, {3.679663586855328*^9, 
   3.6796635882569*^9}, {3.679722450330904*^9, 3.679722548974909*^9}, {
   3.679722581041194*^9, 3.679722727763695*^9}, {3.679722760837673*^9, 
   3.679722775734234*^9}, {3.6797240814788237`*^9, 3.679724114527561*^9}, {
   3.6797241679925337`*^9, 3.6797242389002028`*^9}, {3.6797243783707447`*^9, 
   3.679724473700451*^9}, {3.6797245160083323`*^9, 3.679724516734179*^9}, {
   3.679724803003631*^9, 3.679724977591249*^9}, {3.679725017315276*^9, 
   3.679725105084105*^9}, {3.679725185424803*^9, 3.679725373094212*^9}, {
   3.679725463114794*^9, 3.679725501313965*^9}, {3.679725576743939*^9, 
   3.67972567967268*^9}, {3.679725750428523*^9, 3.679725788036639*^9}, {
   3.679725834327087*^9, 3.679726201118889*^9}, {3.679726346100215*^9, 
   3.679726357432131*^9}, {3.679726410106641*^9, 3.679726601275735*^9}, {
   3.679726668616539*^9, 3.6797267665475597`*^9}, {3.6797267989515533`*^9, 
   3.679726818665327*^9}, {3.679727033633028*^9, 3.679727041249545*^9}, {
   3.679727400536808*^9, 3.679727563121554*^9}, {3.679728626457303*^9, 
   3.679728672305711*^9}, {3.679728898829811*^9, 3.679728913669427*^9}, {
   3.679734045130917*^9, 3.67973408405052*^9}, {3.679734273226388*^9, 
   3.67973430322889*^9}, {3.679734435313775*^9, 3.6797345922328243`*^9}, {
   3.679734737770137*^9, 3.679734834790203*^9}, {3.679734873487105*^9, 
   3.679734902803897*^9}, {3.6797362596256523`*^9, 3.679736267148348*^9}, {
   3.679736331834815*^9, 3.679736333923428*^9}, {3.679736619804406*^9, 
   3.679737051100614*^9}, {3.6797380919047318`*^9, 3.67973825996982*^9}, {
   3.679738307515477*^9, 3.679738362515954*^9}, {3.6797384077455387`*^9, 
   3.679738466367291*^9}, {3.679738522307621*^9, 3.6797385252578278`*^9}, {
   3.6797386022815123`*^9, 3.679738625892692*^9}, {3.679738708770852*^9, 
   3.679738763873699*^9}, {3.679738804565854*^9, 3.6797388316598377`*^9}, {
   3.6797388624211807`*^9, 3.679738865790346*^9}, {3.67973890511226*^9, 
   3.679738960222994*^9}, {3.679738996529152*^9, 3.679739064946948*^9}, {
   3.679739102457986*^9, 3.6797391732013702`*^9}, {3.679739353391523*^9, 
   3.6797394039037037`*^9}, {3.679739454280705*^9, 3.6797394702912903`*^9}, {
   3.679739501452456*^9, 3.679739501804695*^9}, {3.6797395629368153`*^9, 
   3.679739593131974*^9}, 3.679739823865004*^9, {3.679739858130385*^9, 
   3.679739899019606*^9}, {3.679739935508493*^9, 3.679739937043545*^9}, {
   3.679739983964518*^9, 3.679739984370578*^9}, {3.679740060382936*^9, 
   3.679740132752553*^9}, {3.679740193467099*^9, 3.6797401944604*^9}, {
   3.679740229644825*^9, 3.679740242656685*^9}, {3.679740436064118*^9, 
   3.679740476028513*^9}, {3.679740560566556*^9, 3.6797405928939323`*^9}, {
   3.679740685779406*^9, 3.6797406966742573`*^9}, {3.679741288740939*^9, 
   3.6797413169203863`*^9}, {3.681699510570191*^9, 3.6816996415912037`*^9}, {
   3.6820567666310043`*^9, 3.6820568166170797`*^9}, {3.68205685261432*^9, 
   3.6820568627715597`*^9}, {3.682056931357942*^9, 3.68205718473075*^9}, {
   3.682057295607514*^9, 3.6820573154211607`*^9}, {3.682057349062747*^9, 
   3.6820573532005653`*^9}, {3.682057391368606*^9, 3.682057412052238*^9}, {
   3.682057564503291*^9, 3.6820576716725407`*^9}, {3.682057734827366*^9, 
   3.682057740922875*^9}, {3.682057785019495*^9, 3.6820577852141333`*^9}, {
   3.682084444148243*^9, 3.68208445845392*^9}, {3.6820845064468603`*^9, 
   3.682084517422271*^9}, {3.682084746582309*^9, 3.682084753414194*^9}, {
   3.6859664484200077`*^9, 3.6859664485360823`*^9}, {3.685966505484065*^9, 
   3.685966551779746*^9}, {3.685966595818513*^9, 3.6859666146993713`*^9}, {
   3.685967932600307*^9, 3.685968004341529*^9}, {3.685968075979526*^9, 
   3.685968096661929*^9}, {3.69675882583768*^9, 3.6967588639830713`*^9}, {
   3.696758906938291*^9, 3.69675893053557*^9}, {3.6967590216559877`*^9, 
   3.696759124863657*^9}, {3.696759342597978*^9, 3.6967593486543837`*^9}, {
   3.696759705837371*^9, 3.696759725189825*^9}, {3.702199211023776*^9, 
   3.702199224397724*^9}}],

Cell[BoxData["\[IndentingNewLine]"], "Input",
 CellChangeTimes->{3.6859680857598658`*^9}]
}, Closed]],

Cell[CellGroupData[{

Cell["Permutation matrix", "Subsection",
 CellChangeTimes->{{3.680327984984622*^9, 3.680327987665279*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
    RowBox[{
    "Returns", " ", "a", " ", "transformation", " ", "matrix", " ", "from", 
     " ", "var2", " ", "to", " ", "var1", " ", 
     RowBox[{"i", ".", "e", ".", " ", "var1"}]}], "=", 
    RowBox[{"Perm", " ", "v2"}]}], "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"PermuteVar", "[", 
    RowBox[{"var1_", ",", "var2_"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"result", ",", "nEqn", ",", "pos"}], "}"}], ",", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"nEqn", " ", "=", " ", 
       RowBox[{"Length", "[", "var1", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"result", " ", "=", " ", 
       RowBox[{"ConstantArray", "[", 
        RowBox[{"0", ",", 
         RowBox[{"{", 
          RowBox[{"nEqn", ",", "nEqn"}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"Do", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"pos", " ", "=", " ", 
          RowBox[{"Flatten", "[", 
           RowBox[{"Position", "[", 
            RowBox[{"var2", ",", 
             RowBox[{"var1", "[", 
              RowBox[{"[", "ii", "]"}], "]"}]}], "]"}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"result", "\[LeftDoubleBracket]", 
           RowBox[{"ii", ",", "pos"}], "\[RightDoubleBracket]"}], "=", 
          "1"}]}], ",", 
        RowBox[{"{", 
         RowBox[{"ii", ",", "1", ",", "nEqn"}], "}"}]}], "]"}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", "result"}]}], 
    "\[IndentingNewLine]", "\[IndentingNewLine]", "]"}]}]}]], "Input",
 CellChangeTimes->{{3.68032799203395*^9, 3.680328159490745*^9}, {
  3.680328224863463*^9, 3.680328228463756*^9}, {3.680328262829427*^9, 
  3.6803282757897787`*^9}, {3.6803283197812233`*^9, 3.680328410397325*^9}}]
}, Closed]],

Cell[CellGroupData[{

Cell["General entropy functional and symmetrizer", "Subsection",
 CellChangeTimes->{{3.679741321743362*^9, 3.679741332014262*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
   "repetitions", " ", "of", " ", "a", " ", "particular", " ", "index", " ", 
    "\"\<a\>\"", " ", "in", " ", "a", " ", "symmetric", " ", "matrix"}], 
   "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"coeffEntropySym", "[", "a_", "]"}], ":=", 
     FractionBox[
      RowBox[{
       RowBox[{"Total", "[", "a", "]"}], "!"}], 
      RowBox[{
       RowBox[{
        RowBox[{"a", "[", 
         RowBox[{"[", "1", "]"}], "]"}], "!"}], 
       RowBox[{
        RowBox[{"a", "[", 
         RowBox[{"[", "2", "]"}], "]"}], "!"}], 
       RowBox[{
        RowBox[{"a", "[", 
         RowBox[{"[", "3", "]"}], "]"}], "!"}]}]]}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
    "entropy", " ", "contribution", " ", "from", " ", "a", " ", "particular", 
     " ", "degree", " ", "of", " ", "tensor"}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Symmetrizer", "[", "deg_", "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "varIdxComplete", ",", "coeffSym", ",", "varIdxCompleteTrf", ",", 
        "TrfComp", ",", "Halfentropy", ",", "\[Alpha]values", ",", "numComp", 
        ",", "ValueTrf", ",", "LocateTrf", ",", "varTrf", ",", "symmetrizer1",
         ",", "symmetrizer2", ",", "PosVar2D", ",", "Var2D"}], "}"}], ",", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
       "list", " ", "of", " ", "variables", " ", "if", " ", "the", " ", 
        "tensors", " ", "are", " ", "symmetric"}], "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"varIdxComplete", " ", "=", "  ", 
        RowBox[{"Map", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"w", "[", "#", "]"}], "&"}], ",", 
          RowBox[{"IDX", "[", "deg", "]"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"varIdxCompleteTrf", " ", "=", " ", 
        RowBox[{"trf2sym", "[", 
         RowBox[{"Map", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"w", "[", "#", "]"}], "&"}], ",", 
           RowBox[{"IDXtrf", "[", "deg", "]"}]}], "]"}], "]"}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{"number", " ", "of", " ", "components"}], "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"numComp", " ", "=", " ", 
        RowBox[{"Length", "[", "varIdxComplete", "]"}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
        "entropy", " ", "for", " ", "a", " ", "symmetric", " ", "system"}], 
        "*)"}], "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{"entropy", " ", "=", " ", 
          RowBox[{
           RowBox[{"U", "^", "T"}], " ", "U"}]}], ",", " ", 
         RowBox[{
          RowBox[{"Half", " ", "Entropy"}], " ", "=", " ", "U"}]}], "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"Halfentropy", " ", "=", " ", 
        RowBox[{"varIdxComplete", "*", 
         RowBox[{"Map", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"\[Alpha]", "[", "#", "]"}], "&"}], ",", 
           RowBox[{"Range", "[", 
            RowBox[{"1", ",", "numComp"}], "]"}]}], "]"}]}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"\[Alpha]values", " ", "=", " ", 
        RowBox[{"Flatten", "[", 
         RowBox[{"ConstantArray", "[", 
          RowBox[{"0", ",", 
           RowBox[{"{", 
            RowBox[{"1", ",", "numComp"}], "}"}]}], "]"}], "]"}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
        "coefficients", " ", "if", " ", "tensors", " ", "were", " ", 
         "symmetric"}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{"Do", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"\[Alpha]values", "[", 
           RowBox[{"[", "ii", "]"}], "]"}], "=", 
          RowBox[{
           RowBox[{"\[Alpha]", "[", "ii", "]"}], "\[Rule]", 
           RowBox[{"coeffEntropySym", "[", 
            RowBox[{
             RowBox[{"varIdxComplete", "[", 
              RowBox[{"[", "ii", "]"}], "]"}], "[", 
             RowBox[{"[", "1", "]"}], "]"}], "]"}]}]}], ",", 
         RowBox[{"{", 
          RowBox[{"ii", ",", "1", ",", "numComp"}], "}"}]}], "]"}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"Halfentropy", " ", "=", " ", 
        RowBox[{"Halfentropy", "/.", "\[Alpha]values"}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
        "value", " ", "of", " ", "the", " ", "Trf", " ", "Components"}], 
        "*)"}], "\[IndentingNewLine]", 
       RowBox[{"LocateTrf", " ", "=", " ", 
        RowBox[{"Flatten", "[", 
         RowBox[{"ConstantArray", "[", 
          RowBox[{"0", ",", 
           RowBox[{"{", 
            RowBox[{"1", ",", 
             RowBox[{"Length", "[", "varIdxComplete", "]"}]}], "}"}]}], "]"}],
          "]"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
        "values", " ", "of", " ", "trace", " ", "free", " ", "components"}], 
        "*)"}], "\[IndentingNewLine]", 
       RowBox[{"Do", "[", 
        RowBox[{
         RowBox[{
          RowBox[{
          "LocateTrf", "\[LeftDoubleBracket]", "ii", 
           "\[RightDoubleBracket]"}], "=", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"IDX", "[", "deg", "]"}], "\[IndentingNewLine]", "[", 
              RowBox[{"[", "ii", "]"}], "]"}], "\[Equal]", 
             RowBox[{
              RowBox[{"trf2sym", "[", 
               RowBox[{"IDXtrf", "[", "deg", "]"}], "]"}], 
              "\[LeftDoubleBracket]", "ii", "\[RightDoubleBracket]"}]}], ",", 
            "0", ",", "1"}], "]"}]}], ",", 
         RowBox[{"{", 
          RowBox[{"ii", ",", "1", ",", "numComp"}], "}"}]}], "]"}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"LocateTrf", " ", "=", " ", 
        RowBox[{"Flatten", "[", 
         RowBox[{"Position", "[", 
          RowBox[{"LocateTrf", ",", "1"}], "]"}], "]"}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"ValueTrf", " ", "=", " ", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"varIdxComplete", "[", 
            RowBox[{"[", "idx", "]"}], "]"}], "\[Rule]", 
           RowBox[{"varIdxCompleteTrf", "[", 
            RowBox[{"[", "idx", "]"}], "]"}]}], ",", 
          RowBox[{"{", 
           RowBox[{"idx", ",", "LocateTrf"}], "}"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"Halfentropy", "=", 
        RowBox[{"Halfentropy", "/.", "ValueTrf"}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
        "we", " ", "need", " ", "to", " ", "remove", " ", "the", " ", "last", 
         " ", "component", " ", "since", " ", "it", " ", "has", " ", "been", 
         " ", "replace", " ", "by", " ", "the", " ", "value", " ", "of", " ", 
         "the", " ", "trace", " ", "free", " ", "relation"}], "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"symmetrizer1", " ", "=", " ", 
        RowBox[{
         RowBox[{"CoefficientArrays", "[", 
          RowBox[{"Halfentropy", ",", 
           RowBox[{"Map", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"w", "[", "#", "]"}], "&"}], ",", 
             RowBox[{"IDXtrf", "[", "deg", "]"}]}], "]"}]}], "]"}], "[", 
         RowBox[{"[", "2", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
        "The", " ", "symmetry", " ", "has", " ", "to", " ", "be", " ", "used",
          " ", "in", " ", "only", " ", "one", " ", "of", " ", "the", " ", 
         "vector"}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{"symmetrizer2", " ", "=", " ", 
        RowBox[{
         RowBox[{"CoefficientArrays", "[", 
          RowBox[{
           RowBox[{"varIdxComplete", "/.", "ValueTrf"}], ",", 
           RowBox[{"Map", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"w", "[", "#", "]"}], "&"}], ",", 
             RowBox[{"IDXtrf", "[", "deg", "]"}]}], "]"}]}], "]"}], "[", 
         RowBox[{"[", "2", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
        "The", " ", "entropy", " ", "of", " ", "the", " ", "system", " ", 
         "is", " ", 
         FractionBox["1", "2"], 
         RowBox[{"u", "^", "T"}], " ", 
         RowBox[{"u", ".", " ", "So"}], " ", "the", " ", "symmetrizer", " ", 
         "would", " ", "be", " ", "the", " ", "double", " ", "derivative", 
         " ", "of", " ", 
         RowBox[{"this", "."}]}], "*)"}], "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"symmetrizer1", "=", 
        RowBox[{
         RowBox[{"Transpose", "[", "symmetrizer2", "]"}], ".", 
         "symmetrizer1"}]}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"Var2D", " ", "=", " ", 
        RowBox[{"Pick", "[", 
         RowBox[{
          RowBox[{"IDXtrf", "[", "deg", "]"}], ",", 
          RowBox[{"Flatten", "[", 
           RowBox[{"Join", "[", 
            RowBox[{
             RowBox[{"{", "1", "}"}], ",", 
             RowBox[{"Table", "[", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{"1", ",", "0"}], "}"}], ",", 
               RowBox[{"{", 
                RowBox[{"k", ",", "1", ",", "deg"}], "}"}]}], "]"}]}], "]"}], 
           "]"}], ",", "1"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"PosVar2D", " ", "=", " ", 
        RowBox[{"Flatten", "[", 
         RowBox[{"ConstantArray", "[", 
          RowBox[{"0", ",", 
           RowBox[{"{", 
            RowBox[{"1", ",", 
             RowBox[{"Length", "[", "Var2D", "]"}]}], "}"}]}], "]"}], "]"}]}],
        ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"Do", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"PosVar2D", "[", 
           RowBox[{"[", "ii", "]"}], "]"}], "=", 
          RowBox[{
           RowBox[{"Flatten", "[", 
            RowBox[{"Position", "[", 
             RowBox[{
              RowBox[{"IDXtrf", "[", "deg", "]"}], ",", 
              RowBox[{"Var2D", "[", 
               RowBox[{"[", "ii", "]"}], "]"}]}], "]"}], "]"}], "[", 
           RowBox[{"[", "1", "]"}], "]"}]}], ",", 
         RowBox[{"{", 
          RowBox[{"ii", ",", "1", ",", 
           RowBox[{"Length", "[", "Var2D", "]"}]}], "}"}]}], "]"}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"symmetrizer1", "\[LeftDoubleBracket]", 
        RowBox[{"PosVar2D", ",", "PosVar2D"}], "\[RightDoubleBracket]"}]}]}], 
     "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
    "we", " ", "create", " ", "a", " ", "general", " ", "symmetrizer"}], 
    "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"GenerateSymmetrizer2D", "[", "Ntensors_", "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "size", ",", "symmetrizer", ",", "locDiagonal", ",", "numVar", ",", 
        "deg"}], "}"}], ",", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"degrees", " ", "of", " ", "different", " ", "tensors"}], 
       "*)"}], "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"deg", " ", "=", " ", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{"iTensorDegree", "[", "ii", "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"ii", ",", "1", ",", "Ntensors"}], "}"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
        "size", " ", "corresponding", " ", "to", " ", "every", " ", "tensor", 
         " ", "degree"}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{"size", "=", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{"Length", "[", 
           RowBox[{"Pick", "[", 
            RowBox[{
             RowBox[{"IDXtrf", "[", 
              RowBox[{"deg", "[", 
               RowBox[{"[", "i", "]"}], "]"}], "]"}], ",", 
             RowBox[{"Flatten", "[", 
              RowBox[{"Join", "[", 
               RowBox[{
                RowBox[{"{", "1", "}"}], ",", 
                RowBox[{"Table", "[", 
                 RowBox[{
                  RowBox[{"{", 
                   RowBox[{"1", ",", "0"}], "}"}], ",", 
                  RowBox[{"{", 
                   RowBox[{"k", ",", "1", ",", 
                    RowBox[{"deg", "[", 
                    RowBox[{"[", "i", "]"}], "]"}]}], "}"}]}], "]"}]}], "]"}],
               "]"}], ",", "1"}], "]"}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", "1", ",", "Ntensors"}], "}"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{"Total", " ", "number", " ", "of", " ", "variables"}], "*)"}],
        "\[IndentingNewLine]", 
       RowBox[{"numVar", " ", "=", " ", 
        RowBox[{"Total", "[", "size", "]"}]}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
        "location", " ", "at", " ", "the", " ", "diagonal", " ", "for", " ", 
         "the", " ", "symmetrizer"}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{"locDiagonal", " ", "=", " ", 
        RowBox[{"Flatten", "[", 
         RowBox[{"ConstantArray", "[", 
          RowBox[{"0", ",", 
           RowBox[{"{", 
            RowBox[{"1", ",", 
             RowBox[{
              RowBox[{"Length", "[", "size", "]"}], "+", "1"}]}], "}"}]}], 
          "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"locDiagonal", "[", 
         RowBox[{"[", "1", "]"}], "]"}], " ", "=", "1"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"Do", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"locDiagonal", "[", 
           RowBox[{"[", 
            RowBox[{"ii", "+", "1"}], "]"}], "]"}], "+=", 
          RowBox[{
           RowBox[{"locDiagonal", "[", 
            RowBox[{"[", "ii", "]"}], "]"}], "+", 
           RowBox[{"size", "[", 
            RowBox[{"[", "ii", "]"}], "]"}]}]}], ",", 
         RowBox[{"{", 
          RowBox[{"ii", ",", "1", ",", 
           RowBox[{"Length", "[", "size", "]"}]}], "}"}]}], "]"}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"symmetrizer", " ", "=", " ", 
        RowBox[{"ConstantArray", "[", 
         RowBox[{"0", ",", 
          RowBox[{"{", 
           RowBox[{"numVar", ",", "numVar"}], "}"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"Do", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{"symmetrizer", "\[LeftDoubleBracket]", 
           RowBox[{
            RowBox[{"Range", "[", 
             RowBox[{
              RowBox[{"locDiagonal", "[", 
               RowBox[{"[", "ii", "]"}], "]"}], ",", 
              RowBox[{
               RowBox[{"locDiagonal", "\[LeftDoubleBracket]", 
                RowBox[{"ii", "+", "1"}], "\[RightDoubleBracket]"}], "-", 
               "1"}]}], "]"}], ",", 
            RowBox[{"Range", "[", 
             RowBox[{
              RowBox[{"locDiagonal", "[", 
               RowBox[{"[", "ii", "]"}], "]"}], ",", 
              RowBox[{
               RowBox[{"locDiagonal", "\[LeftDoubleBracket]", 
                RowBox[{"ii", "+", "1"}], "\[RightDoubleBracket]"}], "-", 
               "1"}]}], "]"}]}], "\[RightDoubleBracket]"}], "=", 
          RowBox[{"Symmetrizer", "[", 
           RowBox[{"deg", "[", 
            RowBox[{"[", "ii", "]"}], "]"}], "]"}]}], ",", 
         RowBox[{"{", 
          RowBox[{"ii", ",", "1", ",", 
           RowBox[{"Length", "[", "size", "]"}]}], "}"}]}], "]"}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", "symmetrizer"}]}], 
     "\[IndentingNewLine]", "]"}]}]}]}]], "Input",
 CellChangeTimes->{{3.679647031917143*^9, 3.679647099911919*^9}, {
   3.679647215405871*^9, 3.67964728826398*^9}, {3.6796484868649893`*^9, 
   3.679648488782342*^9}, {3.6796485244476013`*^9, 3.679648525695869*^9}, {
   3.679648742279809*^9, 3.679648753999201*^9}, {3.679649364927759*^9, 
   3.679649374503847*^9}, {3.679649553342266*^9, 3.679649559116745*^9}, {
   3.679649623489869*^9, 3.6796496981446133`*^9}, {3.6796506594678926`*^9, 
   3.679650677994932*^9}, {3.679650850019477*^9, 3.6796508501766357`*^9}, {
   3.6796512773207073`*^9, 3.679651309105542*^9}, {3.67965930190547*^9, 
   3.679659632195958*^9}, {3.679659704687038*^9, 3.6796597053883142`*^9}, {
   3.679659768552642*^9, 3.679659775808573*^9}, {3.679660123500009*^9, 
   3.6796602527414722`*^9}, {3.679660462917212*^9, 3.6796605811999187`*^9}, {
   3.679660614979422*^9, 3.679660617882406*^9}, {3.6796606871495523`*^9, 
   3.679660705067223*^9}, {3.6796614116396027`*^9, 3.6796614135224943`*^9}, {
   3.679661497750643*^9, 3.679661543977549*^9}, 3.679661641355783*^9, 
   3.6796618491080236`*^9, {3.679661970884364*^9, 3.6796620080156193`*^9}, {
   3.6796620497447033`*^9, 3.6796621062577963`*^9}, {3.679662150539589*^9, 
   3.679662366018393*^9}, {3.6796628306656303`*^9, 3.6796628489529676`*^9}, {
   3.6796628864871283`*^9, 3.679662889388175*^9}, {3.679662922081427*^9, 
   3.679662927207323*^9}, 3.67966300388706*^9, {3.6796630411492643`*^9, 
   3.679663175531505*^9}, {3.679663207465036*^9, 3.679663269879057*^9}, 
   3.6796633110827436`*^9, {3.679663349467235*^9, 3.679663468406846*^9}, {
   3.6796634992825203`*^9, 3.679663538495411*^9}, {3.679663586855328*^9, 
   3.6796635882569*^9}, {3.679722450330904*^9, 3.679722548974909*^9}, {
   3.679722581041194*^9, 3.679722727763695*^9}, {3.679722760837673*^9, 
   3.679722775734234*^9}, {3.6797240814788237`*^9, 3.679724114527561*^9}, {
   3.6797241679925337`*^9, 3.6797242389002028`*^9}, {3.6797243783707447`*^9, 
   3.679724473700451*^9}, {3.6797245160083323`*^9, 3.679724516734179*^9}, {
   3.679724803003631*^9, 3.679724977591249*^9}, {3.679725017315276*^9, 
   3.679725105084105*^9}, {3.679725185424803*^9, 3.679725373094212*^9}, {
   3.679725463114794*^9, 3.679725501313965*^9}, {3.679725576743939*^9, 
   3.67972567967268*^9}, {3.679725750428523*^9, 3.679725788036639*^9}, {
   3.679725834327087*^9, 3.679726201118889*^9}, {3.679726346100215*^9, 
   3.679726357432131*^9}, {3.679726410106641*^9, 3.679726601275735*^9}, {
   3.679726668616539*^9, 3.6797267665475597`*^9}, {3.6797267989515533`*^9, 
   3.679726818665327*^9}, {3.679727033633028*^9, 3.679727041249545*^9}, {
   3.679727400536808*^9, 3.679727563121554*^9}, {3.679728626457303*^9, 
   3.679728672305711*^9}, {3.679728898829811*^9, 3.679728913669427*^9}, {
   3.679734045130917*^9, 3.67973408405052*^9}, {3.679734273226388*^9, 
   3.67973430322889*^9}, {3.679734435313775*^9, 3.6797345922328243`*^9}, {
   3.679734737770137*^9, 3.679734834790203*^9}, {3.679734873487105*^9, 
   3.679734902803897*^9}, {3.6797362596256523`*^9, 3.679736267148348*^9}, {
   3.679736331834815*^9, 3.679736333923428*^9}, {3.679736619804406*^9, 
   3.679737051100614*^9}, {3.6797380919047318`*^9, 3.67973825996982*^9}, {
   3.679738307515477*^9, 3.679738362515954*^9}, {3.6797384077455387`*^9, 
   3.679738466367291*^9}, {3.679738522307621*^9, 3.6797385252578278`*^9}, {
   3.6797386022815123`*^9, 3.679738625892692*^9}, {3.679738708770852*^9, 
   3.679738763873699*^9}, {3.679738804565854*^9, 3.6797388316598377`*^9}, {
   3.6797388624211807`*^9, 3.679738865790346*^9}, {3.67973890511226*^9, 
   3.679738960222994*^9}, {3.679738996529152*^9, 3.679739064946948*^9}, {
   3.679739102457986*^9, 3.6797391732013702`*^9}, {3.679739353391523*^9, 
   3.6797394039037037`*^9}, {3.679739454280705*^9, 3.6797394702912903`*^9}, {
   3.679739501452456*^9, 3.679739501804695*^9}, {3.6797395629368153`*^9, 
   3.679739593131974*^9}, 3.679739823865004*^9, {3.679739858130385*^9, 
   3.679739899019606*^9}, {3.679739935508493*^9, 3.679739937043545*^9}, {
   3.679739983964518*^9, 3.679739984370578*^9}, {3.679740060382936*^9, 
   3.679740132752553*^9}, {3.679740193467099*^9, 3.6797401944604*^9}, {
   3.679740229644825*^9, 3.679740242656685*^9}, {3.679740436064118*^9, 
   3.679740476028513*^9}, {3.679740560566556*^9, 3.6797405928939323`*^9}, {
   3.679740685779406*^9, 3.6797406966742573`*^9}, {3.679741288740939*^9, 
   3.6797413169203863`*^9}, {3.6797413838549337`*^9, 3.679741399645192*^9}, {
   3.6799996641723633`*^9, 3.6799997582201653`*^9}, {3.679999795879992*^9, 
   3.6799998338397083`*^9}, {3.6845191381270733`*^9, 
   3.6845191773040133`*^9}, {3.684519868704507*^9, 3.68451990347373*^9}, {
   3.687754562808586*^9, 3.687754572776531*^9}, 3.687754605148147*^9}],

Cell[BoxData[""], "Input",
 CellChangeTimes->{
  3.679734508235077*^9, {3.6797412453982687`*^9, 3.6797412458160887`*^9}, 
   3.679741342228931*^9}]
}, Closed]],

Cell[CellGroupData[{

Cell["Final Matrices", "Subsection",
 CellChangeTimes->{{3.702199052814036*^9, 3.7021990549577427`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
   "check", " ", "whether", " ", "a", " ", "given", " ", "matrix", " ", "is", 
    " ", "spd", " ", "or", " ", "not"}], "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"CheckSPD", "[", 
     RowBox[{"Mat_", ",", "matrixname_"}], "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"entries", ",", "error", ",", "EV", ",", 
        RowBox[{"$MaxExtraPrecision", "=", "150"}]}], "}"}], ",", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"Print", "[", 
        RowBox[{"Style", "[", 
         RowBox[{"matrixname", ",", 
          RowBox[{"FontColor", "\[Rule]", "Magenta"}]}], "]"}], "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"entries", "=", 
        RowBox[{"Length", "[", 
         RowBox[{"Flatten", "[", "Mat", "]"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"error", "=", 
        RowBox[{"Chop", "[", 
         RowBox[{"Simplify", "[", 
          RowBox[{"Mat", "-", 
           RowBox[{"Transpose", "[", "Mat", "]"}]}], "]"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"EV", "=", 
        RowBox[{"Chop", "[", 
         RowBox[{"N", "[", 
          RowBox[{"Eigenvalues", "[", 
           RowBox[{"N", "[", "Mat", "]"}], "]"}], "]"}], "]"}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{
         "check", " ", "for", " ", "the", " ", "symmetricity", " ", "of", " ",
           "the", " ", "matrices", " ", "by", " ", "computing", " ", "A"}], 
         " ", "-", " ", 
         RowBox[{"Transpose", "[", "A", "]"}]}], "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Count", "[", 
           RowBox[{
            RowBox[{"Flatten", "[", "error", "]"}], ",", "0"}], "]"}], 
          "\[NotEqual]", "entries"}], ",", 
         RowBox[{"Print", "[", 
          RowBox[{"Style", "[", 
           RowBox[{"\"\<Not Symmetric\>\"", ",", 
            RowBox[{"FontColor", "\[Rule]", "Red"}]}], "]"}], "]"}], ",", 
         RowBox[{"Print", "[", 
          RowBox[{"Style", "[", 
           RowBox[{"\"\<Symmetric\>\"", ",", 
            RowBox[{"FontColor", "\[Rule]", "Green"}]}], "]"}], "]"}]}], 
        "]"}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
        "compute", " ", "the", " ", "positive", " ", "definetness", " ", "by",
          " ", "computing", " ", "the", " ", "eigenvalues"}], "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Length", "[", 
           RowBox[{"Select", "[", 
            RowBox[{"EV", ",", 
             RowBox[{
              RowBox[{"#", "<=", "0"}], "&"}]}], "]"}], "]"}], ">", "0"}], 
         ",", 
         RowBox[{"Print", "[", 
          RowBox[{"Style", "[", 
           RowBox[{"\"\<Negative Definite\>\"", ",", 
            RowBox[{"FontColor", "\[Rule]", "Red"}]}], "]"}], "]"}], ",", 
         RowBox[{"Print", "[", 
          RowBox[{"Style", "[", 
           RowBox[{"\"\<Positive Definite\>\"", ",", 
            RowBox[{"FontColor", "\[Rule]", "Green"}]}], "]"}], "]"}]}], 
        "]"}], ";"}]}], "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]",
    "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
    "check", " ", "symmetric", " ", "positive", " ", "semi", " ", 
     "definite"}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"CheckSPSD", "[", 
     RowBox[{"Mat_", ",", "matrixname_"}], "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"entries", ",", "error", ",", "EV", ",", 
        RowBox[{"$MaxExtraPrecision", "=", "150"}]}], "}"}], ",", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"Print", "[", 
        RowBox[{"Style", "[", 
         RowBox[{"matrixname", ",", 
          RowBox[{"FontColor", "\[Rule]", "Magenta"}]}], "]"}], "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"entries", "=", 
        RowBox[{"Length", "[", 
         RowBox[{"Flatten", "[", "Mat", "]"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"error", "=", 
        RowBox[{"Chop", "[", 
         RowBox[{"Simplify", "[", 
          RowBox[{"Mat", "-", 
           RowBox[{"Transpose", "[", "Mat", "]"}]}], "]"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"EV", "=", 
        RowBox[{"Chop", "[", 
         RowBox[{"N", "[", 
          RowBox[{"Eigenvalues", "[", 
           RowBox[{"N", "[", "Mat", "]"}], "]"}], "]"}], "]"}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Count", "[", 
           RowBox[{
            RowBox[{"Flatten", "[", "error", "]"}], ",", "0"}], "]"}], 
          "\[NotEqual]", "entries"}], ",", 
         RowBox[{"Print", "[", 
          RowBox[{"Style", "[", 
           RowBox[{"\"\<Not Symmetric\>\"", ",", 
            RowBox[{"FontColor", "\[Rule]", "Red"}]}], "]"}], "]"}], ",", 
         RowBox[{"Print", "[", 
          RowBox[{"Style", "[", 
           RowBox[{"\"\<Symmetric\>\"", ",", 
            RowBox[{"FontColor", "\[Rule]", "Green"}]}], "]"}], "]"}]}], 
        "]"}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Length", "[", 
           RowBox[{"Select", "[", 
            RowBox[{"EV", ",", 
             RowBox[{
              RowBox[{"#", "<", "0"}], "&"}]}], "]"}], "]"}], ">", "0"}], ",", 
         RowBox[{"Print", "[", 
          RowBox[{"Style", "[", 
           RowBox[{"\"\<Negative Definite\>\"", ",", 
            RowBox[{"FontColor", "\[Rule]", "Red"}]}], "]"}], "]"}], ",", 
         RowBox[{"Print", "[", 
          RowBox[{"Style", "[", 
           RowBox[{"\"\<Positive Definite\>\"", ",", 
            RowBox[{"FontColor", "\[Rule]", "Green"}]}], "]"}], "]"}]}], 
        "]"}], ";"}]}], "\[IndentingNewLine]", "]"}]}]}]}]], "Input"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
   "matrices", " ", "using", " ", "the", " ", "basis", " ", "functions", " ", 
    "used", " ", "by", " ", "manuel"}], "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"FinalMatricesDiffBasis", "[", "Ntensors_", "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "Ax", ",", "Ay", ",", "Shalf", ",", "ShalfInv", ",", "S", ",", "BC", 
       ",", "result", ",", "var", ",", "varOdd", ",", "g", ",", "B", ",", 
       "nEqn", ",", "varEven", ",", "varRearranged", ",", "PermuteMatrix", 
       ",", "EntropyMat", ",", "Boe", ",", "OnsagerMat", ",", "Soe", ",", 
       "PermuteMatInv", ",", "BCMat", ",", "filenameAx", ",", "filenameAy", 
       ",", "filenameB", ",", "filenameOddID", ",", "filenameBinflow", ",", 
       "percision", ",", 
       RowBox[{"$MaxExtraPrecision", "=", "150"}], ",", "Sigma", ",", 
       "BoeMBC", ",", "filenameSigma", ",", "Binflow", ",", "Boeinflow", ",", 
       "OnsagerMatInflow", ",", "TransfMatrix", ",", "BMBC"}], " ", "}"}], 
     ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{
       RowBox[{"result", "=", 
        RowBox[{"DiffBasisGetMatrices2D", "[", "Ntensors", "]"}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
        "Boundary", " ", "conditions", " ", "from", " ", "the", " ", 
         "Maxwell", " ", "accommodation", " ", "model"}], "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"BC", "=", 
        RowBox[{
        "result", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}]}], 
       ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{
         "jacobian", " ", "of", " ", "the", " ", "flux", " ", "in", " ", 
          "the", " ", "x"}], "-", "direction"}], "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"Ax", " ", "=", " ", 
        RowBox[{
        "result", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}]}], 
       ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{
         "jacobian", " ", "of", " ", "the", " ", "flux", " ", "in", " ", 
          "the", " ", "y"}], "-", "direction"}], "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"Ay", " ", "=", " ", 
        RowBox[{
        "result", "\[LeftDoubleBracket]", "3", "\[RightDoubleBracket]"}]}], 
       ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
        "variables", " ", "being", " ", "considered", " ", "in", " ", "the", 
         " ", "system"}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{"var", " ", "=", " ", 
        RowBox[{
        "result", "\[LeftDoubleBracket]", "4", "\[RightDoubleBracket]"}]}], 
       ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
        "odd", " ", "variables", " ", "in", " ", "the", " ", "system"}], 
        "*)"}], "\[IndentingNewLine]", 
       RowBox[{"varOdd", " ", "=", " ", 
        RowBox[{
        "result", "\[LeftDoubleBracket]", "5", "\[RightDoubleBracket]"}]}], 
       ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{"no", " ", "relaxational", " ", "normal", " ", "velocity"}], 
        "*)"}], "\[IndentingNewLine]", 
       RowBox[{"B", " ", "=", " ", 
        RowBox[{
         RowBox[{"DevelopBNoRelax", "[", 
          RowBox[{"BC", ",", "var", ",", "varOdd"}], "]"}], 
         "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"BMBC", " ", "=", " ", "B"}], ";", "\[IndentingNewLine]", 
       RowBox[{"Binflow", " ", "=", " ", 
        RowBox[{"DevelopBInflow", "[", 
         RowBox[{"BC", ",", "var", ",", "varOdd"}], "]"}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
        "Matrix", " ", "to", " ", "transform", " ", "between", " ", 
         "variables"}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{"TransfMatrix", " ", "=", " ", 
        RowBox[{"TransfMat", "[", "var", "]"}]}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{"full", " ", 
         RowBox[{"symmetrizer", ".", " ", "We"}], " ", "create", " ", "the", 
         " ", "symmetrizer", " ", "for", " ", "the", " ", "old", " ", 
         "variables", " ", "and", " ", "then", " ", "convert", " ", "then", 
         " ", "back"}], " ", "*)"}], "\[IndentingNewLine]", 
       RowBox[{"S", "=", 
        RowBox[{
         RowBox[{"Inverse", "[", "TransfMatrix", "]"}], ".", 
         RowBox[{"GenerateSymmetrizer2D", "[", "Ntensors", "]"}], ".", 
         "TransfMatrix"}]}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", 
        SuperscriptBox["S", 
         RowBox[{"1", "/", "2"}]], "*)"}], "\[IndentingNewLine]", 
       RowBox[{"Shalf", "=", 
        RowBox[{"MatrixPower", "[", 
         RowBox[{"S", ",", "0.5"}], "]"}]}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", 
        SuperscriptBox["S", 
         RowBox[{
          RowBox[{"-", "1"}], "/", "2"}]], "*)"}], "\[IndentingNewLine]", 
       RowBox[{"ShalfInv", "=", 
        RowBox[{"MatrixPower", "[", 
         RowBox[{"S", ",", 
          RowBox[{"-", "0.5"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"nEqn", "=", 
        RowBox[{"Length", "[", "Ax", "]"}]}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
        "Even", " ", "variables", " ", "in", " ", "the", " ", "system"}], 
        "*)"}], "\[IndentingNewLine]", 
       RowBox[{"varEven", " ", "=", " ", 
        RowBox[{"Delete", "[", 
         RowBox[{
          RowBox[{"Range", "[", 
           RowBox[{"1", ",", "nEqn"}], "]"}], ",", 
          RowBox[{"Map", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"{", "#", "}"}], "&"}], ",", "varOdd"}], "]"}]}], 
         "]"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
        "Now", " ", "we", " ", "sort", " ", "the", " ", "variables", " ", 
         "considering", " ", "an", " ", "even", " ", "and", " ", "an", " ", 
         "odd", " ", "splitting"}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{"varRearranged", " ", "=", 
        RowBox[{"Flatten", "[", 
         RowBox[{"ConstantArray", "[", 
          RowBox[{"0", ",", 
           RowBox[{"{", 
            RowBox[{"1", ",", "nEqn"}], "}"}]}], "]"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"varRearranged", "\[LeftDoubleBracket]", 
         RowBox[{"1", ";;", 
          RowBox[{"Length", "[", "varOdd", "]"}]}], "\[RightDoubleBracket]"}],
         "=", 
        RowBox[{
        "var", "\[LeftDoubleBracket]", "varOdd", "\[RightDoubleBracket]"}]}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"varRearranged", "\[LeftDoubleBracket]", 
         RowBox[{
          RowBox[{"-", 
           RowBox[{"Length", "[", "varEven", "]"}]}], ";;", 
          RowBox[{"-", "1"}]}], "\[RightDoubleBracket]"}], "=", 
        RowBox[{
        "var", "\[LeftDoubleBracket]", "varEven", "\[RightDoubleBracket]"}]}],
        ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{"var", " ", "=", " ", 
         RowBox[{"PermuteMatrix", ".", "varRearranged"}]}], "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"PermuteMatrix", " ", "=", " ", 
        RowBox[{"PermuteVar", "[", 
         RowBox[{"var", ",", "varRearranged"}], "]"}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{"varRearranged", " ", "=", " ", 
         RowBox[{"PermuteMatInv", ".", "var"}]}], "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"PermuteMatInv", "=", 
        RowBox[{"PermuteVar", "[", 
         RowBox[{"varRearranged", ",", "var"}], "]"}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
        "jacobian", " ", "of", " ", "the", " ", "entropy", " ", "flux", " ", 
         "of", " ", "the", " ", "system"}], " ", "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"EntropyMat", " ", "=", " ", 
        RowBox[{
         RowBox[{"Transpose", "[", "PermuteMatrix", "]"}], ".", "S", ".", 
         "Ax", ".", "PermuteMatrix"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"Soe", " ", "=", " ", 
        RowBox[{"EntropyMat", "\[LeftDoubleBracket]", 
         RowBox[{
          RowBox[{"1", ";;", 
           RowBox[{"Length", "[", "varOdd", "]"}]}], ",", 
          RowBox[{
           RowBox[{"-", 
            RowBox[{"Length", "[", "varEven", "]"}]}], ";;", 
           RowBox[{"-", "1"}]}]}], "\[RightDoubleBracket]"}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
        "Penalty", " ", "matrix", " ", "for", " ", "the", " ", "weak", " ", 
         "implementation", " ", "of", " ", "the", " ", "boundary", " ", 
         "conditions"}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{"Sigma", " ", "=", " ", 
        RowBox[{
         RowBox[{"Transpose", "[", "PermuteMatInv", "]"}], ".", 
         RowBox[{"EntropyMat", "\[LeftDoubleBracket]", 
          RowBox[{"All", ",", 
           RowBox[{"1", ";;", 
            RowBox[{"Length", "[", "varOdd", "]"}]}]}], 
          "\[RightDoubleBracket]"}]}]}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
        "Permute", " ", "B", " ", "using", " ", "even", " ", "and", " ", 
         "odd", " ", "splitting"}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{"B", "=", 
        RowBox[{"B", ".", "PermuteMatrix"}]}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"Binflow", " ", "=", " ", 
        RowBox[{"Binflow", ".", "PermuteMatrix"}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{
         "Boundary", " ", "Conditions", " ", "of", " ", "the", " ", "form", 
          " ", "Uo"}], "=", 
         RowBox[{
          RowBox[{"Boe", "*", 
           RowBox[{"Ue", ".", " ", "Till"}], " ", "now", " ", "the", " ", 
           "boundary", " ", "conditions", " ", "were", " ", "given", " ", 
           "in", " ", "the", " ", "form", " ", 
           RowBox[{"B", ".", "U"}]}], " ", "=", " ", 
          RowBox[{
           RowBox[{
           "0", " ", "where", " ", "U", " ", "was", " ", "arranged", " ", 
            "as", " ", "U"}], " ", "=", " ", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"(", 
               RowBox[{"Uo", ",", "Ue"}], ")"}], ".", " ", "Therefore"}], " ",
              "our", " ", "boundary", " ", "condition", " ", "can", " ", "be",
              " ", "decomposed", " ", "as", " ", 
             RowBox[{"Bo", ".", "Uo"}]}], " ", "=", " ", 
            RowBox[{
             RowBox[{
              RowBox[{"-", 
               RowBox[{"Be", ".", "Ue", ".", " ", "Thus"}]}], " ", "our", " ",
               "matrix", " ", "Boe", " ", "will", " ", "be", " ", "given", 
              " ", "as", " ", "Boe"}], " ", "=", " ", 
             RowBox[{"-", 
              RowBox[{
               RowBox[{"Inv", "[", "Bo", "]"}], ".", "Be"}]}]}]}]}]}]}], " ", 
        "*)"}], "\[IndentingNewLine]", 
       RowBox[{"Boe", " ", "=", " ", 
        RowBox[{"-", 
         RowBox[{
          RowBox[{"Inverse", "[", 
           RowBox[{"B", "\[LeftDoubleBracket]", 
            RowBox[{
             RowBox[{"1", ";;", 
              RowBox[{"-", "1"}]}], ",", 
             RowBox[{"1", ";;", 
              RowBox[{"Length", "[", "varOdd", "]"}]}]}], 
            "\[RightDoubleBracket]"}], "]"}], ".", 
          RowBox[{"B", "\[LeftDoubleBracket]", 
           RowBox[{
            RowBox[{"1", ";;", 
             RowBox[{"-", "1"}]}], ",", 
            RowBox[{
             RowBox[{
              RowBox[{"Length", "[", "varOdd", "]"}], "+", "1"}], ";;", 
             RowBox[{"-", "1"}]}]}], "\[RightDoubleBracket]"}]}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"Boeinflow", " ", "=", " ", 
        RowBox[{"-", 
         RowBox[{
          RowBox[{"Inverse", "[", 
           RowBox[{"Binflow", "\[LeftDoubleBracket]", 
            RowBox[{
             RowBox[{"1", ";;", 
              RowBox[{"-", "1"}]}], ",", 
             RowBox[{"1", ";;", 
              RowBox[{"Length", "[", "varOdd", "]"}]}]}], 
            "\[RightDoubleBracket]"}], "]"}], ".", 
          RowBox[{"Binflow", "\[LeftDoubleBracket]", 
           RowBox[{
            RowBox[{"1", ";;", 
             RowBox[{"-", "1"}]}], ",", 
            RowBox[{
             RowBox[{
              RowBox[{"Length", "[", "varOdd", "]"}], "+", "1"}], ";;", 
             RowBox[{"-", "1"}]}]}], "\[RightDoubleBracket]"}]}]}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
        "We", " ", "ignore", " ", "the", " ", "first", " ", "boundary", " ", 
         "conditions", " ", "and", " ", "will", " ", "deal", " ", "with", " ",
          "it", " ", "later"}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{"OnsagerMat", "=", 
        RowBox[{"ConstantArray", "[", 
         RowBox[{"0", ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"Length", "[", "varOdd", "]"}], ",", 
            RowBox[{"Length", "[", "varOdd", "]"}]}], "}"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"OnsagerMat", "=", 
        RowBox[{"Simplify", "[", 
         RowBox[{
          RowBox[{"Boe", "\[LeftDoubleBracket]", 
           RowBox[{
            RowBox[{"1", ";;", 
             RowBox[{"-", "1"}]}], ",", 
            RowBox[{"1", ";;", 
             RowBox[{"Length", "[", "Boe", "]"}]}]}], 
           "\[RightDoubleBracket]"}], ".", 
          RowBox[{"Inverse", "[", 
           RowBox[{"Soe", "\[LeftDoubleBracket]", 
            RowBox[{
             RowBox[{"1", ";;", 
              RowBox[{"-", "1"}]}], ",", 
             RowBox[{"1", ";;", 
              RowBox[{"Length", "[", "Soe", "]"}]}]}], 
            "\[RightDoubleBracket]"}], "]"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"OnsagerMatInflow", "=", 
        RowBox[{"Simplify", "[", 
         RowBox[{
          RowBox[{"Boeinflow", "\[LeftDoubleBracket]", 
           RowBox[{
            RowBox[{"1", ";;", 
             RowBox[{"-", "1"}]}], ",", 
            RowBox[{"1", ";;", 
             RowBox[{"Length", "[", "Boeinflow", "]"}]}]}], 
           "\[RightDoubleBracket]"}], ".", 
          RowBox[{"Inverse", "[", 
           RowBox[{"Soe", "\[LeftDoubleBracket]", 
            RowBox[{
             RowBox[{"1", ";;", 
              RowBox[{"-", "1"}]}], ",", 
             RowBox[{"1", ";;", 
              RowBox[{"Length", "[", "Soe", "]"}]}]}], 
            "\[RightDoubleBracket]"}], "]"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
        "Now", " ", "we", " ", "fix", " ", "the", " ", "normal", " ", 
         "velocity", " ", "by", " ", "considering", " ", "the", " ", "first", 
         " ", "row", " ", "of", " ", "Soe", " ", "to", " ", "be", " ", "the", 
         " ", "boundary", " ", "condition", " ", "for", " ", "the", " ", 
         "normal", " ", "velocity"}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"OnsagerMat", "\[LeftDoubleBracket]", 
         RowBox[{"1", ",", "1"}], "\[RightDoubleBracket]"}], "=", "1"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"CheckSPD", "[", 
        RowBox[{"OnsagerMat", ",", "\"\<Onsager Mat\>\""}], "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"CheckSPD", "[", 
        RowBox[{"OnsagerMatInflow", ",", "\"\<Onsager Mat Inflow\>\""}], 
        "]"}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{
         "Finally", " ", "we", " ", "have", " ", "the", " ", "new", " ", 
          "boundary", " ", "conditions", " ", "in", " ", "the", " ", "form", 
          " ", "Uo"}], " ", "=", " ", 
         RowBox[{"Boe", " ", "Ue"}]}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{"Boe", "=", 
        RowBox[{"OnsagerMat", ".", "Soe"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"Boeinflow", " ", "=", " ", 
        RowBox[{"OnsagerMatInflow", ".", "Soe"}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{
         "From", " ", "above", " ", "we", " ", "have", " ", "the", " ", 
          "boundary", " ", "conditions", " ", "in", " ", "the", " ", "form", 
          " ", "Uo"}], " ", "=", " ", 
         RowBox[{
          RowBox[{"Boe", " ", "*", " ", 
           RowBox[{"Ue", ".", " ", "Now"}], " ", "we", " ", "would", " ", 
           "like", " ", "to", " ", "change", " ", "them", " ", "into", " ", 
           "the", " ", "form", " ", 
           RowBox[{"B", ".", "U"}]}], "=", 
          RowBox[{
           RowBox[{
           "0.", " ", "The", " ", "first", " ", "part", " ", "into", " ", "B",
             " ", "will", " ", "therefore", " ", "be", " ", "an", " ", 
            "Identity", " ", "matrix", " ", "and", " ", "the", " ", "second", 
            " ", "part", " ", "will", " ", "be"}], " ", "-", "Boe"}]}]}], 
        "*)"}], "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"B", "\[LeftDoubleBracket]", 
         RowBox[{
          RowBox[{"1", ";;", 
           RowBox[{"-", "1"}]}], ",", 
          RowBox[{"1", ";;", 
           RowBox[{"Length", "[", "varOdd", "]"}]}]}], 
         "\[RightDoubleBracket]"}], "=", 
        RowBox[{"IdentityMatrix", "[", 
         RowBox[{"Length", "[", "varOdd", "]"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"B", "\[LeftDoubleBracket]", 
         RowBox[{
          RowBox[{"1", ";;", 
           RowBox[{"-", "1"}]}], ",", 
          RowBox[{
           RowBox[{
            RowBox[{"Length", "[", "varOdd", "]"}], "+", "1"}], ";;", 
           RowBox[{"-", "1"}]}]}], "\[RightDoubleBracket]"}], "=", 
        RowBox[{"-", "Boe"}]}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"Binflow", "\[LeftDoubleBracket]", 
         RowBox[{
          RowBox[{"1", ";;", 
           RowBox[{"-", "1"}]}], ",", 
          RowBox[{"1", ";;", 
           RowBox[{"Length", "[", "varOdd", "]"}]}]}], 
         "\[RightDoubleBracket]"}], "=", 
        RowBox[{"IdentityMatrix", "[", 
         RowBox[{"Length", "[", "varOdd", "]"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"Binflow", "\[LeftDoubleBracket]", 
         RowBox[{
          RowBox[{"1", ";;", 
           RowBox[{"-", "1"}]}], ",", 
          RowBox[{
           RowBox[{
            RowBox[{"Length", "[", "varOdd", "]"}], "+", "1"}], ";;", 
           RowBox[{"-", "1"}]}]}], "\[RightDoubleBracket]"}], "=", 
        RowBox[{"-", "Boeinflow"}]}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
        "We", " ", "now", " ", "check", " ", "whether", " ", "we", " ", "get",
          " ", "the", " ", "correct", " ", "entropy", " ", "or", " ", "not"}],
         "*)"}], "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
        "This", " ", "is", " ", "the", " ", "entropy", " ", "which", " ", 
         "is", " ", "generated", " ", "after", " ", "substitution", " ", "of",
          " ", "the", " ", "boundary", " ", "conditions"}], "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{"BCMat", "=", 
          RowBox[{"-", 
           RowBox[{
            RowBox[{"Transpose", "[", 
             RowBox[{"B", "\[LeftDoubleBracket]", 
              RowBox[{
               RowBox[{"1", ";;", 
                RowBox[{"-", "1"}]}], ",", 
               RowBox[{
                RowBox[{
                 RowBox[{"Length", "[", "varOdd", "]"}], "+", "1"}], ";;", 
                RowBox[{"-", "1"}]}]}], "\[RightDoubleBracket]"}], "]"}], ".",
             "Soe"}]}]}], ";"}], "*)"}], "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
        "Now", " ", "we", " ", "check", " ", "whether", " ", "the", " ", 
         "entropy", " ", "generation", " ", "is", " ", "positive", " ", "or", 
         " ", "not"}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{"CheckSPSD", "[", 
          RowBox[{"BCMat", ",", "\"\<Entropy at Boundary\>\""}], "]"}], ";"}],
         "*)"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
        "we", " ", "now", " ", "restore", " ", "the", " ", "original", " ", 
         "ordering", " ", "of", " ", "the", " ", "variables", " ", "through", 
         " ", "the", " ", "matrix", " ", "PermuteMatInv"}], "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"B", "=", 
        RowBox[{"B", ".", "PermuteMatInv"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"Binflow", "=", 
        RowBox[{"Binflow", ".", "PermuteMatInv"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"Print", "[", 
        RowBox[{"Style", "[", 
         RowBox[{"\"\<Null Space Condition\>\"", ",", 
          RowBox[{"FontColor", "\[Rule]", "Magenta"}]}], "]"}], "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"CheckNullSpaceInclusion", "[", 
        RowBox[{"B", ",", "Ax"}], "]"}], ";", "\[IndentingNewLine]", 
       RowBox[{"BoundaryMatrices", "[", 
        RowBox[{
         RowBox[{"Shalf", ".", "Ax", ".", "ShalfInv"}], ",", 
         RowBox[{"B", ".", "ShalfInv"}], ",", "nEqn"}], "]"}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"filenameAx", "=", 
        RowBox[{"StringJoin", "[", 
         RowBox[{"\"\<A1_\>\"", ",", 
          RowBox[{"ToString", "[", "nEqn", "]"}], ",", "\"\<.txt\>\""}], 
         "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"filenameAy", "=", 
        RowBox[{"StringJoin", "[", 
         RowBox[{"\"\<A2_\>\"", ",", 
          RowBox[{"ToString", "[", "nEqn", "]"}], ",", "\"\<.txt\>\""}], 
         "]"}]}], ";"}], ";", "\[IndentingNewLine]", 
      RowBox[{"filenameB", "=", 
       RowBox[{"StringJoin", "[", 
        RowBox[{"\"\<B_\>\"", ",", 
         RowBox[{"ToString", "[", "nEqn", "]"}], ",", "\"\<.txt\>\""}], 
        "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"filenameOddID", "=", 
       RowBox[{"StringJoin", "[", 
        RowBox[{"\"\<odd_ID_\>\"", ",", 
         RowBox[{"ToString", "[", "nEqn", "]"}], ",", "\"\<.txt\>\""}], 
        "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"filenameSigma", " ", "=", " ", 
       RowBox[{"StringJoin", "[", 
        RowBox[{"\"\<Sigma_\>\"", ",", 
         RowBox[{"ToString", "[", "nEqn", "]"}], ",", "\"\<.txt\>\""}], 
        "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"filenameBinflow", " ", "=", " ", 
       RowBox[{"StringJoin", "[", 
        RowBox[{"\"\<Binflow_\>\"", ",", 
         RowBox[{"ToString", "[", "nEqn", "]"}], ",", "\"\<.txt\>\""}], 
        "]"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"percision", "=", "16"}], ";", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{"developsparsity2", "[", 
         RowBox[{
          RowBox[{"N", "[", 
           RowBox[{"Ax", ",", "percision"}], "]"}], ",", "filenameAx"}], 
         "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"developsparsity2", "[", 
         RowBox[{
          RowBox[{"N", "[", 
           RowBox[{"Ay", ",", "percision"}], "]"}], ",", "filenameAy"}], 
         "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"developsparsity2", "[", 
         RowBox[{
          RowBox[{"N", "[", 
           RowBox[{"B", ",", "percision"}], "]"}], ",", "filenameB"}], "]"}], 
        ";", "\[IndentingNewLine]", 
        RowBox[{"writeVector", "[", 
         RowBox[{
          RowBox[{"N", "[", 
           RowBox[{"varOdd", ",", "percision"}], "]"}], ",", 
          "filenameOddID"}], "]"}], ";"}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{"developsparsity2", "[", 
         RowBox[{
          RowBox[{"N", "[", 
           RowBox[{"Sigma", ",", "percision"}], "]"}], ",", "filenameSigma"}],
          "]"}], ";"}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{"Print", "[", 
         RowBox[{"Style", "[", 
          RowBox[{"filenameBinflow", ",", 
           RowBox[{"FontColor", "\[Rule]", "Magenta"}]}], "]"}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"developsparsity2", "[", 
         RowBox[{
          RowBox[{"N", "[", 
           RowBox[{"Binflow", ",", "percision"}], "]"}], ",", 
          "filenameBinflow"}], "]"}], ";"}], "*)"}], "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
         "Ax", ",", "Ay", ",", "B", ",", "Binflow", ",", "var", ",", "varOdd",
           ",", "BoeMBC", ",", "Soe", ",", "OnsagerMat", ",", "Boe"}], "}"}], 
        ";"}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"{", 
       RowBox[{
       "Ax", ",", "Ay", ",", "B", ",", "Binflow", ",", "var", ",", "varOdd", 
        ",", 
        RowBox[{
         RowBox[{"Transpose", "[", "PermuteMatrix", "]"}], ".", "S", ".", 
         "PermuteMatrix"}], ",", "BMBC"}], "}"}]}]}], "\[IndentingNewLine]", 
    "\[IndentingNewLine]", "]"}]}]}]], "Input",
 CellChangeTimes->{{3.702199062579133*^9, 3.7021990833333282`*^9}, {
  3.702199308403928*^9, 3.70219933398892*^9}, {3.7021993845020323`*^9, 
  3.702199463033435*^9}, {3.702200216209593*^9, 3.702200220080854*^9}, {
  3.702200333817523*^9, 3.7022003361918373`*^9}, {3.702200908706572*^9, 
  3.702200917563095*^9}, {3.702200996935739*^9, 3.702200998573159*^9}, {
  3.702201087919434*^9, 3.702201124353962*^9}, {3.702201207216549*^9, 
  3.702201219503756*^9}, {3.7022250719671783`*^9, 3.702225076410493*^9}}]
}, Open  ]]
}, Closed]],

Cell[CellGroupData[{

Cell["Transformation to classic variables", "Section",
 CellChangeTimes->{{3.682049118182197*^9, 3.682049123355013*^9}}],

Cell[CellGroupData[{

Cell["Ratio Laguerre", "Subsection",
 CellChangeTimes->{{3.68204927864336*^9, 3.6820492873873053`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"RatioLaguerre", "[", 
    RowBox[{"n_", ",", "s_"}], "]"}], ":=", 
   SqrtBox[
    FractionBox[
     RowBox[{
      RowBox[{"n", "!"}], 
      RowBox[{"s", "!"}], 
      RowBox[{"Gamma", "[", 
       RowBox[{"n", "+", "s", "+", 
        FractionBox["3", "2"]}], "]"}]}], 
     RowBox[{"Gamma", "[", 
      RowBox[{"n", "+", 
       FractionBox["3", "2"]}], "]"}]]]}], ";"}]], "Input",
 CellChangeTimes->{{3.682049289541401*^9, 3.682049321663225*^9}}]
}, Open  ]],

Cell[CellGroupData[{

Cell["Mapping", "Subsection",
 CellChangeTimes->{{3.68204932691475*^9, 3.682049327925466*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"ToConventional", "[", "Ntensors_", "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "varIdxComplete", ",", "varIdx", ",", "coeffToOld", ",", "OldToConv", 
      ",", "variables", ",", "NewToOld"}], "}"}], ",", "\[IndentingNewLine]", 
    
    RowBox[{
     RowBox[{"varIdx", "=", 
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"iTraces", "[", "i", "]"}], ",", 
          RowBox[{"iTensorDegree", "[", "i", "]"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", "1", ",", "Ntensors"}], "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"varIdxComplete", "=", 
      RowBox[{"Flatten", "[", 
       RowBox[{
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{"Map", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"Join", "[", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{"varIdx", "\[LeftDoubleBracket]", 
                 RowBox[{"n", ",", "1"}], "\[RightDoubleBracket]"}], "}"}], 
               ",", "#"}], "]"}], "&"}], ",", 
            RowBox[{"Pick", "[", 
             RowBox[{
              RowBox[{"IDXtrf", "[", 
               RowBox[{"varIdx", "\[LeftDoubleBracket]", 
                RowBox[{"n", ",", "2"}], "\[RightDoubleBracket]"}], "]"}], 
              ",", 
              RowBox[{"Flatten", "[", 
               RowBox[{"Join", "[", 
                RowBox[{
                 RowBox[{"{", "1", "}"}], ",", 
                 RowBox[{"Table", "[", 
                  RowBox[{
                   RowBox[{"{", 
                    RowBox[{"1", ",", "0"}], "}"}], ",", 
                   RowBox[{"{", 
                    RowBox[{"k", ",", "1", ",", 
                    RowBox[{"varIdx", "\[LeftDoubleBracket]", 
                    RowBox[{"n", ",", "2"}], "\[RightDoubleBracket]"}]}], 
                    "}"}]}], "]"}]}], "]"}], "]"}], ",", "1"}], "]"}]}], 
           "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"n", ",", "1", ",", 
            RowBox[{"Length", "[", "varIdx", "]"}]}], "}"}]}], "]"}], ",", 
        "1"}], "]"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{"List", " ", "of", " ", "variables"}], "*)"}], 
     "\[IndentingNewLine]", 
     RowBox[{"variables", " ", "=", " ", 
      RowBox[{"Map", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"w", "[", "#", "]"}], "&"}], ",", "varIdxComplete"}], 
       "]"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
      "transformation", " ", "to", " ", "moments", " ", "which", " ", "have", 
       " ", "been", " ", "used", " ", "in", " ", "the", " ", "heat", " ", 
       "conduction", " ", "file"}], "*)"}], "\[IndentingNewLine]", 
     RowBox[{"coeffToOld", " ", "=", " ", 
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{"RatioLaguerre", "[", 
         RowBox[{
          RowBox[{"Total", "[", 
           RowBox[{"idx", "\[LeftDoubleBracket]", 
            RowBox[{"2", ";;", 
             RowBox[{"-", "1"}]}], "\[RightDoubleBracket]"}], "]"}], ",", 
          RowBox[{
          "idx", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}]}], 
         "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"idx", ",", "varIdxComplete"}], "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
      "transformation", " ", "from", " ", "old", " ", "to", " ", 
       "conventional"}], "*)"}], "\[IndentingNewLine]", 
     RowBox[{"OldToConv", "=", 
      RowBox[{"{", 
       RowBox[{"\[Rho]", ",", "vx", ",", "vy", ",", 
        RowBox[{
         RowBox[{"-", 
          SqrtBox[
           FractionBox["3", "2"]]}], " ", "\[Theta]"}], ",", 
        FractionBox["\[Sigma]xx", 
         SqrtBox["2"]], ",", 
        FractionBox["\[Sigma]xy", 
         SqrtBox["2"]], ",", 
        FractionBox["\[Sigma]yy", 
         SqrtBox["2"]], ",", 
        RowBox[{
         RowBox[{"-", 
          SqrtBox[
           FractionBox["2", "5"]]}], "qx"}], ",", 
        RowBox[{
         RowBox[{"-", 
          SqrtBox[
           FractionBox["2", "5"]]}], "qy"}], ",", 
        FractionBox["mxxx", 
         SqrtBox["6"]], ",", 
        FractionBox["mxxy", 
         SqrtBox["6"]], ",", 
        FractionBox["mxyy", 
         SqrtBox["6"]], ",", 
        FractionBox["myyy", 
         SqrtBox["6"]], ",", 
        FractionBox["\[CapitalDelta]", 
         RowBox[{"2", " ", 
          SqrtBox["30"]}]], ",", 
        FractionBox[
         RowBox[{"-", "Rxx"}], 
         RowBox[{"2", 
          SqrtBox["7"]}]], ",", 
        FractionBox[
         RowBox[{"-", "Rxy"}], 
         RowBox[{"2", 
          SqrtBox["7"]}]], ",", 
        FractionBox[
         RowBox[{"-", "Ryy"}], 
         RowBox[{"2", 
          SqrtBox["7"]}]], ",", 
        FractionBox["\[CurlyPhi]xxxx", 
         RowBox[{"2", 
          SqrtBox["6"]}]], ",", 
        FractionBox["\[CurlyPhi]xxxy", 
         RowBox[{"2", 
          SqrtBox["6"]}]], ",", 
        FractionBox["\[CurlyPhi]xxyy", 
         RowBox[{"2", 
          SqrtBox["6"]}]], ",", 
        FractionBox["\[CurlyPhi]xyyy", 
         RowBox[{"2", 
          SqrtBox["6"]}]], ",", 
        FractionBox["\[CurlyPhi]yyyy", 
         RowBox[{"2", 
          SqrtBox["6"]}]], ",", 
        FractionBox["\[CapitalOmega]x", 
         RowBox[{"2", 
          SqrtBox["70"]}]], ",", 
        FractionBox["\[CapitalOmega]y", 
         RowBox[{"2", 
          SqrtBox["70"]}]], ",", 
        RowBox[{"-", 
         FractionBox["\[Psi]xxx", 
          RowBox[{"6", 
           SqrtBox["3"]}]]}], ",", 
        RowBox[{"-", 
         FractionBox["\[Psi]xxy", 
          RowBox[{"6", 
           SqrtBox["3"]}]]}], ",", 
        RowBox[{"-", 
         FractionBox["\[Psi]xyy", 
          RowBox[{"6", 
           SqrtBox["3"]}]]}], ",", 
        RowBox[{"-", 
         FractionBox["\[Psi]yyy", 
          RowBox[{"6", 
           SqrtBox["3"]}]]}]}], "}"}]}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"NewToOld", " ", "=", " ", 
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{
         RowBox[{
         "variables", "\[LeftDoubleBracket]", "ii", "\[RightDoubleBracket]"}],
          "\[Rule]", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{
           "OldToConv", "\[LeftDoubleBracket]", "ii", 
            "\[RightDoubleBracket]"}], "*", 
           RowBox[{
           "coeffToOld", "\[LeftDoubleBracket]", "ii", 
            "\[RightDoubleBracket]"}]}], ")"}]}], ",", 
        RowBox[{"{", 
         RowBox[{"ii", ",", "1", ",", 
          RowBox[{"Length", "[", "variables", "]"}]}], "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", "NewToOld"}]}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", "]"}]}]], "Input",
 CellChangeTimes->{{3.6820493302795553`*^9, 3.682049371652842*^9}, {
  3.682049613942439*^9, 3.682049652312211*^9}, {3.6820496933149557`*^9, 
  3.682049723435639*^9}, {3.682049785963801*^9, 3.682049906848579*^9}, {
  3.682049940079357*^9, 3.682050066319375*^9}}],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"ToConventional", "[", "8", "]"}]], "Input",
 CellChangeTimes->{{3.682049860520054*^9, 3.6820498648155727`*^9}}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{
    RowBox[{"w", "[", 
     RowBox[{"{", 
      RowBox[{"0", ",", "0", ",", "0", ",", "0"}], "}"}], "]"}], "\[Rule]", 
    "\[Rho]"}], ",", 
   RowBox[{
    RowBox[{"w", "[", 
     RowBox[{"{", 
      RowBox[{"0", ",", "1", ",", "0", ",", "0"}], "}"}], "]"}], "\[Rule]", 
    "vx"}], ",", 
   RowBox[{
    RowBox[{"w", "[", 
     RowBox[{"{", 
      RowBox[{"0", ",", "0", ",", "1", ",", "0"}], "}"}], "]"}], "\[Rule]", 
    "vy"}], ",", 
   RowBox[{
    RowBox[{"w", "[", 
     RowBox[{"{", 
      RowBox[{"1", ",", "0", ",", "0", ",", "0"}], "}"}], "]"}], "\[Rule]", 
    RowBox[{"-", 
     FractionBox[
      RowBox[{"3", " ", "\[Theta]"}], "2"]}]}], ",", 
   RowBox[{
    RowBox[{"w", "[", 
     RowBox[{"{", 
      RowBox[{"0", ",", "2", ",", "0", ",", "0"}], "}"}], "]"}], "\[Rule]", 
    "\[Sigma]xx"}], ",", 
   RowBox[{
    RowBox[{"w", "[", 
     RowBox[{"{", 
      RowBox[{"0", ",", "1", ",", "1", ",", "0"}], "}"}], "]"}], "\[Rule]", 
    "\[Sigma]xy"}], ",", 
   RowBox[{
    RowBox[{"w", "[", 
     RowBox[{"{", 
      RowBox[{"0", ",", "0", ",", "2", ",", "0"}], "}"}], "]"}], "\[Rule]", 
    "\[Sigma]yy"}], ",", 
   RowBox[{
    RowBox[{"w", "[", 
     RowBox[{"{", 
      RowBox[{"1", ",", "1", ",", "0", ",", "0"}], "}"}], "]"}], "\[Rule]", 
    RowBox[{"-", "qx"}]}], ",", 
   RowBox[{
    RowBox[{"w", "[", 
     RowBox[{"{", 
      RowBox[{"1", ",", "0", ",", "1", ",", "0"}], "}"}], "]"}], "\[Rule]", 
    RowBox[{"-", "qy"}]}], ",", 
   RowBox[{
    RowBox[{"w", "[", 
     RowBox[{"{", 
      RowBox[{"0", ",", "3", ",", "0", ",", "0"}], "}"}], "]"}], "\[Rule]", 
    "mxxx"}], ",", 
   RowBox[{
    RowBox[{"w", "[", 
     RowBox[{"{", 
      RowBox[{"0", ",", "2", ",", "1", ",", "0"}], "}"}], "]"}], "\[Rule]", 
    "mxxy"}], ",", 
   RowBox[{
    RowBox[{"w", "[", 
     RowBox[{"{", 
      RowBox[{"0", ",", "1", ",", "2", ",", "0"}], "}"}], "]"}], "\[Rule]", 
    "mxyy"}], ",", 
   RowBox[{
    RowBox[{"w", "[", 
     RowBox[{"{", 
      RowBox[{"0", ",", "0", ",", "3", ",", "0"}], "}"}], "]"}], "\[Rule]", 
    "myyy"}], ",", 
   RowBox[{
    RowBox[{"w", "[", 
     RowBox[{"{", 
      RowBox[{"2", ",", "0", ",", "0", ",", "0"}], "}"}], "]"}], "\[Rule]", 
    FractionBox["\[CapitalDelta]", "4"]}], ",", 
   RowBox[{
    RowBox[{"w", "[", 
     RowBox[{"{", 
      RowBox[{"1", ",", "2", ",", "0", ",", "0"}], "}"}], "]"}], "\[Rule]", 
    RowBox[{"-", 
     FractionBox["Rxx", "2"]}]}], ",", 
   RowBox[{
    RowBox[{"w", "[", 
     RowBox[{"{", 
      RowBox[{"1", ",", "1", ",", "1", ",", "0"}], "}"}], "]"}], "\[Rule]", 
    RowBox[{"-", 
     FractionBox["Rxy", "2"]}]}], ",", 
   RowBox[{
    RowBox[{"w", "[", 
     RowBox[{"{", 
      RowBox[{"1", ",", "0", ",", "2", ",", "0"}], "}"}], "]"}], "\[Rule]", 
    RowBox[{"-", 
     FractionBox["Ryy", "2"]}]}]}], "}"}]], "Output",
 CellChangeTimes->{
  3.682049873556294*^9, {3.68205005279622*^9, 3.682050069046527*^9}}]
}, Open  ]]
}, Closed]]
}, Closed]],

Cell[CellGroupData[{

Cell["Example Matrices", "Subchapter",
 CellChangeTimes->{{3.68204985727003*^9, 3.682049858597539*^9}}],

Cell[TextData[{
 "GetMatrices1D gives the variable names, transport matrix A, production \
matrix P, a list VarBC marking the boundary fluxes, \nboundary matrix BC and \
a boundary right-hand-side g (containing pW and TW) for a number of moments \
(canonical ordering \nby tracefree components).\n\nThe moment equations for a \
process between walls read  ",
 Cell[BoxData[
  FormBox[
   RowBox[{
    RowBox[{"A", 
     FractionBox["dU", "dx"]}], "=", 
    RowBox[{
     RowBox[{"-", 
      FractionBox["1", "Kn"]}], "P", " ", "U"}]}], TraditionalForm]]],
 " with boundary \nconditions ",
 Cell[BoxData[
  FormBox[
   RowBox[{
    RowBox[{"BC", " ", "U"}], "=", " ", "g"}], TraditionalForm]]],
 " at the right wall. For the left wall the BC-matrix needs to be modified\n\
by BC.",
 "DiagonalMatrix[1-2BCvar].",
 "\n\nThe list VarNames gives a transformation from the moment vector U to \
commonly used variables, like\ntemperature.\n"
}], "Text",
 FontSize->16],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "VarNames", ",", "Ax", ",", "Ay", ",", "P", ",", "VarBC", ",", "BC", ",",
       "g"}], "}"}], "=", 
    RowBox[{"GetMatrices1D", "[", "8", "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Print", "[", 
   RowBox[{"Style", "[", 
    RowBox[{"\"\<Variables:\>\"", ",", "Red"}], "]"}], "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{"VarNames", "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Print", "[", 
   RowBox[{"Style", "[", 
    RowBox[{"\"\<Eigenvalues:\>\"", ",", "Red"}], "]"}], "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Eigenvalues", "[", 
   RowBox[{"1.", "A"}], "]"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Print", "[", 
   RowBox[{"Style", "[", 
    RowBox[{"\"\<Boundary Conditions:\>\"", ",", "Red"}], "]"}], "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"BC", ".", "VarNames"}], "-", "g"}], "/.", 
  RowBox[{"{", 
   RowBox[{
    RowBox[{"pW", "\[Rule]", "p0"}], ",", 
    RowBox[{"TW", "\[Rule]", "T0"}]}], "}"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"BC", ".", 
    RowBox[{"DiagonalMatrix", "[", 
     RowBox[{"1", "-", 
      RowBox[{"2", "VarBC"}]}], "]"}], ".", "VarNames"}], "-", "g"}], "/.", 
  RowBox[{"{", 
   RowBox[{
    RowBox[{"pW", "\[Rule]", "p0"}], ",", 
    RowBox[{"TW", "\[Rule]", "T1"}]}], 
   "}"}]}], "\[IndentingNewLine]"}], "Input",
 CellChangeTimes->{{3.68204947180923*^9, 3.6820494813394203`*^9}, 
   3.682049685991503*^9}],

Cell[CellGroupData[{

Cell[BoxData[
 InterpretationBox[
  RowBox[{"\<\"number of different tensor degrees: \"\>", "\[InvisibleSpace]", 
   RowBox[{"{", 
    RowBox[{"3", ",", "2", ",", "2", ",", "1", ",", "0"}], "}"}]}],
  SequenceForm["number of different tensor degrees: ", {3, 2, 2, 1, 0}],
  Editable->False]], "Print",
 CellChangeTimes->{{3.681211073833207*^9, 3.68121108304916*^9}, 
   3.6820494815962677`*^9, 3.68204958957452*^9, 3.682049686361022*^9}],

Cell[BoxData[
 InterpretationBox[
  RowBox[{"\<\"corresponding variables (traces,indices): \"\>", 
   "\[InvisibleSpace]", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"0", ",", "0"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"1", ",", "0"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"2", ",", "0"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"0", ",", "1"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"1", ",", "1"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"0", ",", "2"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"1", ",", "2"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"0", ",", "3"}], "}"}]}], "}"}]}],
  SequenceForm[
  "corresponding variables (traces,indices): ", {{0, 0}, {1, 0}, {2, 0}, {0, 
   1}, {1, 1}, {0, 2}, {1, 2}, {0, 3}}],
  Editable->False]], "Print",
 CellChangeTimes->{{3.681211073833207*^9, 3.68121108304916*^9}, 
   3.6820494815962677`*^9, 3.68204958957452*^9, 3.6820496863690567`*^9}],

Cell[BoxData[
 InterpretationBox[
  RowBox[{"\<\"Number of Variables 1D: \"\>", "\[InvisibleSpace]", "8"}],
  SequenceForm["Number of Variables 1D: ", 8],
  Editable->False]], "Print",
 CellChangeTimes->{{3.681211073833207*^9, 3.68121108304916*^9}, 
   3.6820494815962677`*^9, 3.68204958957452*^9, 3.6820496863790903`*^9}],

Cell[BoxData[
 InterpretationBox[
  RowBox[{"\<\"Number of Variables 2D: \"\>", "\[InvisibleSpace]", "17"}],
  SequenceForm["Number of Variables 2D: ", 17],
  Editable->False]], "Print",
 CellChangeTimes->{{3.681211073833207*^9, 3.68121108304916*^9}, 
   3.6820494815962677`*^9, 3.68204958957452*^9, 3.682049686388188*^9}],

Cell[BoxData[
 InterpretationBox[
  RowBox[{"\<\"Number of Variables 3D: \"\>", "\[InvisibleSpace]", "26"}],
  SequenceForm["Number of Variables 3D: ", 26],
  Editable->False]], "Print",
 CellChangeTimes->{{3.681211073833207*^9, 3.68121108304916*^9}, 
   3.6820494815962677`*^9, 3.68204958957452*^9, 3.682049686399455*^9}],

Cell[BoxData[
 InterpretationBox[
  RowBox[{"\<\"Number of full Tensors 3D: \"\>", "\[InvisibleSpace]", 
   "3.4000000000000004`"}],
  SequenceForm["Number of full Tensors 3D: ", 3.4000000000000004`],
  Editable->False]], "Print",
 CellChangeTimes->{{3.681211073833207*^9, 3.68121108304916*^9}, 
   3.6820494815962677`*^9, 3.68204958957452*^9, 3.682049686435173*^9}],

Cell[BoxData[
 StyleBox["\<\"Variables:\"\>",
  StripOnInput->False,
  LineColor->RGBColor[1, 0, 0],
  FrontFaceColor->RGBColor[1, 0, 0],
  BackFaceColor->RGBColor[1, 0, 0],
  GraphicsColor->RGBColor[1, 0, 0],
  FontColor->RGBColor[1, 0, 0]]], "Print",
 CellChangeTimes->{{3.681211073833207*^9, 3.68121108304916*^9}, 
   3.6820494815962677`*^9, 3.68204958957452*^9, 3.682049686444455*^9}]
}, Open  ]],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"\[Rho]", ",", "vx", ",", 
   RowBox[{"-", 
    FractionBox[
     RowBox[{"3", " ", "\[Theta]"}], "2"]}], ",", "\[Sigma]xx", ",", 
   RowBox[{"-", "qx"}], ",", "\[Rho]0xxx", ",", "\[Rho]2", ",", "\[Rho]1xx"}],
   "}"}]], "Output",
 CellChangeTimes->{{3.6812110738402042`*^9, 3.681211083115864*^9}, 
   3.6820494816616497`*^9, 3.682049589640409*^9, 3.6820496864535313`*^9}],

Cell[BoxData[
 StyleBox["\<\"Eigenvalues:\"\>",
  StripOnInput->False,
  LineColor->RGBColor[1, 0, 0],
  FrontFaceColor->RGBColor[1, 0, 0],
  BackFaceColor->RGBColor[1, 0, 0],
  GraphicsColor->RGBColor[1, 0, 0],
  FontColor->RGBColor[1, 0, 0]]], "Print",
 CellChangeTimes->{{3.681211073833207*^9, 3.68121108304916*^9}, 
   3.6820494815962677`*^9, 3.68204958957452*^9, 3.682049686458625*^9}],

Cell[BoxData[
 RowBox[{"Eigenvalues", "[", 
  RowBox[{"1.`", " ", "A"}], "]"}]], "Output",
 CellChangeTimes->{{3.6812110738402042`*^9, 3.681211083115864*^9}, 
   3.6820494816616497`*^9, 3.682049589640409*^9, 3.682049686463398*^9}],

Cell[BoxData[
 StyleBox["\<\"Boundary Conditions:\"\>",
  StripOnInput->False,
  LineColor->RGBColor[1, 0, 0],
  FrontFaceColor->RGBColor[1, 0, 0],
  BackFaceColor->RGBColor[1, 0, 0],
  GraphicsColor->RGBColor[1, 0, 0],
  FontColor->RGBColor[1, 0, 0]]], "Print",
 CellChangeTimes->{{3.681211073833207*^9, 3.68121108304916*^9}, 
   3.6820494815962677`*^9, 3.68204958957452*^9, 3.682049686468405*^9}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"p0", "+", "vx", "-", "\[Theta]", "-", "\[Rho]"}], ",", 
   RowBox[{
    RowBox[{"-", "qx"}], "-", 
    RowBox[{"2", " ", "T0"}], "+", 
    RowBox[{"2", " ", "\[Theta]"}], "-", 
    FractionBox[
     RowBox[{"5", " ", "\[Rho]1xx"}], "14"], "+", 
    FractionBox[
     RowBox[{"4", " ", "\[Rho]2"}], "15"], "+", 
    FractionBox["\[Sigma]xx", "2"]}], ",", 
   RowBox[{
    RowBox[{"-", 
     FractionBox[
      RowBox[{"2", " ", "T0"}], "5"]}], "+", 
    FractionBox[
     RowBox[{"2", " ", "\[Theta]"}], "5"], "+", "\[Rho]0xxx", "+", 
    FractionBox["\[Rho]1xx", "7"], "+", 
    FractionBox[
     RowBox[{"4", " ", "\[Rho]2"}], "75"], "-", 
    FractionBox[
     RowBox[{"7", " ", "\[Sigma]xx"}], "5"]}]}], "}"}]], "Output",
 CellChangeTimes->{{3.6812110738402042`*^9, 3.681211083115864*^9}, 
   3.6820494816616497`*^9, 3.682049589640409*^9, 3.682049686473359*^9}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"p0", "-", "vx", "-", "\[Theta]", "-", "\[Rho]"}], ",", 
   RowBox[{"qx", "-", 
    RowBox[{"2", " ", "T1"}], "+", 
    RowBox[{"2", " ", "\[Theta]"}], "-", 
    FractionBox[
     RowBox[{"5", " ", "\[Rho]1xx"}], "14"], "+", 
    FractionBox[
     RowBox[{"4", " ", "\[Rho]2"}], "15"], "+", 
    FractionBox["\[Sigma]xx", "2"]}], ",", 
   RowBox[{
    RowBox[{"-", 
     FractionBox[
      RowBox[{"2", " ", "T1"}], "5"]}], "+", 
    FractionBox[
     RowBox[{"2", " ", "\[Theta]"}], "5"], "-", "\[Rho]0xxx", "+", 
    FractionBox["\[Rho]1xx", "7"], "+", 
    FractionBox[
     RowBox[{"4", " ", "\[Rho]2"}], "75"], "-", 
    FractionBox[
     RowBox[{"7", " ", "\[Sigma]xx"}], "5"]}]}], "}"}]], "Output",
 CellChangeTimes->{{3.6812110738402042`*^9, 3.681211083115864*^9}, 
   3.6820494816616497`*^9, 3.682049589640409*^9, 3.682049686480796*^9}]
}, Open  ]],

Cell[TextData[{
 "\nLet\[CloseCurlyQuote]s consider the extreme case ",
 Cell[BoxData[
  FormBox[
   RowBox[{"Kn", "\[Rule]", "\[Infinity]"}], TraditionalForm]]],
 " which simplifies the equations ",
 Cell[BoxData[
  FormBox[
   RowBox[{
    RowBox[{"A", 
     FractionBox["dU", "dx"]}], "=", "0"}], TraditionalForm]]],
 ". \n\nFor certain 1D moment systems the transport matrix is regular and can \
be inverted, such that\nU = const is a solution. The constants then follow \
from the boundary conditions left and right.\n\nThis seems possible for all \
systems with an odd number of complete tensors\n(Ntensors = 6, 12, 20, 30, \
42, 56, ...)\n"
}], "Text",
 FontSize->16],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"{", 
    RowBox[{
    "VarNames", ",", "A", ",", "P", ",", "VarBC", ",", "BC", ",", "g"}], 
    "}"}], "=", 
   RowBox[{"GetMatrices1D", "[", "12", "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{"Eigenvalues", "[", 
  RowBox[{"1.", "A"}], "]"}], "\[IndentingNewLine]"}], "Input"],

Cell[BoxData[
 RowBox[{
  RowBox[{"Inverse", "[", 
   RowBox[{"Join", "[", 
    RowBox[{"BC", ",", 
     RowBox[{"BC", ".", 
      RowBox[{"DiagonalMatrix", "[", 
       RowBox[{"1", "-", 
        RowBox[{"2", "VarBC"}]}], "]"}]}]}], "]"}], "]"}], ".", 
  RowBox[{"Join", "[", 
   RowBox[{
    RowBox[{"g", "/.", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"pW", "\[Rule]", "p0"}], ",", 
       RowBox[{"TW", "\[Rule]", "T0"}]}], "}"}]}], ",", 
    RowBox[{"g", "/.", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"pW", "\[Rule]", "p0"}], ",", 
       RowBox[{"TW", "\[Rule]", "T1"}]}], "}"}]}]}], "]"}]}]], "Input"],

Cell[TextData[{
 "\nSurprisingly, the result for lower moments does not change if the system \
is enlarged (with A invertible). Indeed, \nthe temperature is (T0+T1)/2 which \
is probably the exact result from the kinetic equation for Kn\[Rule]\
\[Infinity]. \n\nCHALLENGE: All the other moment systems using incomplete \
tensors should also give this result !!!!!\n\nHowever: If the transport \
matrix is not invertible there remains a nullspace, that is, we are \
\[OpenCurlyDoubleQuote]free\[CloseCurlyDoubleQuote] to choose a constant for \
\na certain combination of variables. The boundary conditions must be such \
that only the none-nullspace \ncomponents are specified. Then, the free \
choices must be such that the result is correct.... \n\nTo achieve this, it \
might be necessary to include production, i.e., to set ",
 Cell[BoxData[
  FormBox[
   RowBox[{
    FractionBox["1", "Kn"], "=", "\[Epsilon]"}], TraditionalForm]]],
 " and consider the value of the \nnullspace components for ",
 Cell[BoxData[
  FormBox[
   RowBox[{"\[Epsilon]", "\[Rule]", "0"}], TraditionalForm]]],
 ".\n"
}], "Text",
 FontSize->16]
}, Closed]],

Cell[CellGroupData[{

Cell["Results", "Chapter",
 CellChangeTimes->{{3.7021996841943073`*^9, 3.7021996853368397`*^9}}],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"{", 
    RowBox[{
    "AxNew", ",", "AyNew", ",", "BNew", ",", "Binflow", ",", "var", ",", 
     "varOdd", ",", "S", ",", "BMBC"}], "}"}], "=", 
   RowBox[{"FinalMatricesDiffBasis", "[", "6", "]"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.702199728300638*^9, 3.702199742949121*^9}, {
  3.702200224162849*^9, 3.702200244542549*^9}, {3.702200341314102*^9, 
  3.702200343743023*^9}, {3.70220122405984*^9, 3.702201227688428*^9}}],

Cell[CellGroupData[{

Cell[BoxData[
 StyleBox["\<\"Onsager Mat\"\>",
  StripOnInput->False,
  FontColor->RGBColor[1, 0, 1]]], "Print",
 CellChangeTimes->{
  3.70219974353272*^9, {3.702200227785219*^9, 3.702200245337945*^9}, 
   3.70220034473964*^9, 3.702201002654866*^9, 3.702201228727816*^9, 
   3.702224084878107*^9, 3.702224600118775*^9, 3.702224849645618*^9, 
   3.7022250812957907`*^9, 3.702225118072444*^9}],

Cell[BoxData[
 StyleBox["\<\"Symmetric\"\>",
  StripOnInput->False,
  FontColor->RGBColor[0, 1, 0]]], "Print",
 CellChangeTimes->{
  3.70219974353272*^9, {3.702200227785219*^9, 3.702200245337945*^9}, 
   3.70220034473964*^9, 3.702201002654866*^9, 3.702201228727816*^9, 
   3.702224084878107*^9, 3.702224600118775*^9, 3.702224849645618*^9, 
   3.7022250812957907`*^9, 3.702225118085005*^9}],

Cell[BoxData[
 StyleBox["\<\"Positive Definite\"\>",
  StripOnInput->False,
  FontColor->RGBColor[0, 1, 0]]], "Print",
 CellChangeTimes->{
  3.70219974353272*^9, {3.702200227785219*^9, 3.702200245337945*^9}, 
   3.70220034473964*^9, 3.702201002654866*^9, 3.702201228727816*^9, 
   3.702224084878107*^9, 3.702224600118775*^9, 3.702224849645618*^9, 
   3.7022250812957907`*^9, 3.702225118098065*^9}],

Cell[BoxData[
 StyleBox["\<\"Onsager Mat Inflow\"\>",
  StripOnInput->False,
  FontColor->RGBColor[1, 0, 1]]], "Print",
 CellChangeTimes->{
  3.70219974353272*^9, {3.702200227785219*^9, 3.702200245337945*^9}, 
   3.70220034473964*^9, 3.702201002654866*^9, 3.702201228727816*^9, 
   3.702224084878107*^9, 3.702224600118775*^9, 3.702224849645618*^9, 
   3.7022250812957907`*^9, 3.7022251181106453`*^9}],

Cell[BoxData[
 StyleBox["\<\"Symmetric\"\>",
  StripOnInput->False,
  FontColor->RGBColor[0, 1, 0]]], "Print",
 CellChangeTimes->{
  3.70219974353272*^9, {3.702200227785219*^9, 3.702200245337945*^9}, 
   3.70220034473964*^9, 3.702201002654866*^9, 3.702201228727816*^9, 
   3.702224084878107*^9, 3.702224600118775*^9, 3.702224849645618*^9, 
   3.7022250812957907`*^9, 3.702225118123184*^9}],

Cell[BoxData[
 StyleBox["\<\"Positive Definite\"\>",
  StripOnInput->False,
  FontColor->RGBColor[0, 1, 0]]], "Print",
 CellChangeTimes->{
  3.70219974353272*^9, {3.702200227785219*^9, 3.702200245337945*^9}, 
   3.70220034473964*^9, 3.702201002654866*^9, 3.702201228727816*^9, 
   3.702224084878107*^9, 3.702224600118775*^9, 3.702224849645618*^9, 
   3.7022250812957907`*^9, 3.702225118135952*^9}],

Cell[BoxData[
 StyleBox["\<\"Null Space Condition\"\>",
  StripOnInput->False,
  FontColor->RGBColor[1, 0, 1]]], "Print",
 CellChangeTimes->{
  3.70219974353272*^9, {3.702200227785219*^9, 3.702200245337945*^9}, 
   3.70220034473964*^9, 3.702201002654866*^9, 3.702201228727816*^9, 
   3.702224084878107*^9, 3.702224600118775*^9, 3.702224849645618*^9, 
   3.7022250812957907`*^9, 3.702225118148768*^9}],

Cell[BoxData[
 StyleBox["\<\"Null Space Included\"\>",
  StripOnInput->False,
  FontColor->RGBColor[0, 1, 0]]], "Print",
 CellChangeTimes->{
  3.70219974353272*^9, {3.702200227785219*^9, 3.702200245337945*^9}, 
   3.70220034473964*^9, 3.702201002654866*^9, 3.702201228727816*^9, 
   3.702224084878107*^9, 3.702224600118775*^9, 3.702224849645618*^9, 
   3.7022250812957907`*^9, 3.7022251181626*^9}],

Cell[BoxData[
 StyleBox["\<\"Norsdtom Condition\"\>",
  StripOnInput->False,
  FontColor->RGBColor[1, 0, 1]]], "Print",
 CellChangeTimes->{
  3.70219974353272*^9, {3.702200227785219*^9, 3.702200245337945*^9}, 
   3.70220034473964*^9, 3.702201002654866*^9, 3.702201228727816*^9, 
   3.702224084878107*^9, 3.702224600118775*^9, 3.702224849645618*^9, 
   3.7022250812957907`*^9, 3.702225118177185*^9}],

Cell[BoxData[
 StyleBox["\<\"Symmetric\"\>",
  StripOnInput->False,
  FontColor->RGBColor[0, 1, 0]]], "Print",
 CellChangeTimes->{
  3.70219974353272*^9, {3.702200227785219*^9, 3.702200245337945*^9}, 
   3.70220034473964*^9, 3.702201002654866*^9, 3.702201228727816*^9, 
   3.702224084878107*^9, 3.702224600118775*^9, 3.702224849645618*^9, 
   3.7022250812957907`*^9, 3.7022251181898203`*^9}],

Cell[BoxData[
 StyleBox["\<\"Positive Definite\"\>",
  StripOnInput->False,
  FontColor->RGBColor[0, 1, 0]]], "Print",
 CellChangeTimes->{
  3.70219974353272*^9, {3.702200227785219*^9, 3.702200245337945*^9}, 
   3.70220034473964*^9, 3.702201002654866*^9, 3.702201228727816*^9, 
   3.702224084878107*^9, 3.702224600118775*^9, 3.702224849645618*^9, 
   3.7022250812957907`*^9, 3.702225118202468*^9}]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"AxNew", "//", "MatrixForm"}]], "Input",
 CellChangeTimes->{{3.702199774684205*^9, 3.7021998249839163`*^9}, {
  3.7022002559361887`*^9, 3.702200294372175*^9}, {3.702200349455926*^9, 
  3.7022003548724947`*^9}, {3.70220101382126*^9, 3.702201025084484*^9}, {
  3.7022240967197447`*^9, 3.702224142296966*^9}, {3.702224179844823*^9, 
  3.702224187358358*^9}, {3.702224897355412*^9, 3.7022249020358047`*^9}, {
  3.702225091260223*^9, 3.702225094406023*^9}}],

Cell[BoxData[
 TagBox[
  RowBox[{"(", "\[NoBreak]", GridBox[{
     {"0", "1", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0"},
     {"1", "0", "0", 
      RowBox[{"-", "1"}], "2", "0", "0", "0", "0", "0", "0", "0", "0"},
     {"0", "0", "0", "0", "0", "2", "0", "0", "0", "0", "0", "0", "0"},
     {"0", 
      RowBox[{"-", "1"}], "0", "0", "0", "0", "0", 
      FractionBox["5", "2"], "0", "0", "0", "0", "0"},
     {"0", 
      FractionBox["4", "3"], "0", "0", "0", "0", "0", 
      RowBox[{"-", 
       FractionBox["4", "3"]}], "0", "6", "0", "0", "0"},
     {"0", "0", "1", "0", "0", "0", "0", "0", 
      RowBox[{"-", "1"}], "0", "6", "0", "0"},
     {"0", 
      RowBox[{"-", 
       FractionBox["2", "3"]}], "0", "0", "0", "0", "0", 
      FractionBox["2", "3"], "0", "0", "0", "6", "0"},
     {"0", "0", "0", 
      FractionBox["5", "2"], 
      RowBox[{"-", "2"}], "0", "0", "0", "0", "0", "0", "0", "0"},
     {"0", "0", "0", "0", "0", 
      RowBox[{"-", "2"}], "0", "0", "0", "0", "0", "0", "0"},
     {"0", "0", "0", "0", 
      FractionBox["18", "5"], "0", "0", "0", "0", "0", "0", "0", "0"},
     {"0", "0", "0", "0", "0", 
      FractionBox["16", "5"], "0", "0", "0", "0", "0", "0", "0"},
     {"0", "0", "0", "0", 
      RowBox[{"-", 
       FractionBox["4", "5"]}], "0", "2", "0", "0", "0", "0", "0", "0"},
     {"0", "0", "0", "0", "0", 
      RowBox[{"-", 
       FractionBox["12", "5"]}], "0", "0", "0", "0", "0", "0", "0"}
    },
    GridBoxAlignment->{
     "Columns" -> {{Center}}, "ColumnsIndexed" -> {}, "Rows" -> {{Baseline}}, 
      "RowsIndexed" -> {}},
    GridBoxSpacings->{"Columns" -> {
        Offset[0.27999999999999997`], {
         Offset[0.7]}, 
        Offset[0.27999999999999997`]}, "ColumnsIndexed" -> {}, "Rows" -> {
        Offset[0.2], {
         Offset[0.4]}, 
        Offset[0.2]}, "RowsIndexed" -> {}}], "\[NoBreak]", ")"}],
  Function[BoxForm`e$, 
   MatrixForm[
   SparseArray[
    Automatic, {13, 13}, 0, {
     1, {{0, 1, 4, 5, 7, 10, 13, 16, 18, 19, 20, 21, 23, 24}, {{2}, {5}, {
       1}, {4}, {6}, {2}, {8}, {10}, {2}, {8}, {11}, {3}, {9}, {2}, {8}, {
       12}, {5}, {4}, {6}, {5}, {6}, {5}, {7}, {6}}}, {
      1, 2, 1, -1, 2, -1, Rational[5, 2], 6, Rational[4, 3], Rational[-4, 3], 
       6, 1, -1, Rational[-2, 3], Rational[2, 3], 6, -2, Rational[5, 2], -2, 
       Rational[18, 5], Rational[16, 5], Rational[-4, 5], 2, 
       Rational[-12, 5]}}]]]]], "Output",
 CellChangeTimes->{{3.7021997783481407`*^9, 3.702199825790099*^9}, {
   3.702200257965201*^9, 3.7022002947173223`*^9}, {3.702200352347328*^9, 
   3.7022003551346407`*^9}, {3.70220100818268*^9, 3.702201025408752*^9}, {
   3.702224098485407*^9, 3.702224102512182*^9}, 3.7022241428905773`*^9, 
   3.702224187849831*^9, 3.7022248559156446`*^9, 3.7022249026322527`*^9, {
   3.702225094739278*^9, 3.702225121688199*^9}}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"Ax20New", "//", "MatrixForm"}]], "Input",
 CellChangeTimes->{{3.702224217293962*^9, 3.702224221689332*^9}, {
  3.702224888305109*^9, 3.702224892362637*^9}}],

Cell[BoxData[
 TagBox[
  RowBox[{"(", "\[NoBreak]", GridBox[{
     {"0", "1", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0"},
     {"1", "0", "0", 
      RowBox[{"-", 
       SqrtBox[
        FractionBox["2", "3"]]}], 
      SqrtBox["2"], "0", "0", "0", "0", "0", "0", "0", "0"},
     {"0", "0", "0", "0", "0", 
      SqrtBox["2"], "0", "0", "0", "0", "0", "0", "0"},
     {"0", 
      RowBox[{"-", 
       SqrtBox[
        FractionBox["2", "3"]]}], "0", "0", "0", "0", "0", 
      SqrtBox[
       FractionBox["5", "3"]], "0", "0", "0", "0", "0"},
     {"0", 
      FractionBox[
       RowBox[{"2", " ", 
        SqrtBox["2"]}], "3"], "0", "0", "0", "0", "0", 
      RowBox[{"-", 
       FractionBox["4", 
        RowBox[{"3", " ", 
         SqrtBox["5"]}]]}], "0", 
      SqrtBox["3"], "0", "0", "0"},
     {"0", "0", 
      FractionBox["1", 
       SqrtBox["2"]], "0", "0", "0", "0", "0", 
      RowBox[{"-", 
       FractionBox["1", 
        SqrtBox["5"]]}], "0", 
      SqrtBox["3"], "0", "0"},
     {"0", 
      RowBox[{"-", 
       FractionBox[
        SqrtBox["2"], "3"]}], "0", "0", "0", "0", "0", 
      FractionBox["2", 
       RowBox[{"3", " ", 
        SqrtBox["5"]}]], "0", "0", "0", 
      SqrtBox["3"], "0"},
     {"0", "0", "0", 
      SqrtBox[
       FractionBox["5", "3"]], 
      RowBox[{"-", 
       FractionBox["2", 
        SqrtBox["5"]]}], "0", "0", "0", "0", "0", "0", "0", "0"},
     {"0", "0", "0", "0", "0", 
      RowBox[{"-", 
       FractionBox["2", 
        SqrtBox["5"]]}], "0", "0", "0", "0", "0", "0", "0"},
     {"0", "0", "0", "0", 
      FractionBox[
       RowBox[{"3", " ", 
        SqrtBox["3"]}], "5"], "0", "0", "0", "0", "0", "0", "0", "0"},
     {"0", "0", "0", "0", "0", 
      FractionBox["8", 
       RowBox[{"5", " ", 
        SqrtBox["3"]}]], "0", "0", "0", "0", "0", "0", "0"},
     {"0", "0", "0", "0", 
      RowBox[{"-", 
       FractionBox["2", 
        RowBox[{"5", " ", 
         SqrtBox["3"]}]]}], "0", 
      FractionBox["1", 
       SqrtBox["3"]], "0", "0", "0", "0", "0", "0"},
     {"0", "0", "0", "0", "0", 
      RowBox[{"-", 
       FractionBox[
        RowBox[{"2", " ", 
         SqrtBox["3"]}], "5"]}], "0", "0", "0", "0", "0", "0", "0"}
    },
    GridBoxAlignment->{
     "Columns" -> {{Center}}, "ColumnsIndexed" -> {}, "Rows" -> {{Baseline}}, 
      "RowsIndexed" -> {}},
    GridBoxSpacings->{"Columns" -> {
        Offset[0.27999999999999997`], {
         Offset[0.7]}, 
        Offset[0.27999999999999997`]}, "ColumnsIndexed" -> {}, "Rows" -> {
        Offset[0.2], {
         Offset[0.4]}, 
        Offset[0.2]}, "RowsIndexed" -> {}}], "\[NoBreak]", ")"}],
  Function[BoxForm`e$, 
   MatrixForm[
   SparseArray[
    Automatic, {13, 13}, 0, {
     1, {{0, 1, 4, 5, 7, 10, 13, 16, 18, 19, 20, 21, 23, 24}, {{2}, {5}, {
       1}, {4}, {6}, {2}, {8}, {10}, {2}, {8}, {11}, {3}, {9}, {2}, {8}, {
       12}, {5}, {4}, {6}, {5}, {6}, {5}, {7}, {6}}}, {
      1, 2^Rational[1, 2], 1, -Rational[2, 3]^Rational[1, 2], 2^
       Rational[1, 2], -Rational[2, 3]^Rational[1, 2], Rational[5, 3]^
       Rational[1, 2], 3^Rational[1, 2], Rational[2, 3] 2^Rational[1, 2], 
       Rational[-4, 3] 5^Rational[-1, 2], 3^Rational[1, 2], 2^
       Rational[-1, 2], -5^Rational[-1, 2], Rational[-1, 3] 2^Rational[1, 2], 
       Rational[2, 3] 5^Rational[-1, 2], 3^Rational[1, 2], (-2) 
       5^Rational[-1, 2], Rational[5, 3]^Rational[1, 2], (-2) 
       5^Rational[-1, 2], Rational[3, 5] 3^Rational[1, 2], Rational[8, 5] 
       3^Rational[-1, 2], Rational[-2, 5] 3^Rational[-1, 2], 3^
       Rational[-1, 2], Rational[-2, 5] 3^Rational[1, 2]}}]]]]], "Output",
 CellChangeTimes->{3.7022248926764793`*^9}]
}, Open  ]],

Cell[BoxData[""], "Input",
 CellChangeTimes->{{3.7022004868427973`*^9, 3.702200491829438*^9}}],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"varIdx", "=", 
  RowBox[{"Table", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"iTraces", "[", "i", "]"}], ",", 
      RowBox[{"iTensorDegree", "[", "i", "]"}]}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{"i", ",", "1", ",", "6"}], "}"}]}], "]"}]}]], "Input",
 CellChangeTimes->{{3.702224748878873*^9, 3.702224757523923*^9}}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{"0", ",", "0"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"0", ",", "1"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"1", ",", "0"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"0", ",", "2"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"1", ",", "1"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"0", ",", "3"}], "}"}]}], "}"}]], "Output",
 CellChangeTimes->{3.702224758116144*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"Norm\[Psi]", "[", 
  RowBox[{"0", ",", "1"}], "]"}]], "Input",
 CellChangeTimes->{{3.702224761213162*^9, 3.702224773603965*^9}}],

Cell[BoxData["1"], "Output",
 CellChangeTimes->{3.70222477406006*^9}]
}, Open  ]]
}, Open  ]]
},
WindowSize->{1049, 904},
WindowMargins->{{74, Automatic}, {Automatic, 27}},
FrontEndVersion->"11.0 for Mac OS X x86 (32-bit, 64-bit Kernel) (September \
21, 2016)",
StyleDefinitions->"Default.nb"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[CellGroupData[{
Cell[580, 22, 103, 1, 64, "Section"],
Cell[686, 25, 141, 3, 32, "Input"],
Cell[830, 30, 528, 12, 87, "Text"],
Cell[1361, 44, 22606, 606, 2361, "Input"],
Cell[23970, 652, 3418, 88, 230, "Input"],
Cell[27391, 742, 1495, 39, 138, "Input"],
Cell[CellGroupData[{
Cell[28911, 785, 566, 15, 32, "Input"],
Cell[29480, 802, 3831, 119, 70, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[33348, 926, 551, 15, 32, "Input"],
Cell[33902, 943, 3947, 129, 70, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[37886, 1077, 884, 19, 32, "Input"],
Cell[38773, 1098, 747, 15, 70, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[39557, 1118, 472, 13, 32, "Input"],
Cell[40032, 1133, 377, 8, 70, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[40446, 1146, 1206, 29, 96, "Input"],
Cell[41655, 1177, 393, 10, 70, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[42085, 1192, 1391, 34, 117, "Input"],
Cell[43479, 1228, 502, 12, 70, "Output"]
}, Open  ]]
}, Closed]],
Cell[CellGroupData[{
Cell[44030, 1246, 40, 0, 50, "Section"],
Cell[44073, 1248, 47060, 1255, 4073, "Input"]
}, Open  ]],
Cell[CellGroupData[{
Cell[91170, 2508, 150, 2, 64, "Section"],
Cell[CellGroupData[{
Cell[91345, 2514, 105, 1, 44, "Subsection"],
Cell[91453, 2517, 26952, 610, 2288, "Input"]
}, Closed]],
Cell[CellGroupData[{
Cell[118442, 3132, 105, 1, 36, "Subsection"],
Cell[118550, 3135, 503, 16, 69, "Input"],
Cell[119056, 3153, 3490, 87, 285, "Input"]
}, Closed]],
Cell[CellGroupData[{
Cell[122583, 3245, 105, 1, 36, "Subsection"],
Cell[122691, 3248, 11324, 213, 797, "Input"],
Cell[134018, 3463, 89, 1, 54, "Input"]
}, Closed]],
Cell[CellGroupData[{
Cell[134144, 3469, 106, 1, 36, "Subsection"],
Cell[134253, 3472, 1910, 46, 216, "Input"]
}, Closed]],
Cell[CellGroupData[{
Cell[136200, 3523, 130, 1, 36, "Subsection"],
Cell[136333, 3526, 20942, 455, 1933, "Input"],
Cell[157278, 3983, 147, 3, 32, "Input"]
}, Closed]],
Cell[CellGroupData[{
Cell[157462, 3991, 104, 1, 36, "Subsection"],
Cell[157569, 3994, 6146, 153, 663, "Input"],
Cell[163718, 4149, 26277, 598, 2851, "Input"]
}, Open  ]]
}, Closed]],
Cell[CellGroupData[{
Cell[190044, 4753, 120, 1, 50, "Section"],
Cell[CellGroupData[{
Cell[190189, 4758, 103, 1, 44, "Subsection"],
Cell[190295, 4761, 497, 16, 77, "Input"]
}, Open  ]],
Cell[CellGroupData[{
Cell[190829, 4782, 94, 1, 44, "Subsection"],
Cell[190926, 4785, 7231, 197, 506, "Input"],
Cell[CellGroupData[{
Cell[198182, 4986, 135, 2, 28, "Input"],
Cell[198320, 4990, 2965, 94, 175, "Output"]
}, Open  ]]
}, Closed]]
}, Closed]],
Cell[CellGroupData[{
Cell[201346, 5091, 103, 1, 47, "Subchapter"],
Cell[201452, 5094, 961, 25, 263, "Text"],
Cell[CellGroupData[{
Cell[202438, 5123, 1616, 48, 264, "Input"],
Cell[CellGroupData[{
Cell[204079, 5175, 437, 8, 24, "Print"],
Cell[204519, 5185, 965, 27, 24, "Print"],
Cell[205487, 5214, 322, 6, 24, "Print"],
Cell[205812, 5222, 322, 6, 24, "Print"],
Cell[206137, 5230, 322, 6, 24, "Print"],
Cell[206462, 5238, 366, 7, 24, "Print"],
Cell[206831, 5247, 388, 9, 24, "Print"]
}, Open  ]],
Cell[207234, 5259, 411, 9, 44, "Output"],
Cell[207648, 5270, 390, 9, 24, "Print"],
Cell[208041, 5281, 230, 4, 32, "Output"],
Cell[208274, 5287, 398, 9, 24, "Print"],
Cell[208675, 5298, 916, 25, 45, "Output"],
Cell[209594, 5325, 896, 24, 45, "Output"]
}, Open  ]],
Cell[210505, 5352, 674, 17, 216, "Text"],
Cell[211182, 5371, 332, 10, 75, "Input"],
Cell[211517, 5383, 626, 20, 32, "Input"],
Cell[212146, 5405, 1123, 22, 305, "Text"]
}, Closed]],
Cell[CellGroupData[{
Cell[213306, 5432, 96, 1, 54, "Chapter"],
Cell[CellGroupData[{
Cell[213427, 5437, 473, 10, 32, "Input"],
Cell[CellGroupData[{
Cell[213925, 5451, 391, 8, 24, "Print"],
Cell[214319, 5461, 389, 8, 24, "Print"],
Cell[214711, 5471, 397, 8, 24, "Print"],
Cell[215111, 5481, 400, 8, 24, "Print"],
Cell[215514, 5491, 389, 8, 24, "Print"],
Cell[215906, 5501, 397, 8, 24, "Print"],
Cell[216306, 5511, 400, 8, 24, "Print"],
Cell[216709, 5521, 397, 8, 24, "Print"],
Cell[217109, 5531, 398, 8, 24, "Print"],
Cell[217510, 5541, 391, 8, 24, "Print"],
Cell[217904, 5551, 397, 8, 24, "Print"]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[218350, 5565, 475, 7, 32, "Input"],
Cell[218828, 5574, 2845, 62, 289, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[221710, 5641, 180, 3, 32, "Input"],
Cell[221893, 5646, 3669, 99, 399, "Output"]
}, Open  ]],
Cell[225577, 5748, 94, 1, 32, "Input"],
Cell[CellGroupData[{
Cell[225696, 5753, 370, 10, 32, "Input"],
Cell[226069, 5765, 449, 15, 32, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[226555, 5785, 152, 3, 32, "Input"],
Cell[226710, 5790, 69, 1, 32, "Output"]
}, Open  ]]
}, Open  ]]
}
]
*)

